import{c as A,j as e,a7 as oe,r as o,B as r,T as i,g as s,N as H,V as ie,k as W,n as ce,l as X,m as le,b as J,C as de,P as xe,e as ue,f as he,v as ge}from"./index-CeKcXHK_.js";import{D as me}from"./Dns-BTUrrByc.js";import{B as F}from"./Bookmark-ClgoYj39.js";import{S as pe}from"./Stop-BjDzNpZ8.js";import{C as L}from"./Chip-D-0MwXDn.js";import{T as je,a as I}from"./Tab-y_F0SjNS.js";import{T as be,a as fe,b as G,c as M,d as ye}from"./TableRow-APGMPqgQ.js";const Se=A(e.jsx("path",{d:"M19 15.18V7c0-2.21-1.79-4-4-4s-4 1.79-4 4v10c0 1.1-.9 2-2 2s-2-.9-2-2V8.82C8.16 8.4 9 7.3 9 6c0-1.66-1.34-3-3-3S3 4.34 3 6c0 1.3.84 2.4 2 2.82V17c0 2.21 1.79 4 4 4s4-1.79 4-4V7c0-1.1.9-2 2-2s2 .9 2 2v8.18c-1.16.41-2 1.51-2 2.82 0 1.66 1.34 3 3 3s3-1.34 3-3c0-1.3-.84-2.4-2-2.82"})),ke=A(e.jsx("path",{d:"M19.74 18.33C21.15 16.6 22 14.4 22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10c2.4 0 4.6-.85 6.33-2.26.27-.22.53-.46.78-.71.03-.03.05-.06.07-.08.2-.2.39-.41.56-.62M12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8c0 1.85-.63 3.54-1.69 4.9l-1.43-1.43c.69-.98 1.1-2.17 1.1-3.46 0-3.31-2.69-6-6-6s-6 2.69-6 6 2.69 6 6 6c1.3 0 2.51-.42 3.49-1.13l1.42 1.42C15.54 19.37 13.85 20 12 20m1.92-7.49c.17-.66.02-1.38-.49-1.9l-.02-.02c-.77-.77-2-.78-2.78-.04-.01.01-.03.02-.05.04-.78.78-.78 2.05 0 2.83l.02.02c.52.51 1.25.67 1.91.49l1.51 1.51c-.6.36-1.29.58-2.04.58-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4c0 .73-.21 1.41-.56 2z"})),Te=A(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),ve=({data:j,height:k=40})=>{if(!j||j.length<2)return null;const v=j.filter(l=>l!=null);if(v.length<2)return null;const c=Math.max(...v,100);return e.jsx(r,{sx:{display:"flex",alignItems:"flex-end",gap:"2px",height:k},children:j.slice(-30).map((l,u)=>{const f=l==null,n=f?k:Math.max(4,l/c*k),w=f?s.error:l<50?s.secondary:l<150?s.warning:s.error;return e.jsx(X,{title:f?"Timeout":`${l}ms`,children:e.jsx(r,{sx:{width:6,height:n,background:w,borderRadius:"2px",opacity:f?.5:.8,transition:"height 0.2s ease"}})},u)})})},Re=()=>{const{id:j}=oe(),[k,v]=o.useState([]),[c,l]=o.useState(j||""),[u,f]=o.useState(0),[n,w]=o.useState(""),[B,q]=o.useState("22,80,443,3306,5432,8080"),[$,m]=o.useState(!1),[C,T]=o.useState(null),[V,g]=o.useState(null),[p,z]=o.useState([]),[b,D]=o.useState(!1),[K,N]=o.useState([]),[d,R]=o.useState({sent:0,received:0,min:null,max:null,avg:null}),y=o.useRef(null);o.useEffect(()=>{const t=localStorage.getItem("networkToolsSavedTargets");if(t)try{z(JSON.parse(t))}catch{}},[]);const Q=()=>{if(!n)return;const t=[...p.filter(a=>a!==n),n].slice(-10);z(t),localStorage.setItem("networkToolsSavedTargets",JSON.stringify(t))},U=t=>{const a=p.filter(h=>h!==t);z(a),localStorage.setItem("networkToolsSavedTargets",JSON.stringify(a))},Y=o.useCallback(()=>{if(!n||!c)return;D(!0),N([]),R({sent:0,received:0,min:null,max:null,avg:null});const t=async()=>{try{const h=await(await fetch(`/api/machines/${c}/network/ping`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target:n,count:1})})).json(),E=h.output?.match(/time[=<](\d+\.?\d*)\s*ms/i),S=E?parseFloat(E[1]):null,re=h.output?.includes("1 received")||h.output?.includes("1 packets received");N(x=>[...x.slice(-59),S]),R(x=>{const ae=x.sent+1,O=re?x.received+1:x.received,P=[...S?[S]:[],...x.min!==null?[x.min,x.max]:[]];return{sent:ae,received:O,min:P.length>0?Math.min(...P):null,max:P.length>0?Math.max(...P):null,avg:S&&x.avg?(x.avg*(O-1)+S)/O:S||x.avg}})}catch{N(h=>[...h.slice(-59),null]),R(h=>({...h,sent:h.sent+1}))}};t(),y.current=setInterval(t,2e3)},[n,c]),Z=o.useCallback(()=>{D(!1),y.current&&(clearInterval(y.current),y.current=null)},[]);o.useEffect(()=>()=>{y.current&&clearInterval(y.current)},[]),o.useEffect(()=>{fetch("/api/machines").then(t=>t.json()).then(t=>{v(t||[]),!j&&t?.length>0&&l(t[0].id)}).catch(t=>g(t.message))},[]);const _=async()=>{m(!0),g(null);try{const a=await(await fetch(`/api/machines/${c}/network/ping`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target:n,count:4})})).json();T(a)}catch(t){g(t.message)}m(!1)},ee=async()=>{m(!0),g(null);try{const a=await(await fetch(`/api/machines/${c}/network/traceroute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target:n})})).json();T(a)}catch(t){g(t.message)}m(!1)},te=async()=>{m(!0),g(null);try{const a=await(await fetch(`/api/machines/${c}/network/portscan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target:n,ports:B})})).json();T(a)}catch(t){g(t.message)}m(!1)},se=async()=>{m(!0),g(null);try{const a=await(await fetch(`/api/machines/${c}/network/dns`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:n,type:"A"})})).json();T(a)}catch(t){g(t.message)}m(!1)},ne=()=>{switch(u){case 0:_();break;case 1:ee();break;case 2:te();break;case 3:se();break}};return e.jsxs(r,{sx:{p:3},children:[e.jsx(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,p:3,background:"linear-gradient(135deg, rgba(236, 72, 153, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%)",borderRadius:"16px",border:"1px solid rgba(236, 72, 153, 0.2)"},children:e.jsxs(r,{children:[e.jsxs(i,{variant:"h5",sx:{color:s.text.primary,fontWeight:700,display:"flex",alignItems:"center",gap:1},children:[e.jsx(H,{sx:{color:"#ec4899"}}),"Network Tools"]}),e.jsx(i,{sx:{color:s.text.muted,fontSize:"0.9rem",mt:.5},children:"Ping, traceroute, port scan, and DNS lookup"})]})}),p.length>0&&e.jsxs(r,{sx:{mb:3},children:[e.jsxs(i,{sx:{color:s.text.muted,fontSize:"0.85rem",mb:1,display:"flex",alignItems:"center",gap:.5},children:[e.jsx(F,{sx:{fontSize:16}}),"Saved Targets"]}),e.jsx(r,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:p.map(t=>e.jsx(L,{label:t,onClick:()=>w(t),onDelete:()=>U(t),sx:{background:n===t?"rgba(236, 72, 153, 0.2)":"rgba(255,255,255,0.05)",color:n===t?"#ec4899":s.text.secondary,border:`1px solid ${n===t?"rgba(236, 72, 153, 0.4)":s.border.light}`,"&:hover":{background:"rgba(236, 72, 153, 0.15)"}}},t))})]}),e.jsxs(ie,{sx:{background:s.background.card,border:`1px solid ${s.border.light}`,mb:3,borderRadius:"12px",overflow:"hidden"},children:[e.jsx(r,{sx:{p:2,borderBottom:`1px solid ${s.border.light}`,display:"flex",gap:2,alignItems:"center"},children:e.jsx(W,{select:!0,label:"Run from Machine",value:c,onChange:t=>l(t.target.value),size:"small",sx:{minWidth:250},children:k.map(t=>e.jsxs(ce,{value:t.id,children:[t.name," (",t.ip,")"]},t.id))})}),e.jsxs(je,{value:u,onChange:(t,a)=>{f(a),T(null)},sx:{borderBottom:`1px solid ${s.border.light}`,"& .MuiTab-root":{color:s.text.muted,textTransform:"none"},"& .Mui-selected":{color:s.primary},"& .MuiTabs-indicator":{background:s.primary}},children:[e.jsx(I,{icon:e.jsx(H,{}),label:"Ping",iconPosition:"start"}),e.jsx(I,{icon:e.jsx(Se,{}),label:"Traceroute",iconPosition:"start"}),e.jsx(I,{icon:e.jsx(ke,{}),label:"Port Scan",iconPosition:"start"}),e.jsx(I,{icon:e.jsx(me,{}),label:"DNS Lookup",iconPosition:"start"})]}),e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[e.jsx(W,{label:u===3?"Domain":"Target Host/IP",value:n,onChange:t=>w(t.target.value),fullWidth:!0,size:"small",placeholder:u===3?"example.com":"192.168.1.1 or google.com",sx:{"& .MuiOutlinedInput-root":{background:s.background.dark}}}),e.jsx(X,{title:p.includes(n)?"Already saved":"Save target",children:e.jsx(le,{onClick:Q,disabled:!n||p.includes(n),sx:{color:p.includes(n)?"#ec4899":s.text.muted},children:p.includes(n)?e.jsx(F,{}):e.jsx(Te,{})})}),u===2&&e.jsx(W,{label:"Ports",value:B,onChange:t=>q(t.target.value),size:"small",placeholder:"22,80,443",sx:{width:200,"& .MuiOutlinedInput-root":{background:s.background.dark}}}),e.jsx(J,{variant:"contained",onClick:ne,disabled:$||!n||!c||b,sx:{background:s.primary,minWidth:100,"&:hover":{background:s.primaryHover}},children:$?e.jsx(de,{size:20}):"Run"}),u===0&&e.jsx(J,{variant:"contained",onClick:b?Z:Y,disabled:!n||!c,startIcon:b?e.jsx(pe,{}):e.jsx(xe,{}),sx:{background:b?s.error:s.secondary,minWidth:140,"&:hover":{background:b?"#dc2626":"#16a34a"}},children:b?"Stop":"Continuous"})]}),u===0&&b&&e.jsx(ue,{sx:{mb:3,background:"rgba(34, 197, 94, 0.05)",border:"1px solid rgba(34, 197, 94, 0.2)",borderRadius:"12px"},children:e.jsxs(he,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(i,{sx:{color:s.secondary,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{sx:{width:8,height:8,borderRadius:"50%",background:s.secondary,animation:"pulse 1s infinite","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.5}}}}),"Pinging ",n]}),e.jsxs(r,{sx:{display:"flex",gap:3},children:[e.jsxs(r,{sx:{textAlign:"center"},children:[e.jsx(i,{sx:{color:s.text.muted,fontSize:"0.7rem"},children:"SENT"}),e.jsx(i,{sx:{color:s.text.primary,fontWeight:600},children:d.sent})]}),e.jsxs(r,{sx:{textAlign:"center"},children:[e.jsx(i,{sx:{color:s.text.muted,fontSize:"0.7rem"},children:"RECV"}),e.jsx(i,{sx:{color:s.secondary,fontWeight:600},children:d.received})]}),e.jsxs(r,{sx:{textAlign:"center"},children:[e.jsx(i,{sx:{color:s.text.muted,fontSize:"0.7rem"},children:"LOSS"}),e.jsxs(i,{sx:{color:d.sent>0&&d.received<d.sent?s.error:s.text.primary,fontWeight:600},children:[d.sent>0?Math.round((1-d.received/d.sent)*100):0,"%"]})]}),e.jsxs(r,{sx:{textAlign:"center"},children:[e.jsx(i,{sx:{color:s.text.muted,fontSize:"0.7rem"},children:"MIN"}),e.jsxs(i,{sx:{color:s.text.primary,fontWeight:600},children:[d.min?.toFixed(1)||"-","ms"]})]}),e.jsxs(r,{sx:{textAlign:"center"},children:[e.jsx(i,{sx:{color:s.text.muted,fontSize:"0.7rem"},children:"AVG"}),e.jsxs(i,{sx:{color:s.primary,fontWeight:600},children:[d.avg?.toFixed(1)||"-","ms"]})]}),e.jsxs(r,{sx:{textAlign:"center"},children:[e.jsx(i,{sx:{color:s.text.muted,fontSize:"0.7rem"},children:"MAX"}),e.jsxs(i,{sx:{color:s.text.primary,fontWeight:600},children:[d.max?.toFixed(1)||"-","ms"]})]})]})]}),e.jsx(ve,{data:K,height:50})]})}),V&&e.jsx(ge,{severity:"error",sx:{mb:2},children:V}),C&&e.jsx(r,{children:u===2&&C.results?e.jsxs(be,{size:"small",children:[e.jsx(fe,{children:e.jsxs(G,{children:[e.jsx(M,{sx:{color:s.text.muted},children:"Port"}),e.jsx(M,{sx:{color:s.text.muted},children:"Status"})]})}),e.jsx(ye,{children:C.results.map((t,a)=>e.jsxs(G,{children:[e.jsx(M,{sx:{color:s.text.primary},children:t.port}),e.jsx(M,{children:e.jsx(L,{label:t.status,size:"small",color:t.status==="open"?"success":"default"})})]},a))})]}):e.jsx(r,{sx:{background:s.background.dark,borderRadius:1,p:2,fontFamily:"monospace",fontSize:"0.85rem",color:s.text.secondary,whiteSpace:"pre-wrap",maxHeight:400,overflow:"auto"},children:C.output||"No output"})})]})]})]})};export{Re as default};
