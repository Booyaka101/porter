import{c as be,j as e,r as x,B as r,g as t,G as D,T as n,l as G,m as _,af as je,P as Y,a8 as _e,u as Je,ab as Ve,C as se,w as W,b as N,X as Ue,e as A,f as L,d as te,i as Ge,ag as pe,a6 as he,k as Ye}from"./index-DsbQFb1R.js";import{A as U}from"./ArrowBack-CEEisvg6.js";import{g as Xe,p as ge,A as Ke,R as qe,a as Qe}from"./presets-BtfKClbI.js";import{S as fe}from"./Stop-wvOeMS9w.js";import{C as M}from"./CheckCircle-DTYTWwS_.js";import{W as re}from"./Warning-DSlc4MWh.js";import{S as Ze}from"./Star-l_T5kGNc.js";import{C as ne}from"./ContentCopy-BThDuDcr.js";import{H as X}from"./HourglassEmpty-Cvx9DtUt.js";import{E as ye}from"./ExpandLess-CF_6GykM.js";import{C as $}from"./Chip-Curpsm0X.js";import{L as K}from"./LinearProgress-DfDRVRT8.js";import{C as Se}from"./Collapse-oGCCXVS5.js";import{S as es}from"./Switch-DW5bYoed.js";import{C as ss}from"./Checkbox-CJ1sUYEH.js";import"./SwitchBase-JqiP87-Y.js";const me=be(e.jsx("path",{d:"M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7"})),ts=be(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.89-2-2-2m0 16H5V7h14zm-5.5-6c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5M12 9c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"})),rs=d=>{const k=[];let u=null,p=null;return d.forEach(R=>{const f=R.data||"",C=f.match(/^=== PLAY \[(.+)\] ===$/);if(C){u&&u.status==="running"?(u.status="success",k.push(u)):u&&k.push(u),u={name:C[1],status:"running",tasks:[],startTime:R.timestamp,logs:[]},p=null;return}const j=f.match(/^TASK \[(\d+)\] (.+)$/);if(j&&u){p={number:parseInt(j[1]),name:j[2],status:"running",logs:[]},u.tasks.push(p);return}if(f.includes("...ok")&&p){p.status="success",p=null;return}if(f.includes("...FAILED")&&p){p.status="failed",u&&(u.status="failed"),p=null;return}if(f.includes("...skipped")&&p){p.status="skipped",p=null;return}const g=f.match(/EXIT_CODE:(\d+)/);if(g){const m=parseInt(g[1]);u&&(u.status=m===0?"success":"failed",k.push(u),u=null);return}p?p.logs.push(f):u&&u.logs.push(f)}),u&&k.push(u),k},ns=({stage:d,isLast:k})=>{const[u,p]=x.useState(d.status==="running"||d.status==="failed"),R=()=>{switch(d.status){case"success":return e.jsx(M,{sx:{color:t.secondary,fontSize:20}});case"failed":return e.jsx(D,{sx:{color:t.error,fontSize:20}});case"running":return e.jsx(X,{sx:{color:t.warning,fontSize:20,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}});default:return e.jsx(Y,{sx:{color:t.text.disabled,fontSize:20}})}},f=()=>{switch(d.status){case"success":return t.secondary;case"failed":return t.error;case"running":return t.warning;default:return t.text.disabled}},C=d.tasks.filter(m=>m.status==="success").length,j=d.tasks.filter(m=>m.status==="failed").length,g=d.tasks.length;return e.jsxs(r,{sx:{mb:1},children:[e.jsxs(r,{onClick:()=>p(!u),sx:{display:"flex",alignItems:"center",gap:1.5,p:1.5,cursor:"pointer",background:`linear-gradient(90deg, ${f()}15 0%, transparent 100%)`,borderLeft:`3px solid ${f()}`,borderRadius:"0 8px 8px 0",transition:"all 0.2s","&:hover":{background:`linear-gradient(90deg, ${f()}25 0%, transparent 100%)`}},children:[R(),e.jsx(n,{sx:{flex:1,fontWeight:600,color:t.text.primary,fontSize:"0.95rem"},children:d.name}),g>0&&e.jsxs(r,{sx:{display:"flex",gap:.5},children:[C>0&&e.jsx($,{size:"small",label:`${C} âœ“`,sx:{height:22,fontSize:"0.75rem",background:`${t.secondary}30`,color:t.secondary}}),j>0&&e.jsx($,{size:"small",label:`${j} âœ—`,sx:{height:22,fontSize:"0.75rem",background:`${t.error}30`,color:t.error}}),d.status==="running"&&e.jsx($,{size:"small",label:`${C}/${g}`,sx:{height:22,fontSize:"0.75rem",background:`${t.warning}30`,color:t.warning}})]}),e.jsx(_,{size:"small",sx:{color:t.text.disabled},children:u?e.jsx(ye,{fontSize:"small"}):e.jsx(je,{fontSize:"small"})})]}),d.status==="running"&&e.jsx(K,{variant:g>0?"determinate":"indeterminate",value:g>0?C/g*100:0,sx:{height:2,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),e.jsx(Se,{in:u,children:e.jsxs(r,{sx:{pl:4,pr:2,py:1},children:[d.tasks.map((m,S)=>e.jsx(as,{task:m},S)),d.logs.filter(m=>m.trim()).length>0&&e.jsx(r,{sx:{mt:1,p:1.5,background:"rgba(0,0,0,0.3)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.8rem",color:t.text.muted,maxHeight:150,overflow:"auto"},children:d.logs.filter(m=>m.trim()).map((m,S)=>e.jsx(r,{sx:{whiteSpace:"pre-wrap"},children:m},S))})]})})]})},as=({task:d})=>{const k=()=>{switch(d.status){case"success":return e.jsx(M,{sx:{color:t.secondary,fontSize:16}});case"failed":return e.jsx(D,{sx:{color:t.error,fontSize:16}});case"skipped":return e.jsx(Y,{sx:{color:t.text.disabled,fontSize:16}});case"running":return e.jsx(X,{sx:{color:t.warning,fontSize:16,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}});default:return null}},u=()=>{switch(d.status){case"success":return t.secondary;case"failed":return t.error;case"running":return t.warning;default:return t.text.disabled}};return e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,py:.5,borderLeft:`2px solid ${u()}40`,pl:1.5,mb:.5},children:[k(),e.jsx(n,{sx:{fontSize:"0.85rem",color:d.status==="failed"?t.error:t.text.secondary},children:d.name}),d.status==="failed"&&d.logs.length>0&&e.jsxs(n,{sx:{fontSize:"0.75rem",color:t.error,opacity:.8,ml:"auto"},children:[d.logs[d.logs.length-1]?.substring(0,50),"..."]})]})},os=({events:d,status:k,machineName:u})=>{const p=x.useMemo(()=>rs(d),[d]),R=x.useRef(null),[f,C]=x.useState(!1),[j,g]=x.useState(!1);x.useEffect(()=>{R.current&&(R.current.scrollTop=R.current.scrollHeight)},[p]);const m=()=>{const I=d.map(E=>E.data).join(`
`);navigator.clipboard.writeText(I),g(!0),setTimeout(()=>g(!1),2e3)},S=()=>k==="complete"?"success":k==="error"?"failed":"running",H=()=>{switch(S()){case"success":return t.secondary;case"failed":return t.error;default:return t.warning}},v=p.filter(I=>I.status==="success").length,F=p.filter(I=>I.status==="failed").length;return e.jsxs(r,{sx:{background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",border:`1px solid ${H()}33`,overflow:"hidden"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,p:2,background:`${H()}10`,borderBottom:`1px solid ${t.border.light}`},children:[S()==="success"&&e.jsx(M,{sx:{color:t.secondary,fontSize:28}}),S()==="failed"&&e.jsx(D,{sx:{color:t.error,fontSize:28}}),S()==="running"&&e.jsx(X,{sx:{color:t.warning,fontSize:28,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(n,{sx:{color:t.text.primary,fontWeight:600,fontSize:"1.1rem"},children:u}),e.jsxs(n,{sx:{color:t.text.muted,fontSize:"0.85rem"},children:[p.length," stages â€¢ ",v," completed",F>0&&` â€¢ ${F} failed`]})]}),e.jsx(G,{title:f?"Show stages":"Show raw output",children:e.jsx($,{label:f?"Stages":"Raw",size:"small",onClick:()=>C(!f),sx:{cursor:"pointer",background:"rgba(255,255,255,0.1)",color:t.text.secondary}})}),e.jsx(G,{title:"Copy output",children:e.jsx(_,{size:"small",onClick:m,sx:{color:j?t.secondary:t.text.disabled},children:e.jsx(ne,{fontSize:"small"})})})]}),S()==="running"&&e.jsx(K,{sx:{height:3,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),e.jsx(r,{ref:R,sx:{maxHeight:"60vh",minHeight:200,overflow:"auto",p:2},children:f?e.jsx(r,{sx:{fontFamily:'"JetBrains Mono", monospace',fontSize:"0.85rem",lineHeight:1.5},children:d.map((I,E)=>e.jsx(r,{sx:{color:I.type==="error"?t.error:t.text.secondary,whiteSpace:"pre-wrap",mb:.25},children:I.data},E))}):p.length>0?p.map((I,E)=>e.jsx(ns,{stage:I,isLast:E===p.length-1},E)):e.jsx(n,{sx:{color:t.text.disabled,fontStyle:"italic"},children:"Waiting for output..."})})]})},is=({execId:d,machineName:k,machineId:u,onComplete:p,useStageView:R=!0})=>{const[f,C]=x.useState([]),[j,g]=x.useState("connecting"),[m,S]=x.useState(!0),[H,v]=x.useState(!1),F=x.useRef(null),I=x.useRef(null);x.useEffect(()=>{if(!d)return;const h=new EventSource(`/api/stream/${d}`);return I.current=h,h.addEventListener("connected",o=>{g("running")}),h.addEventListener("status",o=>{try{const b=JSON.parse(o.data);C(T=>[...T,{type:"status",...b}])}catch(b){console.error("Failed to parse status event:",b)}}),h.addEventListener("output",o=>{try{const b=JSON.parse(o.data);C(T=>[...T,{type:"output",...b}])}catch(b){console.error("Failed to parse output event:",b)}}),h.addEventListener("error",o=>{try{const b=JSON.parse(o.data);C(T=>[...T,{type:"error",...b}]),g("error")}catch{h.readyState===EventSource.CLOSED&&g("error")}}),h.addEventListener("complete",o=>{try{const b=JSON.parse(o.data);C(T=>[...T,{type:"complete",...b}]),g(b.data?.includes("true")?"complete":"error"),p?.(b)}catch{g("complete")}h.close()}),h.onerror=()=>{h.readyState===EventSource.CLOSED&&g("error")},()=>{h.close()}},[d,p]),x.useEffect(()=>{F.current&&m&&(F.current.scrollTop=F.current.scrollHeight)},[f,m]);const E=()=>{switch(j){case"complete":return e.jsx(M,{sx:{color:t.secondary}});case"error":return e.jsx(D,{sx:{color:t.error}});default:return e.jsx(X,{sx:{color:t.warning,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}})}},y=()=>{switch(j){case"complete":return t.secondary;case"error":return t.error;default:return t.warning}},B=()=>{const h=f.filter(o=>o.type==="output"||o.type==="status").map(o=>o.data).join(`
`);navigator.clipboard.writeText(h),v(!0),setTimeout(()=>v(!1),2e3)},J=h=>h?new Date(h).toLocaleTimeString():"";return R?e.jsx(os,{events:f,status:j,machineName:k}):e.jsxs(r,{sx:{background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",border:`1px solid ${y()}33`,overflow:"hidden"},children:[e.jsxs(r,{onClick:()=>S(!m),sx:{display:"flex",alignItems:"center",gap:2,p:2,cursor:"pointer",background:`${y()}10`,borderBottom:m?`1px solid ${t.border.light}`:"none"},children:[E(),e.jsxs(r,{sx:{flex:1},children:[e.jsx(n,{sx:{color:t.text.primary,fontWeight:600},children:k}),e.jsxs(n,{sx:{color:t.text.disabled,fontSize:"0.75rem"},children:[j==="connecting"&&"Connecting...",j==="running"&&"Running...",j==="complete"&&"Completed successfully",j==="error"&&"Failed"]})]}),e.jsx($,{label:j,size:"small",sx:{background:`${y()}20`,color:y(),textTransform:"capitalize"}}),e.jsx(G,{title:"Copy output",children:e.jsx(_,{size:"small",onClick:h=>{h.stopPropagation(),B()},sx:{color:H?t.secondary:t.text.disabled},children:e.jsx(ne,{fontSize:"small"})})}),e.jsx(_,{size:"small",sx:{color:t.text.disabled},children:m?e.jsx(ye,{}):e.jsx(je,{})})]}),j==="running"&&e.jsx(K,{sx:{height:2,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),m&&e.jsx(r,{ref:F,sx:{maxHeight:"60vh",minHeight:200,overflow:"auto",p:2,fontFamily:'"JetBrains Mono", "Fira Code", monospace',fontSize:"0.85rem",lineHeight:1.5,background:"rgba(0, 0, 0, 0.4)"},children:f.length===0?e.jsx(n,{sx:{color:t.text.disabled,fontStyle:"italic"},children:"Waiting for output..."}):f.map((h,o)=>e.jsxs(r,{sx:{display:"flex",gap:1,mb:.5,color:h.type==="error"?t.error:h.type==="status"?t.primary:t.text.secondary},children:[e.jsx(n,{component:"span",sx:{color:t.text.disabled,fontSize:"0.75rem",minWidth:85,flexShrink:0,opacity:.7},children:J(h.timestamp)}),e.jsx(n,{component:"span",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:h.data})]},o))})]})},Is=()=>{const{scriptPath:d}=_e(),k=Je(),[u]=Ve(),p=decodeURIComponent(d||""),R=u.get("machines")?.split(",").filter(Boolean)||[],f=u.get("execId"),C=u.get("step")?parseInt(u.get("step"),10)-1:null,j=u.get("flags")||"",[g,m]=x.useState(null),[S,H]=x.useState([]),[v,F]=x.useState([]),[I,E]=x.useState({}),[y,B]=x.useState(0),[J,h]=x.useState(!1),[o,b]=x.useState(null),[T,q]=x.useState(null),[ve,Q]=x.useState([]),[we,ke]=x.useState(!0),[V,Ce]=x.useState(null),[O,Z]=x.useState(null),[ae,oe]=x.useState(!1),[cs,ze]=x.useState({}),[ls,ds]=x.useState(!1),[Ie,ie]=x.useState(!1);x.useEffect(()=>{Re(),$e()},[p]),x.useEffect(()=>{f&&S.length>0&&Ee(f)},[f,S]);const Ee=async a=>{try{const i=await fetch(`/api/script-executions/${a}`);if(!i.ok)return;const c=await i.json();if(c.status==="running"){h(!0),q(a),b(c),B(2),c.machine_ids&&F(c.machine_ids);const z=(c.machine_ids||[]).map(l=>{const w=S.find(P=>P.id===l);return{execId:a,machineId:l,machineName:w?.name||l}});Q(z);const s=async()=>{const w=await(await fetch(`/api/script-executions/${a}`)).json();b(w),w.status==="running"?setTimeout(s,2e3):h(!1)};setTimeout(s,2e3)}}catch(i){console.error("Failed to reconnect to execution:",i)}},Re=async()=>{try{const c=(await(await fetch("/api/scripts")).json()).find(z=>z.path===p);if(c){m(c);const z={};if(c.flags?.forEach(s=>{z[s.long]={enabled:!1,value:""}}),j)j.split(" ").filter(Boolean).forEach(l=>{const w=l.match(/^--([^=]+)(?:=(.*))?$/);if(w){const[,P,De]=w,ue=c.flags?.find(xe=>xe.long===`--${P}`||xe.long===P);ue&&(z[ue.long]={enabled:!0,value:De||""})}}),E(z);else{E(z);const s=Xe(c.path);Ce(s);const l=s.presets?.find(w=>w.recommended);l&&(Z(l),E(ge(l,c.flags)))}}}catch(a){console.error("Failed to fetch script:",a)}finally{ke(!1)}},$e=async()=>{try{const i=await(await fetch("/api/machines")).json();if(H(i||[]),R.length>0&&i){const c=R.filter(z=>i.some(s=>s.id===z));c.length>0&&(F(c),C!==null&&C>=0&&C<=2?B(C):B(1))}}catch(a){console.error("Failed to fetch machines:",a)}},Te=a=>{F(i=>i.includes(a)?i.filter(c=>c!==a):[...i,a])},Pe=a=>{Z(null),E(i=>({...i,[a]:{...i[a],enabled:!i[a]?.enabled}}))},Fe=a=>{Z(a),ze({}),V?.useArgs||E(ge(a,g?.flags))},Ne=(a,i)=>{E(c=>({...c,[a]:{...c[a],value:i}}))},ce=()=>{if(V?.useArgs&&O?.args)return O.args;const a=[];return Object.entries(I).forEach(([i,c])=>{c.enabled&&(c.value?a.push(`${i}=${c.value}`):a.push(i))}),a.join(" ")},le=()=>{const a=ce();return`${g?.path||"script.sh"}${a?" "+a:""}`},Oe=()=>{navigator.clipboard.writeText(le()),ie(!0),setTimeout(()=>ie(!1),2e3)},de=async()=>{h(!0),b(null),q(null),Q([]);try{const a=ce(),c=await(await fetch("/api/execute-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({script_path:g.path,machine_ids:v,args:a})})).json();if(b(c),c.id){q(c.id);const z=v.map(l=>{const w=S.find(P=>P.id===l);return{execId:c.id,machineId:l,machineName:w?.name||l}});Q(z);const s=async()=>{const w=await(await fetch(`/api/script-executions/${c.id}`)).json();b(w),w.status==="running"?setTimeout(s,2e3):h(!1)};setTimeout(s,2e3)}else h(!1)}catch(a){console.error("Execution failed:",a),b({error:a.message}),h(!1)}},We=()=>{},Me=async()=>{if(T)try{(await(await fetch(`/api/script-executions/${T}/cancel`,{method:"POST"})).json()).success&&(b(c=>({...c,status:"cancelled"})),h(!1))}catch(a){console.error("Failed to cancel execution:",a)}},ee=["Select Machines","Configure Options","Review & Execute"],Be=()=>B(a=>a+1),Ae=()=>B(a=>a-1),Le=()=>y===0?v.length>0:!0;if(we)return e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(se,{})});if(!g)return e.jsxs(r,{sx:{p:3},children:[e.jsxs(W,{severity:"error",children:["Script not found: ",p]}),e.jsx(N,{startIcon:e.jsx(U,{}),onClick:()=>k("/scripts"),sx:{mt:2},children:"Back to Scripts"})]});const He=a=>{switch(a){case 0:return e.jsxs(r,{children:[e.jsxs(W,{severity:"info",icon:e.jsx(me,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 1 of 3: Pick Your Computers"}),e.jsx(n,{variant:"body2",children:"Click on the computers below where you want to run this script. You can select multiple computers to run the same script on all of them at once."})]}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(te,{color:"primary"}),"Which computers do you want to use?"]}),S.length===0?e.jsxs(W,{severity:"warning",sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",children:"No computers set up yet!"}),e.jsx(n,{variant:"body2",sx:{mb:1},children:"You need to add at least one computer before you can run scripts."}),e.jsx(N,{variant:"contained",size:"small",onClick:()=>k("/machines"),children:"Add a Computer Now"})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:v.length===0?"ðŸ‘† Click on a computer to select it":`âœ… ${v.length} computer${v.length>1?"s":""} selected`}),v.some(s=>S.find(l=>l.id===s)?.status!=="online")&&e.jsxs(W,{severity:"warning",icon:e.jsx(re,{}),sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",children:"âš ï¸ Some selected machines are offline"}),e.jsx(n,{variant:"body2",children:"Scripts may fail on offline machines. Consider testing connections first."})]}),e.jsx(he,{children:S.map(s=>e.jsx(A,{sx:{mb:1.5,border:2,borderColor:v.includes(s.id)?"primary.main":"transparent",bgcolor:v.includes(s.id)?"primary.dark":"background.paper",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:"primary.light",transform:"scale(1.01)"}},onClick:()=>Te(s.id),children:e.jsxs(L,{sx:{display:"flex",alignItems:"center",py:2},children:[e.jsx(ss,{checked:v.includes(s.id),sx:{mr:1}}),e.jsx(te,{sx:{mr:2,fontSize:40},color:s.status==="online"?"success":"disabled"}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsx(n,{variant:"h6",children:s.name||s.ip}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["IP: ",s.ip," â€¢ User: ",s.username]})]}),e.jsx($,{label:s.status==="online"?"ðŸŸ¢ Online":"ðŸ”´ Offline",size:"medium",color:s.status==="online"?"success":"error",variant:"outlined"})]})},s.id))})]})]});case 1:const i=Object.values(I).filter(s=>s.enabled).length,c=V?.presets?.length>0;return e.jsxs(r,{children:[e.jsxs(W,{severity:"info",icon:e.jsx(me,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 2 of 3: What do you want to set up?"}),e.jsx(n,{variant:"body2",children:c?"Pick a setup type below. Each one is pre-configured for a specific use case.":"Configure the options for this script."})]}),c&&!ae&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:"ðŸŽ¯ What type of machine is this?"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Click on the option that best describes what this computer will be used for."}),e.jsx(qe,{value:O?.id||"",children:V.presets.map(s=>e.jsx(A,{onClick:()=>Fe(s),sx:{mb:2,cursor:"pointer",border:3,borderColor:O?.id===s.id?"primary.main":"transparent",bgcolor:O?.id===s.id?"primary.dark":"background.paper",transition:"all 0.2s","&:hover":{borderColor:"primary.light",transform:"scale(1.01)"}},children:e.jsx(L,{sx:{py:2},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Qe,{checked:O?.id===s.id,sx:{mr:2}}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsxs(n,{variant:"h5",sx:{display:"flex",alignItems:"center",gap:1},children:[s.name,s.recommended&&e.jsx($,{icon:e.jsx(Ze,{}),label:"Recommended",size:"small",color:"warning"})]}),e.jsx(n,{variant:"body1",color:"text.secondary",sx:{mt:1},children:s.description}),s.warning&&e.jsx($,{icon:e.jsx(re,{}),label:s.warning,size:"small",color:"warning",variant:"outlined",sx:{mt:1}}),O?.id===s.id&&s.flags&&s.flags.length>0&&e.jsx(Se,{in:!0,children:e.jsxs(r,{sx:{mt:2,p:1.5,bgcolor:"rgba(0,0,0,0.2)",borderRadius:1},children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"This preset will enable:"}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.flags.map(l=>{const w=l.replace(/^--/,"").replace(/=/g,": ").replace(/-/g," ").replace(/\b\w/g,P=>P.toUpperCase());return e.jsx($,{label:w,size:"small",sx:{bgcolor:"rgba(249, 115, 22, 0.2)",color:"#f97316",fontSize:"0.75rem"}},l)})})]})})]}),O?.id===s.id&&e.jsx(M,{color:"primary",sx:{fontSize:40}})]})})},s.id))}),e.jsx(r,{sx:{mt:3,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(N,{startIcon:e.jsx(pe,{}),onClick:()=>oe(!0),color:"inherit",size:"small",children:"Advanced: Customize individual options"})})]}),(ae||!c)&&e.jsxs(e.Fragment,{children:[c&&e.jsx(r,{sx:{mb:3},children:e.jsx(N,{startIcon:e.jsx(U,{}),onClick:()=>oe(!1),variant:"outlined",size:"small",children:"Back to Simple Mode"})}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(pe,{color:"primary"}),"Advanced Options"]}),!g.flags||g.flags.length===0?e.jsxs(W,{severity:"success",sx:{mt:2},children:[e.jsx(n,{variant:"subtitle2",children:"No options needed! ðŸŽ‰"}),e.jsx(n,{variant:"body2",children:`This script doesn't have any options to configure. Just click "Next" to continue.`})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i===0?"ðŸ’¡ All options are OFF. Turn on what you need.":`âœ… ${i} option${i>1?"s":""} turned ON`}),e.jsx(he,{children:g.flags.map(s=>{const l=I[s.long]?.enabled||!1,w=s.long.replace("--","").replace(/-/g," ").replace(/\b\w/g,P=>P.toUpperCase());return e.jsx(A,{sx:{mb:1.5,border:2,borderColor:l?"success.main":"transparent",bgcolor:l?"success.dark":"background.paper",transition:"all 0.2s"},children:e.jsx(L,{sx:{py:2},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(es,{checked:l,onChange:()=>Pe(s.long),color:"success",sx:{mr:2}}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsxs(n,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[w,s.has_value&&e.jsx($,{label:"needs a value",size:"small",color:"warning",variant:"outlined"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:s.description||"No description available"}),s.has_value&&l&&e.jsx(Ye,{fullWidth:!0,size:"medium",label:`Enter ${s.value_hint||"value"}`,value:I[s.long]?.value||"",onChange:P=>Ne(s.long,P.target.value),sx:{mt:2},placeholder:`Example: ${s.value_hint||"your-value"}`,helperText:`Type the ${s.value_hint||"value"} you want to use`,variant:"outlined"})]}),e.jsx(n,{variant:"body2",sx:{ml:2,color:l?"success.light":"text.disabled",fontWeight:"bold"},children:l?"ON":"OFF"})]})})},s.long)})})]})]})]});case 2:const z=Object.entries(I).filter(([s,l])=>l.enabled);return e.jsxs(r,{children:[e.jsxs(W,{severity:"warning",icon:e.jsx(re,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 3 of 3: Ready to Run!"}),e.jsx(n,{variant:"body2",children:"Double-check everything below. When you click the big green button, the script will run on your selected computers. This cannot be undone!"})]}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{color:"primary"}),"Here's what will happen:"]}),e.jsx(A,{sx:{mb:2,bgcolor:"primary.dark"},children:e.jsxs(L,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"SCRIPT"}),e.jsx(n,{variant:"h6",children:g.name}),e.jsx(n,{variant:"body2",color:"text.secondary",children:g.description})]})}),e.jsx(A,{sx:{mb:2,bgcolor:"info.dark"},children:e.jsxs(L,{children:[e.jsxs(n,{variant:"overline",color:"text.secondary",children:["RUNNING ON ",v.length," COMPUTER",v.length>1?"S":""]}),e.jsx(r,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:1},children:v.map(s=>{const l=S.find(w=>w.id===s);return e.jsx($,{icon:e.jsx(te,{}),label:l?.name||l?.ip||s,color:"info",sx:{fontSize:"1rem",py:2}},s)})})]})}),e.jsx(A,{sx:{mb:2,bgcolor:z.length>0?"success.dark":"grey.800"},children:e.jsxs(L,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:z.length>0?`WITH ${z.length} OPTION${z.length>1?"S":""} ENABLED`:"USING DEFAULT SETTINGS (NO OPTIONS)"}),z.length>0?e.jsx(r,{sx:{mt:1},children:z.map(([s,l])=>e.jsx($,{label:l.value?`${s}=${l.value}`:s,sx:{mr:1,mb:1},color:"success"},s))}):e.jsx(n,{variant:"body2",sx:{mt:1},children:"The script will run with its default behavior."})]})}),e.jsx(A,{sx:{mb:2,bgcolor:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)"},children:e.jsxs(L,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ts,{sx:{color:"#8b5cf6"}}),e.jsx(n,{variant:"overline",sx:{color:"#8b5cf6"},children:"DRY-RUN PREVIEW"})]}),e.jsx(G,{title:Ie?"Copied!":"Copy command",children:e.jsx(_,{size:"small",onClick:Oe,sx:{color:"#8b5cf6"},children:e.jsx(ne,{fontSize:"small"})})})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:"This is the command that will be executed on each machine:"}),e.jsxs(r,{sx:{p:2,bgcolor:"rgba(0,0,0,0.4)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.9rem",color:"#a5f3fc",overflow:"auto"},children:[e.jsx(Ge,{sx:{fontSize:14,mr:1,verticalAlign:"middle",color:"#8b5cf6"}}),le()]}),e.jsx(n,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled"},children:"ðŸ’¡ Tip: Copy this command to test manually before running on all machines"})]})}),o&&e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,background:o.status==="completed"?"linear-gradient(135deg, rgba(0,200,100,0.2) 0%, rgba(0,150,80,0.1) 100%)":o.status==="failed"?"linear-gradient(135deg, rgba(255,80,80,0.2) 0%, rgba(200,50,50,0.1) 100%)":o.status==="cancelled"?"linear-gradient(135deg, rgba(255,152,0,0.2) 0%, rgba(200,120,0,0.1) 100%)":"linear-gradient(135deg, rgba(0,180,255,0.2) 0%, rgba(0,120,200,0.1) 100%)",border:"1px solid",borderColor:o.status==="completed"?"rgba(0,200,100,0.3)":o.status==="failed"?"rgba(255,80,80,0.3)":o.status==="cancelled"?"rgba(255,152,0,0.3)":"rgba(0,180,255,0.3)"},children:[o.status==="running"&&e.jsx(se,{size:32,sx:{color:"#00b4ff"}}),o.status==="completed"&&e.jsx(M,{sx:{fontSize:32,color:"#00c864"}}),o.status==="failed"&&e.jsx(D,{sx:{fontSize:32,color:"#ff5050"}}),o.status==="cancelled"&&e.jsx(fe,{sx:{fontSize:32,color:"#ff9800"}}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:[o.status==="running"&&"Executing...",o.status==="completed"&&"Completed Successfully",o.status==="failed"&&"Execution Failed",o.status==="cancelled"&&"Execution Cancelled"]}),e.jsxs(n,{variant:"body2",sx:{opacity:.7},children:[o.status==="running"&&`Running on ${v.length} machine(s)`,o.status==="completed"&&"All tasks completed",o.status==="failed"&&"Check output below for details",o.status==="cancelled"&&"Execution was cancelled"]})]}),o.status==="running"&&e.jsxs(e.Fragment,{children:[e.jsx($,{label:`${o.results?.length||0}/${v.length}`,sx:{background:"rgba(0,180,255,0.2)",color:"#00b4ff",fontWeight:600}}),e.jsx(N,{variant:"contained",color:"error",startIcon:e.jsx(fe,{}),onClick:Me,sx:{ml:1,background:"linear-gradient(135deg, #ff5050 0%, #cc3030 100%)","&:hover":{background:"linear-gradient(135deg, #ff6060 0%, #dd4040 100%)"}},children:"Stop"})]})]}),T&&e.jsx(r,{sx:{flex:1},children:ve.map(s=>e.jsx(is,{execId:s.execId,machineName:s.machineName,machineId:s.machineId,onComplete:We},s.machineId))}),o.status!=="running"&&o.results?.length>0&&!T&&e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:o.results.map((s,l)=>e.jsxs(r,{sx:{p:2,borderRadius:2,background:"rgba(0,0,0,0.3)",border:"1px solid",borderColor:s.success?"rgba(0,200,100,0.3)":"rgba(255,80,80,0.3)",borderLeft:"3px solid",borderLeftColor:s.success?"#00c864":"#ff5050"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[s.success?e.jsx(M,{sx:{color:"#00c864",fontSize:20}}):e.jsx(D,{sx:{color:"#ff5050",fontSize:20}}),e.jsx(n,{sx:{fontWeight:600},children:s.machine_name||"Machine"}),e.jsx($,{label:s.success?"Success":"Failed",size:"small",sx:{ml:"auto",background:s.success?"rgba(0,200,100,0.2)":"rgba(255,80,80,0.2)",color:s.success?"#00c864":"#ff5050"}})]}),s.output&&e.jsx(r,{sx:{mt:1,p:2,bgcolor:"rgba(0,0,0,0.4)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.8rem",lineHeight:1.5,maxHeight:"40vh",overflow:"auto",whiteSpace:"pre-wrap"},children:s.output}),s.error&&e.jsx(W,{severity:"error",sx:{mt:1},children:s.error})]},l))}),o.status==="running"&&!T&&e.jsxs(r,{sx:{textAlign:"center",py:4,background:"rgba(0,0,0,0.2)",borderRadius:2},children:[e.jsx(se,{size:32,sx:{mb:2,color:"#00b4ff"}}),e.jsx(n,{sx:{opacity:.7},children:"Connecting to machines..."})]})]}),J&&!o&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(K,{sx:{height:8,borderRadius:4}}),e.jsx(n,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:"Starting execution..."})]}),o&&o.status!=="running"&&e.jsxs(r,{sx:{display:"flex",gap:2},children:[e.jsx(N,{variant:"outlined",size:"large",onClick:()=>k("/scripts"),fullWidth:!0,children:"Back to Scripts"}),e.jsx(N,{variant:"contained",color:"primary",size:"large",startIcon:e.jsx(Y,{}),onClick:()=>{b(null),de()},fullWidth:!0,children:"Run Again"})]})]});default:return null}};return e.jsxs(r,{sx:{p:2,maxWidth:1200,mx:"auto",display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",gap:1.5,overflow:"hidden"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,flexShrink:0},children:[e.jsx(N,{startIcon:e.jsx(U,{}),onClick:()=>k("/scripts"),variant:"text",sx:{color:"rgba(255,255,255,0.7)","&:hover":{color:"#f97316",background:"rgba(0,212,255,0.1)"}},children:"Back"}),e.jsx(r,{sx:{flex:1,display:"flex",alignItems:"center",gap:2,background:"linear-gradient(90deg, rgba(0,212,255,0.1) 0%, transparent 100%)",borderRadius:2,p:1.5,pl:2},children:e.jsxs(r,{children:[e.jsx(n,{variant:"h5",sx:{fontWeight:700,color:"#fff"},children:g.name}),e.jsx(n,{variant:"body2",sx:{color:"rgba(255,255,255,0.6)"},children:g.description})]})})]}),e.jsx(r,{sx:{display:"flex",alignItems:"center",gap:1,flexShrink:0,background:"rgba(0,0,0,0.3)",borderRadius:2,p:1},children:ee.map((a,i)=>e.jsxs(r,{sx:{flex:1,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5,flex:1,p:1.5,borderRadius:1.5,background:i===y?"linear-gradient(135deg, rgba(0,212,255,0.3) 0%, rgba(0,255,136,0.2) 100%)":i<y?"rgba(0,200,100,0.15)":"transparent",border:"1px solid",borderColor:i===y?"rgba(0,212,255,0.5)":i<y?"rgba(0,200,100,0.3)":"rgba(255,255,255,0.1)",transition:"all 0.3s ease"},children:[e.jsx(r,{sx:{width:28,height:28,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:i<y?"#00c864":i===y?"linear-gradient(135deg, #f97316 0%, #22c55e 100%)":"rgba(255,255,255,0.1)",color:i<=y?"#0a0a0f":"rgba(255,255,255,0.5)",fontWeight:700,fontSize:"0.85rem"},children:i<y?"âœ“":i+1}),e.jsx(n,{sx:{fontWeight:i===y?600:400,color:i===y?"#fff":i<y?"#00c864":"rgba(255,255,255,0.5)",fontSize:"0.9rem"},children:a})]}),i<ee.length-1&&e.jsx(r,{sx:{width:24,height:2,background:i<y?"#00c864":"rgba(255,255,255,0.2)",borderRadius:1}})]},a))}),e.jsx(Ue,{sx:{p:2,flex:1,minHeight:0,overflow:"auto",mb:1,"&::-webkit-scrollbar":{width:"12px"},"&::-webkit-scrollbar-track":{background:"#1e1e1e",borderRadius:"6px"},"&::-webkit-scrollbar-thumb":{background:"#666",borderRadius:"6px",border:"2px solid #1e1e1e"},"&::-webkit-scrollbar-thumb:hover":{background:"#888"}},children:He(y)}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",p:2,bgcolor:"rgba(0, 20, 40, 0.95)",borderRadius:2,border:"1px solid rgba(249, 115, 22, 0.3)",flexShrink:0,position:"sticky",bottom:0,backdropFilter:"blur(10px)"},children:[e.jsx(N,{variant:"outlined",size:"large",startIcon:e.jsx(U,{}),disabled:y===0,onClick:Ae,sx:{px:4},children:"â† Previous Step"}),y<ee.length-1?e.jsx(N,{variant:"contained",size:"large",endIcon:e.jsx(Ke,{}),onClick:Be,disabled:!Le(),sx:{px:4,background:"linear-gradient(135deg, #f97316 0%, #22c55e 100%)",color:"#0a0a0f",fontWeight:700,"&:hover":{background:"linear-gradient(135deg, #fb923c 0%, #4ade80 100%)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Next Step â†’"}):!J&&!o&&e.jsx(N,{variant:"contained",size:"large",startIcon:e.jsx(Y,{}),onClick:de,sx:{px:4,background:"linear-gradient(135deg, #22c55e 0%, #f97316 100%)",color:"#0a0a0f",fontWeight:700,"&:hover":{background:"linear-gradient(135deg, #4ade80 0%, #fb923c 100%)",boxShadow:"0 0 30px rgba(34, 197, 94, 0.4)"}},children:"ðŸš€ Execute Script"})]})]})};export{Is as default};
