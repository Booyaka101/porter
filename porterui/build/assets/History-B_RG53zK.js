import{c as W,j as e,u as ye,a as ke,r as a,B as t,s as Se,g as r,ac as U,T as o,H as X,E as q,l as R,m as b,b as u,M as Ce,n as d,R as ze,k as Ie,I as we,S as Re,a3 as G,a1 as K,a0 as Q,e as ve,f as Y,d as Me,h as Ee,af as De,D as Z,w as ee,x as se}from"./index-CeKcXHK_.js";import{C as re}from"./CheckCircle-D57u65eu.js";import{E as Te}from"./ExpandLess-CsEnt3XZ.js";import{D as Le}from"./Delete-BJPOpBfA.js";import{A as Fe}from"./AccessTime-D9KXY2Hp.js";import{T as _e}from"./TrendingUp-BP7jLrFz.js";import{D as We}from"./Download-Ch_3Wkrw.js";import{T as Ae}from"./Timeline-jfmgFsAz.js";import{C as te}from"./Checkbox-BGRTg49G.js";import{C as _}from"./Chip-D-0MwXDn.js";import{C as He}from"./Collapse-Ds3R1wYK.js";import{P as Pe}from"./Pagination-DeH5e3yX.js";import{D as oe}from"./DialogActions-CfuqQ9qs.js";import"./SwitchBase-pMciNMdG.js";const $e=W(e.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"})),v=W(e.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),Oe=W(e.jsx("path",{d:"M3 14h4v-4H3zm0 5h4v-4H3zM3 9h4V5H3zm5 5h13v-4H8zm0 5h13v-4H8zM8 5v4h13V5z"})),rs=()=>{const A=ye(),{isAdmin:H}=ke(),[M,ne]=a.useState([]),[g,ae]=a.useState(null),[P,$]=a.useState(!0),[m,ie]=a.useState(""),[E,le]=a.useState(null),[D,j]=a.useState(1),[f,ce]=a.useState(20),[y,de]=a.useState("all"),[O,k]=a.useState(null),[x,S]=a.useState(null),[C,B]=a.useState("list"),[c,z]=a.useState([]),[T,L]=a.useState({open:!1,executions:[]}),I=a.useCallback(async()=>{$(!0);try{const[s,n]=await Promise.all([fetch("/api/history?limit=100"),fetch("/api/history/stats")]),l=await s.json(),i=await n.json();ne(l||[]),ae(i)}catch(s){console.error("Failed to load history:",s)}$(!1)},[]),V=s=>{S(s)},xe=()=>{x&&A(`/scripts?rerun=${x.id}`),S(null)};a.useEffect(()=>{I()},[I]);const ue=async()=>{if(window.confirm("Clear all execution history?"))try{await fetch("/api/history",{method:"DELETE"}),I()}catch(s){console.error("Failed to clear history:",s)}},p=M.filter(s=>{const n=s.machine_name?.toLowerCase().includes(m.toLowerCase())||s.script_name?.toLowerCase().includes(m.toLowerCase())||s.script_path?.toLowerCase().includes(m.toLowerCase()),l=y==="all"||y==="success"&&s.success||y==="failed"&&!s.success;return n&&l}),N=Math.ceil(p.length/f),h=p.slice((D-1)*f,D*f),he=s=>s?s.replace("s"," sec").replace("m"," min "):"-",pe=()=>{const s=JSON.stringify(p,null,2);J(s,"execution-history.json","application/json"),k(null)},ge=()=>{const s=["ID","Machine","Script","Status","Started","Duration","Error"],n=p.map(i=>[i.id,i.machine_name,i.script_name||i.script_path,i.success?"Success":"Failed",new Date(i.started_at).toISOString(),i.duration||"",i.error||""]),l=[s,...n].map(i=>i.map(w=>`"${String(w).replace(/"/g,'""')}"`).join(",")).join(`
`);J(l,"execution-history.csv","text/csv"),k(null)},J=(s,n,l)=>{const i=new Blob([s],{type:l}),w=URL.createObjectURL(i),F=document.createElement("a");F.href=w,F.download=n,F.click(),URL.revokeObjectURL(w)},me=s=>{z(n=>n.includes(s)?n.filter(l=>l!==s):[...n,s])},be=()=>{c.length===h.length?z([]):z(h.map(s=>s.id))},je=()=>{if(c.length===0)return;const s=M.filter(n=>c.includes(n.id));s.length===1?V(s[0]):A(`/scripts?rerun=${s[0].id}`)},fe=()=>{if(c.length!==2)return;const s=M.filter(n=>c.includes(n.id));L({open:!0,executions:s})};return p.reduce((s,n)=>{const l=new Date(n.started_at).toLocaleDateString();return s[l]||(s[l]=[]),s[l].push(n),s},{}),e.jsxs(t,{sx:Se.pageContainer,children:[e.jsx(t,{sx:{background:U.header,borderRadius:"24px",border:`1px solid ${r.border.light}`,p:3,mb:4},children:e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:2},children:[e.jsxs(t,{children:[e.jsx(o,{sx:{fontSize:"2.2rem",fontWeight:800,background:U.text,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:"-0.02em",mb:.5},children:"Execution History"}),e.jsx(o,{sx:{color:r.text.muted,fontSize:"0.95rem"},children:"View past script executions and their results"}),g&&e.jsxs(t,{sx:{display:"flex",gap:3,mt:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(X,{sx:{fontSize:16,color:r.primary}}),e.jsxs(o,{sx:{color:r.text.secondary,fontSize:"0.85rem"},children:[e.jsx("strong",{style:{color:r.primary},children:g.total})," Total"]})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(re,{sx:{fontSize:16,color:r.secondary}}),e.jsxs(o,{sx:{color:r.text.secondary,fontSize:"0.85rem"},children:[e.jsx("strong",{style:{color:r.secondary},children:g.successful})," Success"]})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(q,{sx:{fontSize:16,color:r.error}}),e.jsxs(o,{sx:{color:r.text.secondary,fontSize:"0.85rem"},children:[e.jsx("strong",{style:{color:r.error},children:g.failed})," Failed"]})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{sx:{fontSize:16,color:r.warning}}),e.jsxs(o,{sx:{color:r.text.secondary,fontSize:"0.85rem"},children:[e.jsxs("strong",{style:{color:r.warning},children:[g.success_rate?.toFixed(1),"%"]})," Rate"]})]})]})]}),e.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",background:"rgba(255,255,255,0.03)",borderRadius:"10px",border:`1px solid ${r.border.light}`,p:.5},children:[e.jsx(R,{title:"List View",children:e.jsx(b,{size:"small",onClick:()=>B("list"),sx:{color:C==="list"?r.primary:r.text.muted,background:C==="list"?"rgba(249, 115, 22, 0.15)":"transparent",borderRadius:"8px","&:hover":{background:"rgba(249, 115, 22, 0.1)"}},children:e.jsx(Oe,{})})}),e.jsx(R,{title:"Timeline View",children:e.jsx(b,{size:"small",onClick:()=>B("timeline"),sx:{color:C==="timeline"?r.primary:r.text.muted,background:C==="timeline"?"rgba(249, 115, 22, 0.15)":"transparent",borderRadius:"8px","&:hover":{background:"rgba(249, 115, 22, 0.1)"}},children:e.jsx(Ae,{})})})]}),e.jsx(u,{startIcon:e.jsx(We,{}),onClick:s=>k(s.currentTarget),sx:{color:r.text.secondary,textTransform:"none",background:"rgba(255,255,255,0.03)",borderRadius:"10px","&:hover":{background:"rgba(249, 115, 22, 0.1)"}},children:"Export"}),e.jsxs(Ce,{anchorEl:O,open:!!O,onClose:()=>k(null),PaperProps:{sx:{background:"rgba(17, 24, 39, 0.95)",backdropFilter:"blur(20px)",border:`1px solid ${r.border.light}`,borderRadius:"12px"}},children:[e.jsx(d,{onClick:pe,children:"Export as JSON"}),e.jsx(d,{onClick:ge,children:"Export as CSV"})]}),e.jsx(R,{title:"Refresh",children:e.jsx(b,{onClick:I,sx:{color:r.text.muted,background:"rgba(255,255,255,0.03)","&:hover":{color:r.primary,background:"rgba(249, 115, 22, 0.1)"}},children:e.jsx(ze,{})})}),e.jsx(u,{onClick:ue,startIcon:e.jsx(Le,{}),size:"small",sx:{color:r.text.muted,textTransform:"none",background:"rgba(255,255,255,0.03)",borderRadius:"10px",px:2,"&:hover":{color:r.error,background:"rgba(255, 68, 102, 0.1)"}},children:"Clear All"})]})]})}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(Ie,{size:"small",placeholder:"Search by machine or script...",value:m,onChange:s=>{ie(s.target.value),j(1)},InputProps:{startAdornment:e.jsx(we,{position:"start",children:e.jsx(Re,{sx:{color:r.text.disabled}})})},sx:{flex:1,minWidth:200,"& .MuiOutlinedInput-root":{background:r.background.glass,borderRadius:"12px"}}}),e.jsx(G,{size:"small",sx:{minWidth:120},children:e.jsxs(K,{value:y,onChange:s=>{de(s.target.value),j(1)},startAdornment:e.jsx($e,{sx:{mr:1,color:r.text.disabled}}),sx:{background:r.background.glass,borderRadius:"12px","& .MuiOutlinedInput-notchedOutline":{borderColor:r.border.light}},children:[e.jsx(d,{value:"all",children:"All Status"}),e.jsx(d,{value:"success",children:"Success"}),e.jsx(d,{value:"failed",children:"Failed"})]})}),e.jsx(G,{size:"small",sx:{minWidth:100},children:e.jsxs(K,{value:f,onChange:s=>{ce(s.target.value),j(1)},sx:{background:r.background.glass,borderRadius:"12px","& .MuiOutlinedInput-notchedOutline":{borderColor:r.border.light}},children:[e.jsx(d,{value:10,children:"10 / page"}),e.jsx(d,{value:20,children:"20 / page"}),e.jsx(d,{value:50,children:"50 / page"}),e.jsx(d,{value:100,children:"100 / page"})]})})]}),c.length>0&&e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2,mb:2,p:2,background:"linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(249, 115, 22, 0.05) 100%)",borderRadius:"12px",border:"1px solid rgba(249, 115, 22, 0.3)"},children:[e.jsx(te,{checked:c.length===h.length,indeterminate:c.length>0&&c.length<h.length,onChange:be,sx:{color:r.primary,"&.Mui-checked":{color:r.primary}}}),e.jsxs(o,{sx:{color:r.primary,fontWeight:600},children:[c.length," selected"]}),e.jsx(t,{sx:{flex:1}}),H()&&e.jsx(u,{size:"small",startIcon:e.jsx(v,{}),onClick:je,sx:{color:r.primary,textTransform:"none","&:hover":{background:"rgba(249, 115, 22, 0.15)"}},children:"Re-run Selected"}),c.length===2&&e.jsx(u,{size:"small",startIcon:e.jsx(Q,{}),onClick:fe,sx:{color:"#06b6d4",textTransform:"none","&:hover":{background:"rgba(6, 182, 212, 0.15)"}},children:"Compare Outputs"}),e.jsx(u,{size:"small",onClick:()=>z([]),sx:{color:r.text.muted,textTransform:"none"},children:"Clear"})]}),!P&&e.jsxs(o,{sx:{color:r.text.disabled,fontSize:"0.85rem",mb:2},children:["Showing ",h.length," of ",p.length," executions"]}),P?e.jsx(t,{children:[1,2,3,4,5].map(s=>e.jsxs(t,{sx:{mb:2,p:2,background:r.background.glass,borderRadius:"12px",border:`1px solid ${r.border.light}`,borderLeft:`4px solid ${r.border.light}`},children:[e.jsxs(t,{sx:{display:"flex",gap:2,mb:1},children:[e.jsx(t,{sx:{width:120,height:20,background:"rgba(255,255,255,0.05)",borderRadius:1}}),e.jsx(t,{sx:{width:60,height:20,background:"rgba(255,255,255,0.05)",borderRadius:1}})]}),e.jsx(t,{sx:{width:200,height:16,background:"rgba(255,255,255,0.03)",borderRadius:1,mb:1}}),e.jsx(t,{sx:{width:150,height:14,background:"rgba(255,255,255,0.02)",borderRadius:1}})]},s))}):h.length===0?e.jsxs(t,{sx:{textAlign:"center",py:8,background:r.background.glass,borderRadius:"16px",border:`1px solid ${r.border.light}`},children:[e.jsx(X,{sx:{fontSize:64,color:r.text.disabled,mb:2}}),e.jsx(o,{sx:{color:r.text.muted},children:m?"No matching executions found":"No execution history yet"}),e.jsx(o,{sx:{color:r.text.disabled,fontSize:"0.85rem"},children:"Run a script to see it appear here"})]}):h.map((s,n)=>e.jsxs(ve,{sx:{mb:1.5,background:n%2===0?"rgba(255,255,255,0.02)":"rgba(255,255,255,0.04)",borderRadius:"12px",border:`1px solid ${r.border.light}`,borderLeft:`4px solid ${s.success?r.secondary:r.error}`,transition:"all 0.25s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{borderColor:s.success?r.secondary:r.error,background:s.success?"rgba(34, 197, 94, 0.05)":"rgba(255, 68, 102, 0.05)",transform:"translateX(4px)",boxShadow:`0 4px 20px ${s.success?"rgba(34, 197, 94, 0.15)":"rgba(255, 68, 102, 0.15)"}`}},children:[e.jsx(Y,{sx:{pb:1},children:e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"flex-start",gap:1,flex:1},children:[e.jsx(te,{size:"small",checked:c.includes(s.id),onChange:()=>me(s.id),sx:{mt:-.5,color:r.text.muted,"&.Mui-checked":{color:r.primary}}}),e.jsxs(t,{sx:{flex:1},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Me,{sx:{fontSize:18,color:r.primary}}),e.jsx(o,{sx:{color:r.text.primary,fontWeight:600},children:s.machine_name}),e.jsx(_,{icon:s.success?e.jsx(re,{}):e.jsx(q,{}),label:s.success?"Success":"Failed",size:"small",sx:{background:s.success?"rgba(34, 197, 94, 0.1)":"rgba(255, 68, 102, 0.1)",color:s.success?r.secondary:r.error,"& .MuiChip-icon":{color:s.success?r.secondary:r.error}}})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(Ee,{sx:{fontSize:16,color:r.text.disabled}}),e.jsx(o,{sx:{color:r.text.secondary,fontSize:"0.9rem"},children:s.script_name||s.script_path}),s.preset_name&&e.jsx(_,{label:s.preset_name,size:"small",sx:{height:20,fontSize:"0.7rem"}})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(o,{sx:{color:r.text.disabled,fontSize:"0.8rem",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Fe,{sx:{fontSize:14}}),new Date(s.started_at).toLocaleString()]}),s.duration&&e.jsxs(o,{sx:{color:r.text.disabled,fontSize:"0.8rem"},children:["Duration: ",he(s.duration)]})]})]})]}),e.jsxs(t,{sx:{display:"flex",gap:.5},children:[H()&&e.jsx(R,{title:"Re-run this execution",children:e.jsx(b,{size:"small",onClick:()=>V(s),sx:{color:r.text.muted,"&:hover":{color:r.primary,background:"rgba(249, 115, 22, 0.1)"}},children:e.jsx(v,{})})}),e.jsx(b,{size:"small",onClick:()=>le(E===s.id?null:s.id),sx:{color:r.text.secondary},children:E===s.id?e.jsx(Te,{}):e.jsx(De,{})})]})]})}),e.jsx(He,{in:E===s.id,children:e.jsxs(Y,{sx:{pt:0},children:[s.error&&e.jsxs(t,{sx:{background:"rgba(255, 68, 102, 0.1)",borderRadius:"8px",p:2,mb:2},children:[e.jsx(o,{sx:{color:r.error,fontWeight:600,fontSize:"0.85rem",mb:.5},children:"Error"}),e.jsx(o,{sx:{color:r.text.secondary,fontSize:"0.85rem"},children:s.error})]}),s.output&&e.jsxs(t,{sx:{background:"rgba(0,0,0,0.3)",borderRadius:"8px",p:2,maxHeight:300,overflow:"auto"},children:[e.jsx(o,{sx:{color:r.text.muted,fontWeight:600,fontSize:"0.85rem",mb:1},children:"Output"}),e.jsx("pre",{style:{margin:0,color:r.text.secondary,fontSize:"0.8rem",fontFamily:'"JetBrains Mono", monospace',whiteSpace:"pre-wrap",wordBreak:"break-word"},children:s.output})]})]})})]},s.id)),N>1&&e.jsx(t,{sx:{display:"flex",justifyContent:"center",mt:3,pb:2},children:e.jsx(Pe,{count:N,page:D,onChange:(s,n)=>j(n),color:"primary",sx:{"& .MuiPaginationItem-root":{color:r.text.secondary,"&.Mui-selected":{background:"rgba(249, 115, 22, 0.2)",color:r.primary}}}})}),e.jsxs(Z,{open:!!x,onClose:()=>S(null),PaperProps:{sx:{background:"rgba(17, 24, 39, 0.95)",backdropFilter:"blur(20px)",border:`1px solid ${r.border.light}`,borderRadius:"16px",minWidth:400}},children:[e.jsxs(ee,{sx:{color:r.text.primary,display:"flex",alignItems:"center",gap:1},children:[e.jsx(v,{sx:{color:r.primary}}),"Confirm Re-run"]}),e.jsx(se,{children:x&&e.jsxs(t,{children:[e.jsx(o,{sx:{color:r.text.secondary,mb:2},children:"Are you sure you want to re-run this execution?"}),e.jsxs(t,{sx:{background:"rgba(255,255,255,0.03)",borderRadius:"8px",p:2,border:`1px solid ${r.border.light}`},children:[e.jsx(o,{sx:{color:r.text.primary,fontWeight:600,mb:.5},children:x.script_name}),e.jsxs(o,{sx:{color:r.text.muted,fontSize:"0.85rem"},children:["Machine: ",x.machine_name]}),x.args&&e.jsxs(o,{sx:{color:r.text.disabled,fontSize:"0.8rem",mt:.5,fontFamily:"monospace"},children:["Args: ",x.args]})]})]})}),e.jsxs(oe,{sx:{p:2,pt:0},children:[e.jsx(u,{onClick:()=>S(null),sx:{color:r.text.secondary},children:"Cancel"}),e.jsx(u,{onClick:xe,variant:"contained",startIcon:e.jsx(v,{}),sx:{background:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)","&:hover":{background:"linear-gradient(135deg, #fb923c 0%, #f97316 100%)"}},children:"Re-run"})]})]}),e.jsxs(Z,{open:T.open,onClose:()=>L({open:!1,executions:[]}),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{background:"rgba(17, 24, 39, 0.95)",backdropFilter:"blur(20px)",border:`1px solid ${r.border.light}`,borderRadius:"16px",maxHeight:"80vh"}},children:[e.jsxs(ee,{sx:{color:r.text.primary,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{sx:{color:"#06b6d4"}}),"Compare Execution Outputs"]}),e.jsx(se,{children:T.executions.length===2&&e.jsx(t,{sx:{display:"flex",gap:2},children:T.executions.map((s,n)=>e.jsxs(t,{sx:{flex:1},children:[e.jsxs(t,{sx:{p:2,mb:2,background:s.success?"rgba(34, 197, 94, 0.1)":"rgba(255, 68, 102, 0.1)",borderRadius:"8px",border:`1px solid ${s.success?"rgba(34, 197, 94, 0.3)":"rgba(255, 68, 102, 0.3)"}`},children:[e.jsx(o,{sx:{color:r.text.primary,fontWeight:600,fontSize:"0.9rem"},children:s.script_name}),e.jsxs(o,{sx:{color:r.text.muted,fontSize:"0.8rem"},children:[s.machine_name," â€¢ ",new Date(s.started_at).toLocaleString()]}),e.jsx(_,{label:s.success?"Success":"Failed",size:"small",sx:{mt:1,background:s.success?"rgba(34, 197, 94, 0.2)":"rgba(255, 68, 102, 0.2)",color:s.success?r.secondary:r.error}})]}),e.jsxs(t,{sx:{background:"rgba(0,0,0,0.3)",borderRadius:"8px",p:2,maxHeight:400,overflow:"auto"},children:[e.jsxs(o,{sx:{color:r.text.muted,fontWeight:600,fontSize:"0.8rem",mb:1},children:["Output ",n+1]}),e.jsx("pre",{style:{margin:0,color:r.text.secondary,fontSize:"0.75rem",fontFamily:'"JetBrains Mono", monospace',whiteSpace:"pre-wrap",wordBreak:"break-word"},children:s.output||"(No output)"}),s.error&&e.jsx(t,{sx:{mt:2,p:1,background:"rgba(255, 68, 102, 0.1)",borderRadius:"4px"},children:e.jsxs(o,{sx:{color:r.error,fontSize:"0.75rem"},children:["Error: ",s.error]})})]})]},s.id))})}),e.jsx(oe,{sx:{p:2,pt:0},children:e.jsx(u,{onClick:()=>L({open:!1,executions:[]}),sx:{color:r.text.secondary},children:"Close"})})]})]})};export{rs as default};
