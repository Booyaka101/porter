import{c as te,j as t,ai as J,ah as _,r as i,aU as oe,aj as q,ak as K,G as Q,ap as D,al as X,aH as re,am as Y,aw as se,B as l,T as O,g as L,a0 as H,V as N,k as G,n as U,b as ae,C as ne,v as le,A as ie}from"./index-CeKcXHK_.js";import{C as de}from"./CheckCircle-D57u65eu.js";import{V as ce}from"./ViewStream-Bcv2LTiR.js";import{R as ue}from"./Remove-B0JByZdl.js";import{C as V}from"./Chip-D-0MwXDn.js";const pe=te(t.jsx("path",{d:"M14.67 5v14H9.33V5zm1 14H21V5h-5.33zm-7.34 0V5H3v14z"}));function fe(e){return _("MuiToggleButton",e)}const T=J("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),Z=i.createContext({}),ee=i.createContext(void 0);function ge(e,s){return s===void 0||e===void 0?!1:Array.isArray(s)?s.includes(e):e===s}const xe=e=>{const{classes:s,fullWidth:d,selected:h,disabled:g,size:v,color:x}=e,b={root:["root",h&&"selected",g&&"disabled",d&&"fullWidth",`size${D(v)}`,x]};return X(b,fe,s)},he=K(re,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:d}=e;return[s.root,s[`size${D(d.size)}`]]}})(Y(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${T.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${T.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.text.primary,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(se()).map(([s])=>({props:{color:s},style:{[`&.${T.selected}`]:{color:(e.vars||e).palette[s].main,backgroundColor:e.alpha((e.vars||e).palette[s].main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[s].main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette[s].main,(e.vars||e).palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),E=i.forwardRef(function(s,d){const{value:h,...g}=i.useContext(Z),v=i.useContext(ee),x=oe({...g,selected:ge(s.value,h)},s),b=q({props:x,name:"MuiToggleButton"}),{children:S,className:y,color:a="standard",disabled:R=!1,disableFocusRipple:B=!1,fullWidth:c=!1,onChange:C,onClick:z,selected:f,size:m="medium",value:$,...w}=b,j={...b,color:a,disabled:R,disableFocusRipple:B,fullWidth:c,size:m},P=xe(j),I=r=>{z&&(z(r,$),r.defaultPrevented)||C&&C(r,$)},o=v||"";return t.jsx(he,{className:Q(g.className,P.root,y,o),disabled:R,focusRipple:!B,ref:d,onClick:I,onChange:C,value:$,ownerState:j,"aria-pressed":f,...w,children:S})});function be(e){return i.Children.toArray(e).filter(s=>i.isValidElement(s))}function me(e){return _("MuiToggleButtonGroup",e)}const n=J("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),ve=e=>{const{classes:s,orientation:d,fullWidth:h,disabled:g}=e,v={root:["root",d,h&&"fullWidth"],grouped:["grouped",`grouped${D(d)}`,g&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return X(v,me,s)},Be=K("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:d}=e;return[{[`& .${n.grouped}`]:s.grouped},{[`& .${n.grouped}`]:s[`grouped${D(d.orientation)}`]},{[`& .${n.firstButton}`]:s.firstButton},{[`& .${n.lastButton}`]:s.lastButton},{[`& .${n.middleButton}`]:s.middleButton},s.root,d.orientation==="vertical"&&s.vertical,d.fullWidth&&s.fullWidth]}})(Y(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${n.grouped}`]:{[`&.${n.selected} + .${n.grouped}.${n.selected}`]:{borderTop:0,marginTop:0}},[`& .${n.firstButton},& .${n.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${n.lastButton},& .${n.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${n.lastButton}.${T.disabled},& .${n.middleButton}.${T.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${n.grouped}`]:{[`&.${n.selected} + .${n.grouped}.${n.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${n.firstButton},& .${n.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${n.lastButton},& .${n.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${n.lastButton}.${T.disabled},& .${n.middleButton}.${T.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),je=i.forwardRef(function(s,d){const h=q({props:s,name:"MuiToggleButtonGroup"}),{children:g,className:v,color:x="standard",disabled:b=!1,exclusive:S=!1,fullWidth:y=!1,onChange:a,orientation:R="horizontal",size:B="medium",value:c,...C}=h,z={...h,disabled:b,fullWidth:y,orientation:R,size:B},f=ve(z),m=i.useCallback((o,r)=>{if(!a)return;const p=c&&c.indexOf(r);let u;c&&p>=0?(u=c.slice(),u.splice(p,1)):u=c?c.concat(r):[r],a(o,u)},[a,c]),$=i.useCallback((o,r)=>{a&&a(o,c===r?null:r)},[a,c]),w=i.useMemo(()=>({className:f.grouped,onChange:S?$:m,value:c,size:B,fullWidth:y,color:x,disabled:b}),[f.grouped,S,$,m,c,B,y,x,b]),j=be(g),P=j.length,I=o=>{const r=o===0,p=o===P-1;return r&&p?"":r?f.firstButton:p?f.lastButton:f.middleButton};return t.jsx(Be,{role:"group",className:Q(f.root,v),ref:d,ownerState:z,...C,children:t.jsx(Z.Provider,{value:w,children:j.map((o,r)=>t.jsx(ee.Provider,{value:I(r),children:o},r))})})}),ze=()=>{const[e,s]=i.useState([]),[d,h]=i.useState(""),[g,v]=i.useState(""),[x,b]=i.useState(""),[S,y]=i.useState(!1),[a,R]=i.useState(null),[B,c]=i.useState(null),[C,z]=i.useState("unified"),f=i.useRef(null),m=i.useRef(null);i.useEffect(()=>{fetch("/api/machines").then(o=>o.json()).then(o=>s(o||[])).catch(o=>c(o.message))},[]);const $=async()=>{if(!(!d||!g||!x)){y(!0),c(null),R(null);try{const r=await(await fetch("/api/diff/machines",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({machine1_id:d,machine2_id:g,file_path:x})})).json();r.success?R(r):c(r.error)}catch(o){c(o.message)}y(!1)}},w=o=>{o==="left"&&f.current&&m.current?m.current.scrollTop=f.current.scrollTop:o==="right"&&f.current&&m.current&&(f.current.scrollTop=m.current.scrollTop)},j=a?.diff?{added:a.diff.filter(o=>o.status==="added").length,removed:a.diff.filter(o=>o.status==="removed").length,changed:a.diff.filter(o=>o.status==="changed").length}:{added:0,removed:0,changed:0},P=()=>a?.diff?t.jsx(l,{sx:{fontFamily:'"JetBrains Mono", "Fira Code", monospace',fontSize:"12px",lineHeight:"20px",overflow:"auto",maxHeight:"calc(100vh - 350px)",background:"#0d0d0d",borderRadius:1},children:a.diff.map((o,r)=>{let p="transparent",u="transparent",M=" ",k="#a1a1aa";return o.status==="added"?(p="rgba(34, 197, 94, 0.15)",u="#22c55e",M="+",k="#4ade80"):o.status==="removed"?(p="rgba(239, 68, 68, 0.15)",u="#ef4444",M="-",k="#f87171"):o.status==="changed"&&(p="rgba(249, 115, 22, 0.15)",u="#f97316",M="~",k="#fb923c"),t.jsxs(l,{sx:{display:"flex",background:p,borderLeft:`3px solid ${u}`,"&:hover":{background:"rgba(255,255,255,0.05)"}},children:[t.jsx(l,{sx:{width:50,textAlign:"right",pr:1,color:"#52525b",background:"rgba(0,0,0,0.3)",borderRight:"1px solid #27272a",userSelect:"none"},children:o.line1||""}),t.jsx(l,{sx:{width:50,textAlign:"right",pr:1,color:"#52525b",background:"rgba(0,0,0,0.3)",borderRight:"1px solid #27272a",userSelect:"none"},children:o.line2||""}),t.jsx(l,{sx:{width:24,textAlign:"center",color:k,fontWeight:700,userSelect:"none"},children:M}),t.jsx(l,{sx:{flex:1,color:k,whiteSpace:"pre",overflow:"hidden",pr:2},children:o.status==="changed"?t.jsxs(t.Fragment,{children:[t.jsx(l,{component:"span",sx:{color:"#f87171",textDecoration:"line-through",opacity:.7},children:o.content1})," â†’ ",t.jsx(l,{component:"span",sx:{color:"#4ade80"},children:o.content2})]}):o.status==="added"?o.content2:o.content1})]},r)})}):null,I=()=>{if(!a?.diff)return null;const o=({line:r,side:p})=>{const u=p==="left",M=u?r.content1:r.content2,k=u?r.line1:r.line2,A=u?r.status==="added":r.status==="removed";let W="transparent",F="#a1a1aa";return A?(W="rgba(63, 63, 70, 0.3)",F="#52525b"):r.status==="added"&&!u?(W="rgba(34, 197, 94, 0.15)",F="#4ade80"):r.status==="removed"&&u?(W="rgba(239, 68, 68, 0.15)",F="#f87171"):r.status==="changed"&&(W=u?"rgba(239, 68, 68, 0.1)":"rgba(34, 197, 94, 0.1)",F=u?"#fca5a5":"#86efac"),t.jsxs(l,{sx:{display:"flex",background:W,minHeight:20,"&:hover":{background:A?W:"rgba(255,255,255,0.03)"}},children:[t.jsx(l,{sx:{width:45,textAlign:"right",pr:1,color:"#52525b",background:"rgba(0,0,0,0.3)",borderRight:"1px solid #27272a",userSelect:"none",fontSize:"11px"},children:k||""}),t.jsx(l,{sx:{flex:1,pl:1,pr:1,color:F,whiteSpace:"pre",overflow:"hidden",textOverflow:"ellipsis"},children:M})]})};return t.jsxs(l,{sx:{display:"flex",gap:0,maxHeight:"calc(100vh - 350px)"},children:[t.jsxs(l,{sx:{flex:1,display:"flex",flexDirection:"column",borderRight:"2px solid #27272a"},children:[t.jsxs(l,{sx:{p:1,background:"rgba(239, 68, 68, 0.1)",borderBottom:"1px solid #27272a",display:"flex",alignItems:"center",gap:1},children:[t.jsx(ue,{sx:{fontSize:16,color:"#ef4444"}}),t.jsx(O,{sx:{color:"#fca5a5",fontSize:"0.8rem",fontWeight:600},children:a.machine1})]}),t.jsx(l,{ref:f,onScroll:()=>w("left"),sx:{flex:1,overflow:"auto",fontFamily:'"JetBrains Mono", "Fira Code", monospace',fontSize:"12px",lineHeight:"20px",background:"#0d0d0d"},children:a.diff.map((r,p)=>t.jsx(o,{line:r,side:"left"},p))})]}),t.jsxs(l,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[t.jsxs(l,{sx:{p:1,background:"rgba(34, 197, 94, 0.1)",borderBottom:"1px solid #27272a",display:"flex",alignItems:"center",gap:1},children:[t.jsx(ie,{sx:{fontSize:16,color:"#22c55e"}}),t.jsx(O,{sx:{color:"#86efac",fontSize:"0.8rem",fontWeight:600},children:a.machine2})]}),t.jsx(l,{ref:m,onScroll:()=>w("right"),sx:{flex:1,overflow:"auto",fontFamily:'"JetBrains Mono", "Fira Code", monospace',fontSize:"12px",lineHeight:"20px",background:"#0d0d0d"},children:a.diff.map((r,p)=>t.jsx(o,{line:r,side:"right"},p))})]})]})};return t.jsxs(l,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[t.jsxs(O,{variant:"h5",sx:{color:L.text.primary,fontWeight:700,mb:2,display:"flex",alignItems:"center",gap:1},children:[t.jsx(H,{sx:{color:L.primary}}),"File Diff Viewer"]}),t.jsx(N,{sx:{background:L.background.card,border:`1px solid ${L.border.light}`,p:2,mb:2},children:t.jsxs(l,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[t.jsx(G,{select:!0,label:"Machine 1",value:d,onChange:o=>h(o.target.value),sx:{minWidth:180},size:"small",children:e.map(o=>t.jsx(U,{value:o.id,children:o.name},o.id))}),t.jsx(G,{select:!0,label:"Machine 2",value:g,onChange:o=>v(o.target.value),sx:{minWidth:180},size:"small",children:e.map(o=>t.jsx(U,{value:o.id,children:o.name},o.id))}),t.jsx(G,{label:"File Path",value:x,onChange:o=>b(o.target.value),placeholder:"/home/user/docker-compose.yml",sx:{flex:1,minWidth:250},size:"small"}),t.jsx(ae,{variant:"contained",onClick:$,disabled:S||!d||!g||!x,startIcon:S?t.jsx(ne,{size:16}):t.jsx(H,{}),sx:{background:L.primary,height:40},children:"Compare"})]})}),B&&t.jsx(le,{severity:"error",sx:{mb:2},children:B}),a&&t.jsxs(N,{sx:{background:"#18181b",border:"1px solid #27272a",flex:1,display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:2},children:[t.jsxs(l,{sx:{p:1.5,borderBottom:"1px solid #27272a",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#0f0f0f"},children:[t.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(O,{sx:{color:"#e4e4e7",fontWeight:600,fontFamily:"monospace",fontSize:"0.9rem"},children:a.file}),a.identical?t.jsx(V,{icon:t.jsx(de,{sx:{fontSize:16}}),label:"Identical",size:"small",sx:{background:"rgba(34, 197, 94, 0.2)",color:"#4ade80"}}):t.jsxs(l,{sx:{display:"flex",gap:1},children:[t.jsx(V,{label:`+${j.added}`,size:"small",sx:{background:"rgba(34, 197, 94, 0.2)",color:"#4ade80",fontWeight:600}}),t.jsx(V,{label:`-${j.removed}`,size:"small",sx:{background:"rgba(239, 68, 68, 0.2)",color:"#f87171",fontWeight:600}}),t.jsx(V,{label:`~${j.changed}`,size:"small",sx:{background:"rgba(249, 115, 22, 0.2)",color:"#fb923c",fontWeight:600}})]})]}),!a.identical&&t.jsxs(je,{value:C,exclusive:!0,onChange:(o,r)=>r&&z(r),size:"small",children:[t.jsxs(E,{value:"unified",sx:{color:"#a1a1aa","&.Mui-selected":{color:"#f97316",background:"rgba(249, 115, 22, 0.1)"}},children:[t.jsx(ce,{sx:{fontSize:18,mr:.5}})," Unified"]}),t.jsxs(E,{value:"split",sx:{color:"#a1a1aa","&.Mui-selected":{color:"#f97316",background:"rgba(249, 115, 22, 0.1)"}},children:[t.jsx(pe,{sx:{fontSize:18,mr:.5}})," Split"]})]})]}),!a.identical&&t.jsx(l,{sx:{flex:1,overflow:"hidden"},children:C==="unified"?P():I()})]})]})};export{ze as default};
