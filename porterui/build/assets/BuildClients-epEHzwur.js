import{ah as ce,ai as xe,r as o,aj as ue,j as e,ak as he,J as pe,al as me,u as ge,ab as be,B as t,C as fe,g as s,aZ as H,m as T,T as l,d as q,b as u,ae as b,A as J,w as M,t as Z,e as je,a_ as _,f as ye,ac as f,l as K,a$ as D,P as F,D as Q,x as X,y as Y,k as j,ad as y}from"./index-DsbQFb1R.js";import{E as Ce}from"./Edit-50w09cL1.js";import{D as Se}from"./Delete-C8af4ORk.js";import{A as ke}from"./ArrowBack-CEEisvg6.js";import{G as N}from"./Grid-Cof3XE5A.js";import{C as ee}from"./Chip-Curpsm0X.js";import{D as se}from"./DialogActions-D3FdWvdP.js";function ve(d){return ce("MuiCardActions",d)}xe("MuiCardActions",["root","spacing"]);const we=d=>{const{classes:c,disableSpacing:a}=d;return me({root:["root",!a&&"spacing"]},ve,c)},Ie=he("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(d,c)=>{const{ownerState:a}=d;return[c.root,!a.disableSpacing&&c.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),$e=o.forwardRef(function(c,a){const h=ue({props:c,name:"MuiCardActions"}),{disableSpacing:A=!1,className:x,...R}=h,C={...h,disableSpacing:A},W=we(C);return e.jsx(Ie,{className:pe(W.root,x),ownerState:C,ref:a,...R})}),Pe=()=>{const d=ge(),[c]=be(),a=c.get("machine"),[h,A]=o.useState([]),[x,R]=o.useState([]),[C,W]=o.useState(!0),[re,S]=o.useState(!1),[k,O]=o.useState(null),[te,v]=o.useState(!1),[w,ae]=o.useState(null),[m,z]=o.useState(""),[g,U]=o.useState(""),[L,I]=o.useState(""),[n,p]=o.useState({name:"",customer:"",pack:"",branch:""});o.useEffect(()=>{E()},[]),o.useEffect(()=>{a&&x.length>0&&x.find(i=>i.id===a)&&z(a)},[a,x]);const E=async()=>{try{const[r,i]=await Promise.all([fetch("/api/build-clients"),fetch("/api/machines")]),G=await r.json(),de=await i.json();A(G||[]);const $=(de||[]).filter(B=>B.tags?.includes("build")||B.tags?.includes("deploy"));R($),a&&$.find(B=>B.id===a)?z(a):$.length>0&&!m&&z($[0].id)}catch(r){I("Failed to load data: "+r.message)}finally{W(!1)}},P=(r=null)=>{r?(O(r),p({name:r.name,customer:r.customer,pack:r.pack,branch:r.branch})):(O(null),p({name:"",customer:"",pack:"",branch:""})),S(!0)},oe=async()=>{try{const r=k?`/api/build-clients/${k.id}`:"/api/build-clients";if(!(await fetch(r,{method:k?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw new Error("Failed to save client");S(!1),E()}catch(r){I("Failed to save client: "+r.message)}},ne=async r=>{if(window.confirm("Delete this client?"))try{if(!(await fetch(`/api/build-clients/${r}`,{method:"DELETE"})).ok)throw new Error("Failed to delete client");E()}catch(i){I("Failed to delete client: "+i.message)}},ie=r=>{ae(r),U(""),v(!0)},le=()=>{if(!w||!m||!g)return;const r=[`--client=${w.name.toLowerCase()}`,`--version=${g}`,"--auto-install"],i=encodeURIComponent(r.join(" "));d(`/scripts/build-deploy%2FbuildBundle.sh?machines=${m}&step=3&flags=${i}`),v(!1)},V=()=>x.find(i=>i.id===m)?.name||"Unknown";return C?e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:400},children:e.jsx(fe,{sx:{color:s.primary}})}):e.jsxs(t,{sx:{p:3,minHeight:"100vh"},children:[e.jsxs(t,{sx:{...H.container,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{onClick:()=>d("/machines"),sx:{color:s.text.muted,background:"rgba(255,255,255,0.05)","&:hover":{background:"rgba(249, 115, 22, 0.1)",color:s.primary}},children:e.jsx(ke,{})}),e.jsxs(t,{children:[e.jsx(l,{sx:H.title,children:"Build Clients"}),a&&e.jsxs(l,{sx:{color:s.text.muted,fontSize:"0.9rem",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(q,{sx:{fontSize:16,color:s.primary}}),"Building on: ",e.jsx("strong",{style:{color:s.primary},children:V()})]})]})]}),e.jsx(u,{variant:"contained",startIcon:e.jsx(J,{}),onClick:()=>P(),sx:b.primary,children:"Add Client"})]}),L&&e.jsx(M,{severity:"error",sx:{mb:2},onClose:()=>I(""),children:L}),x.length===0&&e.jsx(M,{severity:"warning",sx:{mb:2},children:"No machines with 'build' or 'deploy' tags found. Add these tags to machines that can run builds."}),e.jsx(N,{container:!0,spacing:3,children:h.length===0?e.jsx(N,{item:!0,xs:12,children:e.jsxs(t,{sx:{textAlign:"center",py:8,color:s.text.muted,background:s.background.card,borderRadius:"20px",border:`1px dashed ${s.border.medium}`},children:[e.jsx(Z,{sx:{fontSize:64,mb:2,opacity:.3,color:s.primary}}),e.jsx(l,{variant:"h5",sx:{color:s.text.primary,mb:1},children:"No clients configured"}),e.jsx(l,{sx:{mb:3,color:s.text.muted},children:"Add a client to start building"}),e.jsx(u,{variant:"contained",startIcon:e.jsx(J,{}),onClick:()=>P(),sx:b.primary,children:"Add First Client"})]})}):h.map(r=>e.jsx(N,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(je,{sx:{..._.base,"&:hover":_.hover},children:[e.jsxs(ye,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(t,{sx:{width:44,height:44,borderRadius:"12px",background:f.primarySubtle,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Z,{sx:{color:s.primary,fontSize:22}})}),e.jsx(l,{variant:"h6",sx:{color:s.text.primary,fontWeight:700,fontSize:"1.1rem"},children:r.name})]}),e.jsxs(t,{sx:{display:"flex",flexWrap:"wrap",gap:.75,mb:2},children:[e.jsx(ee,{size:"small",label:`Customer: ${r.customer}`,sx:{bgcolor:"rgba(249, 115, 22, 0.1)",color:s.primary,border:`1px solid ${s.border.accent}`,fontWeight:500}}),e.jsx(ee,{size:"small",label:`Pack: ${r.pack}`,sx:{bgcolor:"rgba(34, 197, 94, 0.1)",color:s.secondary,border:`1px solid ${s.border.success}`,fontWeight:500}})]}),r.branch&&e.jsxs(l,{sx:{color:s.text.muted,fontSize:"0.85rem",fontFamily:"monospace",background:"rgba(0,0,0,0.2)",px:1.5,py:.5,borderRadius:"6px",display:"inline-block"},children:["ðŸŒ¿ ",r.branch]})]}),e.jsxs($e,{sx:{justifyContent:"space-between",px:3,pb:3,pt:0,borderTop:`1px solid ${s.border.light}`,mt:0},children:[e.jsxs(t,{sx:{display:"flex",gap:.5,pt:2},children:[e.jsx(K,{title:"Edit",children:e.jsx(T,{size:"small",onClick:()=>P(r),sx:{color:s.text.muted,"&:hover":{color:s.primary,background:"rgba(249, 115, 22, 0.1)"}},children:e.jsx(Ce,{fontSize:"small"})})}),e.jsx(K,{title:"Delete",children:e.jsx(T,{size:"small",onClick:()=>ne(r.id),sx:{color:s.text.muted,"&:hover":{color:s.error,background:"rgba(239, 68, 68, 0.1)"}},children:e.jsx(Se,{fontSize:"small"})})})]}),e.jsx(u,{variant:"contained",size:"medium",startIcon:e.jsx(F,{}),onClick:()=>ie(r),disabled:x.length===0,sx:{mt:2,background:f.secondary,fontWeight:600,px:2.5,borderRadius:"10px",boxShadow:D.glowSuccess,"&:hover":{background:"linear-gradient(135deg, #16a34a 0%, #15803d 100%)",boxShadow:"0 8px 30px rgba(34, 197, 94, 0.5)"},"&:disabled":{background:"rgba(255,255,255,0.05)",boxShadow:"none"}},children:"Build"})]})]})},r.id))}),e.jsxs(Q,{open:re,onClose:()=>S(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{background:s.background.elevated,border:`1px solid ${s.border.medium}`,borderRadius:"20px",boxShadow:D.cardElevated}},children:[e.jsx(X,{sx:{color:s.text.primary,fontWeight:700,fontSize:"1.3rem",borderBottom:`1px solid ${s.border.light}`,pb:2},children:k?"Edit Client":"Add Client"}),e.jsxs(Y,{sx:{pt:3},children:[e.jsx(j,{fullWidth:!0,label:"Client Name",value:n.name,onChange:r=>p({...n,name:r.target.value}),sx:{mt:1,mb:2.5,...y.search},placeholder:"e.g., solaire, inspire, idx"}),e.jsx(j,{fullWidth:!0,label:"Customer",value:n.customer,onChange:r=>p({...n,customer:r.target.value}),sx:{mb:2.5,...y.search},placeholder:"Customer name for build output"}),e.jsx(j,{fullWidth:!0,label:"Pack",value:n.pack,onChange:r=>p({...n,pack:r.target.value}),sx:{mb:2.5,...y.search},placeholder:"Pack name (usually same as customer)"}),e.jsx(j,{fullWidth:!0,label:"Branch",value:n.branch,onChange:r=>p({...n,branch:r.target.value}),sx:y.search,placeholder:"Git branch (default: master)"})]}),e.jsxs(se,{sx:{px:3,pb:3,pt:2,borderTop:`1px solid ${s.border.light}`},children:[e.jsx(u,{onClick:()=>S(!1),sx:{...b.secondary,px:3},variant:"outlined",children:"Cancel"}),e.jsx(u,{onClick:oe,variant:"contained",disabled:!n.name||!n.customer||!n.pack,sx:b.primary,children:"Save Client"})]})]}),e.jsxs(Q,{open:te,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{background:s.background.elevated,border:`1px solid ${s.border.medium}`,borderRadius:"20px",boxShadow:D.cardElevated}},children:[e.jsxs(X,{sx:{color:s.text.primary,fontWeight:700,fontSize:"1.3rem",borderBottom:`1px solid ${s.border.light}`,pb:2,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(t,{sx:{width:40,height:40,borderRadius:"10px",background:f.secondary,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(F,{sx:{color:"#fff",fontSize:22}})}),"Build ",w?.name]}),e.jsxs(Y,{sx:{pt:3},children:[e.jsxs(M,{severity:"info",sx:{mb:3,borderRadius:"12px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)","& .MuiAlert-icon":{color:s.info}},children:["This will run ",e.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"2px 6px",borderRadius:"4px"},children:"buildBundle.sh"})," with ",e.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"2px 6px",borderRadius:"4px"},children:"--auto-install"})," enabled."]}),e.jsx(l,{sx:{color:s.text.secondary,mb:1,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Build Machine"}),e.jsx(t,{sx:{p:2,mb:3,background:s.background.card,borderRadius:"12px",border:`1px solid ${s.border.light}`},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(t,{sx:{width:36,height:36,borderRadius:"8px",background:f.primarySubtle,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(q,{sx:{color:s.primary,fontSize:20}})}),e.jsx(l,{sx:{color:s.text.primary,fontWeight:600},children:V()})]})}),e.jsx(j,{fullWidth:!0,label:"Version",value:g,onChange:r=>U(r.target.value),placeholder:"e.g., 1.2.3",required:!0,helperText:"Version tag for this build (required)",sx:{mb:3,...y.search}}),e.jsx(l,{sx:{color:s.text.secondary,mb:1,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Build Configuration"}),e.jsx(t,{sx:{p:2,background:"rgba(0,0,0,0.3)",borderRadius:"12px",border:`1px solid ${s.border.light}`},children:e.jsxs(l,{sx:{color:s.secondary,fontFamily:"monospace",fontSize:"0.9rem",lineHeight:1.8},children:[e.jsx("span",{style:{color:s.text.muted},children:"$"})," --client=",e.jsx("span",{style:{color:s.primary},children:w?.name.toLowerCase()}),e.jsx("br",{}),e.jsx("span",{style:{color:s.text.muted},children:"$"})," --version=",e.jsx("span",{style:{color:s.primary},children:g||"<version>"}),e.jsx("br",{}),e.jsx("span",{style:{color:s.text.muted},children:"$"})," --auto-install"]})})]}),e.jsxs(se,{sx:{px:3,pb:3,pt:2,borderTop:`1px solid ${s.border.light}`},children:[e.jsx(u,{onClick:()=>v(!1),sx:{...b.secondary,px:3},variant:"outlined",children:"Cancel"}),e.jsx(u,{onClick:le,variant:"contained",startIcon:e.jsx(F,{}),disabled:!g||!m,sx:{background:f.secondary,fontWeight:700,px:3,borderRadius:"12px",boxShadow:D.glowSuccess,"&:hover":{background:"linear-gradient(135deg, #16a34a 0%, #15803d 100%)",boxShadow:"0 8px 30px rgba(34, 197, 94, 0.5)"},"&:disabled":{background:"rgba(255,255,255,0.05)",boxShadow:"none"}},children:"Start Build"})]})]})]})};export{Pe as default};
