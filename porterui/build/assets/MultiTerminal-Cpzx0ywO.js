import{c as V,j as e,r as n,B as i,T as f,g as r,h as K,l as I,m as C,b as B,w as X,X as $,M as Z,Z as E,n as N,o as W,k as q,A as Q,R as Y}from"./index-BR8HzIu-.js";import{C as ee}from"./Close-locJWJze.js";import{V as te}from"./ViewStream-CSnBEtr3.js";import{B as re}from"./Bookmark-CyBSMRtJ.js";import{D as se}from"./Delete-DwUrccAH.js";import{D as ne,o as oe}from"./xterm-9qg0Xzly.js";import{F as ie}from"./FormControlLabel-DDgFjoWt.js";import{C as ce}from"./Checkbox-DjmnloIS.js";import"./SwitchBase-CXhs4CjE.js";const le=V(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"})),ae=V(e.jsx("path",{fillRule:"evenodd",d:"M3 3v8h8V3zm6 6H5V5h4zm-6 4v8h8v-8zm6 6H5v-4h4zm4-16v8h8V3zm6 6h-4V5h4zm-6 4v8h8v-8zm6 6h-4v-4h4z"})),F=[{name:"System Info",cmd:"uname -a && cat /etc/os-release",category:"System"},{name:"Disk Usage",cmd:"df -h",category:"System"},{name:"Memory Usage",cmd:"free -h",category:"System"},{name:"CPU Info",cmd:"lscpu | head -20",category:"System"},{name:"Top Processes",cmd:"ps aux --sort=-%mem | head -10",category:"Processes"},{name:"Network Interfaces",cmd:"ip addr",category:"Network"},{name:"Open Ports",cmd:"ss -tulpn",category:"Network"},{name:"Docker Containers",cmd:"docker ps -a",category:"Docker"},{name:"Docker Images",cmd:"docker images",category:"Docker"},{name:"Service Status",cmd:"systemctl list-units --type=service --state=running",category:"Services"},{name:"Recent Logs",cmd:"journalctl -n 50 --no-pager",category:"Logs"},{name:"Uptime",cmd:"uptime",category:"System"}],de=({machine:m,onClose:R,broadcastCommand:x,broadcastId:h})=>{const c=n.useRef(null),o=n.useRef(null),g=n.useRef(null),a=n.useRef(null),[y,w]=n.useState(!1),[u,S]=n.useState(!1),z=n.useRef(0);n.useEffect(()=>{h&&h!==z.current&&x&&(z.current=h,a.current&&a.current.readyState===WebSocket.OPEN&&a.current.send(x+`
`))},[x,h]);const v=n.useCallback(()=>{a.current&&a.current.close(),S(!0),w(!1),o.current&&(o.current.clear(),o.current.write("\x1B[33mConnecting to "+m.ip+`...\x1B[0m\r
`));const d=o.current?.cols||80,p=o.current?.rows||24,b=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/machines/${m.id}/terminal/ws?shell=fish&cols=${d}&rows=${p}`,j=new WebSocket(b);a.current=j,j.binaryType="arraybuffer",j.onopen=()=>{S(!1),w(!0),o.current&&o.current.clear()},j.onmessage=T=>{if(o.current)if(T.data instanceof ArrayBuffer){const M=new TextDecoder().decode(T.data);o.current.write(M)}else o.current.write(T.data)},j.onerror=()=>{S(!1),w(!1),o.current&&o.current.write(`\r
\x1B[31mConnection error\x1B[0m\r
`)},j.onclose=()=>{S(!1),w(!1),o.current&&o.current.write(`\r
\x1B[33mConnection closed\x1B[0m\r
`)}},[m]);return n.useEffect(()=>{const d=new ne({cursorBlink:!0,cursorStyle:"block",fontSize:12,fontFamily:'"JetBrains Mono", "Fira Code", "Cascadia Code", Menlo, Monaco, monospace',theme:{background:"#0d0d0d",foreground:"#e4e4e7",cursor:"#f97316",cursorAccent:"#0d0d0d",selectionBackground:"rgba(249, 115, 22, 0.3)",black:"#18181b",red:"#ef4444",green:"#22c55e",yellow:"#eab308",blue:"#3b82f6",magenta:"#a855f7",cyan:"#06b6d4",white:"#e4e4e7"},allowTransparency:!0,scrollback:5e3});g.current=new oe,d.loadAddon(g.current),c.current&&(d.open(c.current),g.current.fit()),o.current=d,d.onData(b=>{a.current&&a.current.readyState===WebSocket.OPEN&&a.current.send(b)}),v();const p=()=>{g.current&&g.current.fit()};window.addEventListener("resize",p);const k=new ResizeObserver(p);return c.current&&k.observe(c.current),()=>{window.removeEventListener("resize",p),k.disconnect(),a.current&&a.current.close(),d.dispose()}},[v]),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",height:"100%",border:`1px solid ${r.border.light}`,borderRadius:1,overflow:"hidden",background:"#0d0d0d"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:1.5,py:.5,background:"rgba(255,255,255,0.03)",borderBottom:`1px solid ${r.border.light}`},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{sx:{width:8,height:8,borderRadius:"50%",background:y?r.secondary:u?r.primary:r.error}}),e.jsx(f,{sx:{color:r.text.primary,fontSize:"0.8rem",fontWeight:600},children:m.name}),e.jsx(f,{sx:{color:r.text.muted,fontSize:"0.7rem"},children:m.ip})]}),e.jsxs(i,{sx:{display:"flex",gap:.5},children:[e.jsx(I,{title:"Reconnect",children:e.jsx(C,{size:"small",onClick:v,sx:{color:r.text.muted,p:.5},children:e.jsx(Y,{sx:{fontSize:16}})})}),e.jsx(I,{title:"Close",children:e.jsx(C,{size:"small",onClick:()=>R(m.id),sx:{color:r.text.muted,p:.5},children:e.jsx(ee,{sx:{fontSize:16}})})})]})]}),e.jsx(i,{ref:c,sx:{flex:1,"& .xterm":{height:"100%",padding:"4px"},"& .xterm-viewport":{overflow:"hidden !important"}}})]})},be=()=>{const[m,R]=n.useState([]),[x,h]=n.useState([]),[c,o]=n.useState([]),[g,a]=n.useState(null),[y,w]=n.useState(!0),[u,S]=n.useState(""),[z,v]=n.useState({cmd:"",id:0}),[d,p]=n.useState([]),[k,b]=n.useState(null),[j,T]=n.useState(!0);n.useEffect(()=>{const t=localStorage.getItem("terminalSnippets");if(t)try{p(JSON.parse(t))}catch{}},[]);const M=()=>{if(!u.trim())return;const t=prompt("Enter snippet name:");if(!t)return;const s=[...d,{name:t,cmd:u,category:"Custom"}];p(s),localStorage.setItem("terminalSnippets",JSON.stringify(s))},L=t=>{const s=d.filter((l,D)=>D!==t);p(s),localStorage.setItem("terminalSnippets",JSON.stringify(s))},P=t=>{S(t),b(null)};[...F,...d],n.useEffect(()=>{fetch("/api/machines").then(t=>t.json()).then(t=>R(t||[])).catch(t=>a(t.message))},[]);const O=t=>{h(s=>s.includes(t)?s.filter(l=>l!==t):[...s,t])},H=()=>{x.length===m.length?h([]):h(m.map(t=>t.id))},U=()=>{const t=x.filter(s=>!c.includes(s));o([...c,...t])},G=t=>{o(s=>s.filter(l=>l!==t))},J=()=>{o([])},_=()=>{const t=c.length;return t<=1?1:t<=2||t<=4?2:t<=6?3:4},A=()=>{u.trim()&&c.length>0&&(v({cmd:u,id:Date.now()}),S(""))};return e.jsxs(i,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(f,{variant:"h5",sx:{color:r.text.primary,fontWeight:700,display:"flex",alignItems:"center",gap:1},children:[e.jsx(K,{sx:{color:r.primary}}),"Multi-Machine Terminal"]}),c.length>0&&e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(I,{title:y?"List View":"Grid View",children:e.jsx(C,{onClick:()=>w(!y),sx:{color:r.text.muted},children:y?e.jsx(te,{}):e.jsx(ae,{})})}),e.jsx(B,{size:"small",color:"error",onClick:J,children:"Close All"})]})]}),g&&e.jsx(X,{severity:"error",sx:{mb:2},children:g}),e.jsxs(i,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[e.jsxs($,{sx:{background:r.background.card,border:`1px solid ${r.border.light}`,p:2,width:220,flexShrink:0,display:"flex",flexDirection:"column"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(f,{sx:{color:r.text.primary,fontWeight:600,fontSize:"0.9rem"},children:"Machines"}),e.jsx(B,{size:"small",onClick:H,sx:{fontSize:"0.7rem",minWidth:0,p:.5},children:x.length===m.length?"None":"All"})]}),e.jsx(i,{sx:{flex:1,overflow:"auto",mb:1},children:m.map(t=>e.jsx(ie,{control:e.jsx(ce,{checked:x.includes(t.id),onChange:()=>O(t.id),size:"small",sx:{p:.5}}),label:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(i,{sx:{width:6,height:6,borderRadius:"50%",background:c.includes(t.id)?r.secondary:r.text.disabled}}),e.jsx(f,{sx:{color:r.text.primary,fontSize:"0.8rem"},children:t.name})]}),sx:{display:"flex",mb:.5,ml:0}},t.id))}),e.jsxs(B,{variant:"contained",onClick:U,disabled:x.length===0,fullWidth:!0,size:"small",sx:{background:r.primary},children:["Connect (",x.filter(t=>!c.includes(t)).length,")"]})]}),e.jsx(i,{sx:{flex:1,minHeight:0,display:"flex",flexDirection:"column"},children:c.length===0?e.jsx(i,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",border:`1px dashed ${r.border.light}`,borderRadius:1},children:e.jsx(f,{sx:{color:r.text.muted},children:"Select machines and click Connect to start terminal sessions"})}):e.jsxs(e.Fragment,{children:[e.jsxs($,{sx:{display:"flex",gap:1,p:1,mb:1,background:"#0d0d0d",border:`1px solid ${r.border.light}`,borderRadius:1},children:[e.jsx(I,{title:"Command Snippets",children:e.jsx(C,{onClick:t=>b(t.currentTarget),sx:{color:"#8b5cf6"},children:e.jsx(re,{})})}),e.jsxs(Z,{anchorEl:k,open:!!k,onClose:()=>b(null),PaperProps:{sx:{background:"rgba(17, 24, 39, 0.98)",backdropFilter:"blur(20px)",border:`1px solid ${r.border.light}`,borderRadius:"12px",maxHeight:400,minWidth:280}},children:[e.jsx(f,{sx:{px:2,py:1,color:"#8b5cf6",fontWeight:600,fontSize:"0.85rem"},children:"ðŸ“‹ Command Snippets"}),e.jsx(E,{sx:{borderColor:r.border.light}}),["System","Processes","Network","Docker","Services","Logs"].map(t=>{const s=F.filter(l=>l.category===t);return s.length===0?null:[e.jsx(f,{sx:{px:2,py:.5,color:r.text.muted,fontSize:"0.7rem",textTransform:"uppercase"},children:t},`cat-${t}`),...s.map((l,D)=>e.jsx(N,{onClick:()=>P(l.cmd),sx:{py:.5},children:e.jsx(W,{primary:l.name,secondary:l.cmd.length>35?l.cmd.substring(0,35)+"...":l.cmd,primaryTypographyProps:{fontSize:"0.85rem"},secondaryTypographyProps:{fontSize:"0.7rem",fontFamily:"monospace",color:r.text.disabled}})},`${t}-${D}`))]}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(E,{sx:{borderColor:r.border.light,my:1}}),e.jsx(f,{sx:{px:2,py:.5,color:r.warning,fontSize:"0.7rem",textTransform:"uppercase"},children:"Custom"}),d.map((t,s)=>e.jsxs(N,{sx:{py:.5,display:"flex",justifyContent:"space-between"},children:[e.jsx(W,{onClick:()=>P(t.cmd),primary:t.name,secondary:t.cmd.length>30?t.cmd.substring(0,30)+"...":t.cmd,primaryTypographyProps:{fontSize:"0.85rem"},secondaryTypographyProps:{fontSize:"0.7rem",fontFamily:"monospace",color:r.text.disabled}}),e.jsx(C,{size:"small",onClick:()=>L(s),sx:{color:r.error,ml:1},children:e.jsx(se,{fontSize:"small"})})]},`custom-${s}`))]})]}),e.jsx(q,{value:u,onChange:t=>S(t.target.value),onKeyPress:t=>t.key==="Enter"&&A(),placeholder:"Type command to send to all terminals...",size:"small",fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{background:"rgba(255,255,255,0.03)",fontFamily:"monospace",fontSize:"0.9rem"}}}),e.jsx(I,{title:"Save as snippet",children:e.jsx(C,{onClick:M,disabled:!u.trim(),sx:{color:u.trim()?r.warning:r.text.disabled},children:e.jsx(Q,{})})}),e.jsx(B,{variant:"contained",onClick:A,disabled:!u.trim(),sx:{background:r.primary,minWidth:100},startIcon:e.jsx(le,{}),children:"Send All"})]}),e.jsx(i,{sx:{display:"grid",gridTemplateColumns:y?`repeat(${_()}, 1fr)`:"1fr",gap:1,flex:1,overflow:"auto"},children:c.map(t=>{const s=m.find(l=>l.id===t);return s?e.jsx(i,{sx:{minHeight:y?250:300,height:y?"100%":"auto"},children:e.jsx(de,{machine:s,onClose:G,broadcastCommand:z.cmd,broadcastId:z.id})},t):null})})]})})]})]})};export{be as default};
