import{c as z,j as e,r as a,B as c,T as D,g as t,aN as E,l as f,m as g,R as P,b as d,A as B,w as L,X as $,D as C,x as T,y as v,k as p,n as J}from"./index-DfzNkgux.js";import{D as U}from"./Delete-CUPdazwc.js";import{T as V,a as X,b as S,c as l,d as q}from"./TableRow-BYmGTLOU.js";import{D as K}from"./DialogActions-BlQbCahF.js";const w=z(e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"})),ee=()=>{const[b,H]=a.useState([]),[_,A]=a.useState([]),[I,x]=a.useState(!1),[M,h]=a.useState(!1),[k,W]=a.useState(null),[u,n]=a.useState(null),[r,m]=a.useState({name:"",public_key:""}),[o,j]=a.useState({machine_id:"",user:""}),y=async()=>{try{const[s,i]=await Promise.all([fetch("/api/ssh-keys"),fetch("/api/machines")]);H(await s.json()||[]),A(await i.json()||[])}catch(s){console.error("Failed to load data:",s)}};a.useEffect(()=>{y()},[]);const O=async()=>{try{await fetch("/api/ssh-keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),x(!1),m({name:"",public_key:""}),y(),n({type:"success",text:"SSH key added successfully"})}catch{n({type:"error",text:"Failed to add SSH key"})}},F=async s=>{if(window.confirm("Delete this SSH key?"))try{await fetch(`/api/ssh-keys/${s}`,{method:"DELETE"}),y(),n({type:"success",text:"SSH key deleted"})}catch{n({type:"error",text:"Failed to delete SSH key"})}},N=async()=>{try{const i=await(await fetch(`/api/machines/${o.machine_id}/ssh-keys/deploy`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key_id:k.id,user:o.user})})).json();h(!1),j({machine_id:"",user:""}),i.success?n({type:"success",text:i.message}):n({type:"error",text:i.error})}catch{n({type:"error",text:"Failed to deploy SSH key"})}},R=s=>{W(s),h(!0)};return e.jsxs(c,{sx:{p:3},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(D,{variant:"h5",sx:{color:t.text.primary,fontWeight:700,display:"flex",alignItems:"center",gap:1},children:[e.jsx(E,{sx:{color:t.primary}}),"SSH Key Manager"]}),e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(f,{title:"Refresh",children:e.jsx(g,{onClick:y,sx:{color:t.text.muted},children:e.jsx(P,{})})}),e.jsx(d,{variant:"contained",startIcon:e.jsx(B,{}),onClick:()=>x(!0),sx:{background:t.primary},children:"Add SSH Key"})]})]}),u&&e.jsx(L,{severity:u.type,onClose:()=>n(null),sx:{mb:2},children:u.text}),e.jsx($,{sx:{background:t.background.card,border:`1px solid ${t.border.light}`},children:e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs(S,{children:[e.jsx(l,{sx:{color:t.text.muted},children:"Name"}),e.jsx(l,{sx:{color:t.text.muted},children:"Fingerprint"}),e.jsx(l,{sx:{color:t.text.muted},children:"Created"}),e.jsx(l,{sx:{color:t.text.muted},children:"Actions"})]})}),e.jsxs(q,{children:[b.map(s=>e.jsxs(S,{children:[e.jsx(l,{sx:{color:t.text.primary,fontWeight:500},children:s.name}),e.jsx(l,{sx:{color:t.text.muted,fontFamily:"monospace",fontSize:"0.85rem"},children:s.fingerprint}),e.jsx(l,{sx:{color:t.text.secondary,fontSize:"0.85rem"},children:new Date(s.created_at).toLocaleDateString()}),e.jsxs(l,{children:[e.jsx(f,{title:"Deploy to Machine",children:e.jsx(g,{size:"small",onClick:()=>R(s),sx:{color:t.secondary},children:e.jsx(w,{})})}),e.jsx(f,{title:"Delete",children:e.jsx(g,{size:"small",onClick:()=>F(s.id),sx:{color:t.error},children:e.jsx(U,{})})})]})]},s.id)),b.length===0&&e.jsx(S,{children:e.jsx(l,{colSpan:4,sx:{textAlign:"center",color:t.text.muted,py:4},children:"No SSH keys configured. Add a key to get started."})})]})]})}),e.jsxs(C,{open:I,onClose:()=>x(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(T,{children:"Add SSH Key"}),e.jsx(v,{children:e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(p,{label:"Key Name",value:r.name,onChange:s=>m({...r,name:s.target.value}),fullWidth:!0,placeholder:"My SSH Key"}),e.jsx(p,{label:"Public Key",value:r.public_key,onChange:s=>m({...r,public_key:s.target.value}),fullWidth:!0,multiline:!0,rows:4,placeholder:"ssh-rsa AAAA... user@host",helperText:"Paste your public key (usually from ~/.ssh/id_rsa.pub)"})]})}),e.jsxs(K,{children:[e.jsx(d,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:O,disabled:!r.name||!r.public_key,children:"Add Key"})]})]}),e.jsxs(C,{open:M,onClose:()=>h(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(T,{children:"Deploy SSH Key"}),e.jsxs(v,{children:[e.jsxs(D,{sx:{color:t.text.secondary,mb:2},children:['Deploy "',k?.name,`" to a machine's authorized_keys file.`]}),e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(p,{select:!0,label:"Target Machine",value:o.machine_id,onChange:s=>j({...o,machine_id:s.target.value}),fullWidth:!0,children:_.map(s=>e.jsxs(J,{value:s.id,children:[s.name," (",s.ip,")"]},s.id))}),e.jsx(p,{label:"User (optional)",value:o.user,onChange:s=>j({...o,user:s.target.value}),fullWidth:!0,placeholder:"Leave empty to use machine's default user"})]})]}),e.jsxs(K,{children:[e.jsx(d,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:N,disabled:!o.machine_id,startIcon:e.jsx(w,{}),children:"Deploy"})]})]})]})};export{ee as default};
