import{r as l,j as e,B as a,T as r,a4 as Se,a5 as ve,a2 as ke,n as we,m as x,R as ze,e as I,f as D,a3 as A,N as Y,X as u,k as M,I as Ie,S as De,b as p,C as N,l as g,P as We,h as Te,D as B,x as O,y as V}from"./index-C5leRk9Z.js";import{S as Pe}from"./Stop-BGPcwTs1.js";import{R as $e}from"./RestartAlt-BVgDv0Vr.js";import{D as Z}from"./Delete-72qyEOoG.js";import{A as Le}from"./Article-DQ2NB291.js";import{C as Fe}from"./CloudDownload-CZUTwUL9.js";import{S as G}from"./Storage-Ck4ud2Qk.js";import{M as Re}from"./Memory-Dh06HvTo.js";import{G as k}from"./Grid-Ff5obvXY.js";import{T as Ee,a as W}from"./Tab-CdVt0qpR.js";import{T,a as P,b as h,c as n,d as $}from"./TableRow-DCwuPQsO.js";import{C as _}from"./Chip-DbK6i-5d.js";import{D as H}from"./DialogActions-BnIfk71z.js";import{L as Ae}from"./LinearProgress-LvlAHztZ.js";const Ze=()=>{const[ee,se]=l.useState([]),[t,ne]=l.useState(""),[b,oe]=l.useState(0),[L,J]=l.useState(!1),[y,re]=l.useState(""),[K,w]=l.useState({}),[U,te]=l.useState([]),[X,ie]=l.useState([]),[q,le]=l.useState([]),[F,ae]=l.useState([]),[C,ce]=l.useState(null),[R,S]=l.useState({open:!1,container:null,logs:""}),[m,j]=l.useState({open:!1,container:null,command:"",output:""}),[c,d]=l.useState({open:!1,image:"",pulling:!1,progress:""});l.useEffect(()=>{fetch("/api/machines").then(s=>s.json()).then(s=>se(s||[])).catch(console.error)},[]);const f=l.useCallback(async()=>{if(t){J(!0);try{const[s,o,i,v,E]=await Promise.all([fetch(`/api/machines/${t}/docker/containers`),fetch(`/api/machines/${t}/docker/images`),fetch(`/api/machines/${t}/docker/volumes`),fetch(`/api/machines/${t}/docker/networks`),fetch(`/api/machines/${t}/docker/info`)]),[ue,pe,be,ye,Ce]=await Promise.all([s.json(),o.json(),i.json(),v.json(),E.json()]);te(ue.containers||[]),ie(pe.images||[]),le(be.volumes||[]),ae(ye.networks||[]),ce(Ce)}catch(s){console.error("Failed to load Docker data:",s)}finally{J(!1)}}},[t]);l.useEffect(()=>{t&&f()},[t,f]);const z=async(s,o)=>{w(i=>({...i,[s]:o}));try{await fetch(`/api/machines/${t}/docker/container/${s}/${o}`,{method:"POST"}),setTimeout(f,1e3)}catch(i){console.error(`Failed to ${o} container:`,i)}finally{w(i=>({...i,[s]:null}))}},de=async(s,o)=>{S({open:!0,container:o,logs:""});try{const v=await(await fetch(`/api/machines/${t}/docker/container/${s}/logs?lines=200`)).json();S(E=>({...E,logs:v.logs||"No logs available"}))}catch(i){S(v=>({...v,logs:"Failed to load logs: "+i.message}))}},Q=async()=>{if(m.command.trim())try{const o=await(await fetch(`/api/machines/${t}/docker/container/${m.container}/exec`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:m.command})})).json();j(i=>({...i,output:o.output||o.error||"No output"}))}catch(s){j(o=>({...o,output:"Error: "+s.message}))}},xe=async()=>{if(c.image.trim()){d(s=>({...s,pulling:!0,progress:"Pulling image..."}));try{const o=await(await fetch(`/api/machines/${t}/docker/pull`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:c.image})})).json();d(i=>({...i,progress:o.success?"Image pulled successfully!":"Failed: "+o.error})),o.success&&setTimeout(f,1e3)}catch(s){d(o=>({...o,progress:"Error: "+s.message}))}finally{d(s=>({...s,pulling:!1}))}}},he=async s=>{if(window.confirm("Are you sure you want to delete this image?")){w(o=>({...o,[s]:"delete"}));try{await fetch(`/api/machines/${t}/docker/image/${s}`,{method:"DELETE"}),setTimeout(f,500)}catch(o){console.error("Failed to delete image:",o)}finally{w(o=>({...o,[s]:null}))}}},me=s=>s?.includes("Up")||s==="running"?"success":s?.includes("Exited")||s==="exited"?"error":"warning",ge=s=>{if(!s)return"-";const o=["B","KB","MB","GB"];let i=0;for(;s>=1024&&i<o.length-1;)s/=1024,i++;return`${s.toFixed(1)} ${o[i]}`},je=U.filter(s=>s.name?.toLowerCase().includes(y.toLowerCase())||s.image?.toLowerCase().includes(y.toLowerCase())),fe=X.filter(s=>s.repository?.toLowerCase().includes(y.toLowerCase())||s.tag?.toLowerCase().includes(y.toLowerCase()));return e.jsxs(a,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(r,{variant:"h4",sx:{fontWeight:700},children:"Docker Manager"}),e.jsxs(a,{sx:{display:"flex",gap:2},children:[e.jsxs(Se,{size:"small",sx:{minWidth:200},children:[e.jsx(ve,{children:"Machine"}),e.jsx(ke,{value:t,onChange:s=>ne(s.target.value),label:"Machine",children:ee.map(s=>e.jsx(we,{value:s.id,children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:s.status==="online"?"#22c55e":"#ff3366"}}),s.name]})},s.id))})]}),e.jsx(x,{onClick:f,disabled:!t||L,children:e.jsx(ze,{sx:{color:L?"grey":"#f97316"}})})]})]}),t&&C&&e.jsxs(k,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(k,{item:!0,xs:12,md:3,children:e.jsx(I,{sx:{background:"linear-gradient(135deg, rgba(0,212,255,0.1) 0%, rgba(0,255,136,0.05) 100%)"},children:e.jsxs(D,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(A,{sx:{color:"#f97316"}}),e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Containers"})]}),e.jsxs(r,{variant:"h4",sx:{fontWeight:700},children:[C.containersRunning||0,e.jsxs(r,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:1},children:["/ ",C.containers||0]})]})]})})}),e.jsx(k,{item:!0,xs:12,md:3,children:e.jsx(I,{sx:{background:"linear-gradient(135deg, rgba(255,0,255,0.1) 0%, rgba(0,212,255,0.05) 100%)"},children:e.jsxs(D,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(G,{sx:{color:"#ff00ff"}}),e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Images"})]}),e.jsx(r,{variant:"h4",sx:{fontWeight:700},children:C.images||0})]})})}),e.jsx(k,{item:!0,xs:12,md:3,children:e.jsx(I,{sx:{background:"linear-gradient(135deg, rgba(0,255,136,0.1) 0%, rgba(0,212,255,0.05) 100%)"},children:e.jsxs(D,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Re,{sx:{color:"#22c55e"}}),e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Memory"})]}),e.jsx(r,{variant:"h4",sx:{fontWeight:700},children:ge(C.memoryUsed)})]})})}),e.jsx(k,{item:!0,xs:12,md:3,children:e.jsx(I,{sx:{background:"linear-gradient(135deg, rgba(255,170,0,0.1) 0%, rgba(255,0,255,0.05) 100%)"},children:e.jsxs(D,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Y,{sx:{color:"#ffaa00"}}),e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Networks"})]}),e.jsx(r,{variant:"h4",sx:{fontWeight:700},children:F.length})]})})})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:{p:2,mb:3},children:e.jsxs(a,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(M,{size:"small",placeholder:"Search...",value:y,onChange:s=>re(s.target.value),InputProps:{startAdornment:e.jsx(Ie,{position:"start",children:e.jsx(De,{sx:{color:"rgba(255,255,255,0.5)"}})})},sx:{minWidth:250}}),e.jsx(a,{sx:{flex:1}}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(Fe,{}),onClick:()=>d({open:!0,image:"",pulling:!1,progress:""}),children:"Pull Image"})]})}),e.jsxs(Ee,{value:b,onChange:(s,o)=>oe(o),sx:{mb:2},children:[e.jsx(W,{label:`Containers (${U.length})`,icon:e.jsx(A,{}),iconPosition:"start"}),e.jsx(W,{label:`Images (${X.length})`,icon:e.jsx(G,{}),iconPosition:"start"}),e.jsx(W,{label:`Volumes (${q.length})`,icon:e.jsx(G,{}),iconPosition:"start"}),e.jsx(W,{label:`Networks (${F.length})`,icon:e.jsx(Y,{}),iconPosition:"start"})]}),L?e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(N,{})}):e.jsxs(e.Fragment,{children:[b===0&&e.jsx(u,{sx:{overflow:"hidden"},children:e.jsxs(T,{size:"small",children:[e.jsx(P,{children:e.jsxs(h,{sx:{bgcolor:"rgba(0,212,255,0.05)"},children:[e.jsx(n,{sx:{fontWeight:600},children:"Status"}),e.jsx(n,{sx:{fontWeight:600},children:"Name"}),e.jsx(n,{sx:{fontWeight:600},children:"Image"}),e.jsx(n,{sx:{fontWeight:600},children:"Ports"}),e.jsx(n,{sx:{fontWeight:600},children:"Created"}),e.jsx(n,{sx:{fontWeight:600,textAlign:"right"},children:"Actions"})]})}),e.jsx($,{children:je.map(s=>e.jsxs(h,{sx:{"&:hover":{bgcolor:"rgba(0,212,255,0.03)"}},children:[e.jsx(n,{children:e.jsx(_,{label:s.state||s.status?.split(" ")[0],size:"small",color:me(s.status),sx:{fontSize:"0.7rem"}})}),e.jsx(n,{children:e.jsx(r,{sx:{fontFamily:"monospace",fontSize:"0.85rem"},children:s.name})}),e.jsx(n,{children:e.jsx(r,{variant:"body2",color:"text.secondary",children:s.image})}),e.jsx(n,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem"},children:s.ports||"-"})}),e.jsx(n,{children:e.jsx(r,{variant:"body2",color:"text.secondary",children:s.created})}),e.jsx(n,{children:e.jsxs(a,{sx:{display:"flex",gap:.5,justifyContent:"flex-end"},children:[e.jsx(g,{title:"Start",children:e.jsx(x,{size:"small",onClick:()=>z(s.id,"start"),children:e.jsx(We,{sx:{fontSize:18,color:"#22c55e"}})})}),e.jsx(g,{title:"Stop",children:e.jsx(x,{size:"small",onClick:()=>z(s.id,"stop"),children:e.jsx(Pe,{sx:{fontSize:18,color:"#ff6b6b"}})})}),e.jsx(g,{title:"Restart",children:e.jsx(x,{size:"small",onClick:()=>z(s.id,"restart"),children:e.jsx($e,{sx:{fontSize:18,color:"#ffaa00"}})})}),e.jsx(g,{title:"Logs",children:e.jsx(x,{size:"small",onClick:()=>de(s.id,s.name),children:e.jsx(Le,{sx:{fontSize:18,color:"#f97316"}})})}),e.jsx(g,{title:"Exec",children:e.jsx(x,{size:"small",onClick:()=>j({open:!0,container:s.id,command:"",output:""}),children:e.jsx(Te,{sx:{fontSize:18,color:"#ff00ff"}})})}),e.jsx(g,{title:"Remove",children:e.jsx(x,{size:"small",onClick:()=>z(s.id,"remove"),children:e.jsx(Z,{sx:{fontSize:18,color:"#ff3366"}})})})]})})]},s.id))})]})}),b===1&&e.jsx(u,{sx:{overflow:"hidden"},children:e.jsxs(T,{size:"small",children:[e.jsx(P,{children:e.jsxs(h,{sx:{bgcolor:"rgba(0,212,255,0.05)"},children:[e.jsx(n,{sx:{fontWeight:600},children:"Repository"}),e.jsx(n,{sx:{fontWeight:600},children:"Tag"}),e.jsx(n,{sx:{fontWeight:600},children:"ID"}),e.jsx(n,{sx:{fontWeight:600},children:"Size"}),e.jsx(n,{sx:{fontWeight:600},children:"Created"}),e.jsx(n,{sx:{fontWeight:600,textAlign:"right"},children:"Actions"})]})}),e.jsx($,{children:fe.map(s=>e.jsxs(h,{sx:{"&:hover":{bgcolor:"rgba(0,212,255,0.03)"}},children:[e.jsx(n,{children:e.jsx(r,{sx:{fontFamily:"monospace",fontSize:"0.85rem"},children:s.repository||"<none>"})}),e.jsx(n,{children:e.jsx(_,{label:s.tag||"latest",size:"small",variant:"outlined"})}),e.jsx(n,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem"},children:s.id?.substring(0,12)})}),e.jsx(n,{children:s.size}),e.jsx(n,{children:e.jsx(r,{variant:"body2",color:"text.secondary",children:s.created})}),e.jsx(n,{children:e.jsx(a,{sx:{display:"flex",gap:.5,justifyContent:"flex-end"},children:e.jsx(g,{title:"Delete",children:e.jsx(x,{size:"small",onClick:()=>he(s.id),disabled:K[s.id]==="delete",children:K[s.id]==="delete"?e.jsx(N,{size:16}):e.jsx(Z,{sx:{fontSize:18,color:"#ff3366"}})})})})})]},s.id))})]})}),b===2&&e.jsx(u,{sx:{overflow:"hidden"},children:e.jsxs(T,{size:"small",children:[e.jsx(P,{children:e.jsxs(h,{sx:{bgcolor:"rgba(0,212,255,0.05)"},children:[e.jsx(n,{sx:{fontWeight:600},children:"Name"}),e.jsx(n,{sx:{fontWeight:600},children:"Driver"}),e.jsx(n,{sx:{fontWeight:600},children:"Mountpoint"})]})}),e.jsx($,{children:q.map(s=>e.jsxs(h,{sx:{"&:hover":{bgcolor:"rgba(0,212,255,0.03)"}},children:[e.jsx(n,{children:e.jsx(r,{sx:{fontFamily:"monospace",fontSize:"0.85rem"},children:s.name})}),e.jsx(n,{children:s.driver}),e.jsx(n,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem"},children:s.mountpoint})})]},s.name))})]})}),b===3&&e.jsx(u,{sx:{overflow:"hidden"},children:e.jsxs(T,{size:"small",children:[e.jsx(P,{children:e.jsxs(h,{sx:{bgcolor:"rgba(0,212,255,0.05)"},children:[e.jsx(n,{sx:{fontWeight:600},children:"Name"}),e.jsx(n,{sx:{fontWeight:600},children:"Driver"}),e.jsx(n,{sx:{fontWeight:600},children:"Scope"}),e.jsx(n,{sx:{fontWeight:600},children:"Subnet"})]})}),e.jsx($,{children:F.map(s=>e.jsxs(h,{sx:{"&:hover":{bgcolor:"rgba(0,212,255,0.03)"}},children:[e.jsx(n,{children:e.jsx(r,{sx:{fontFamily:"monospace",fontSize:"0.85rem"},children:s.name})}),e.jsx(n,{children:s.driver}),e.jsx(n,{children:s.scope}),e.jsx(n,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem"},children:s.subnet||"-"})})]},s.id))})]})})]})]}),!t&&e.jsxs(u,{sx:{p:6,textAlign:"center"},children:[e.jsx(A,{sx:{fontSize:64,color:"rgba(255,255,255,0.1)",mb:2}}),e.jsx(r,{color:"text.secondary",children:"Select a machine to manage Docker containers"})]}),e.jsxs(B,{open:R.open,onClose:()=>S({open:!1,container:null,logs:""}),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(O,{children:["Container Logs: ",R.container]}),e.jsx(V,{children:e.jsx(a,{sx:{bgcolor:"#0d1117",p:2,borderRadius:1,fontFamily:"monospace",fontSize:"0.8rem",maxHeight:500,overflow:"auto",whiteSpace:"pre-wrap",color:"#e0f7ff"},children:R.logs||"Loading..."})}),e.jsx(H,{children:e.jsx(p,{onClick:()=>S({open:!1,container:null,logs:""}),children:"Close"})})]}),e.jsxs(B,{open:m.open,onClose:()=>j({open:!1,container:null,command:"",output:""}),maxWidth:"md",fullWidth:!0,children:[e.jsx(O,{children:"Execute Command in Container"}),e.jsxs(V,{children:[e.jsx(M,{fullWidth:!0,label:"Command",value:m.command,onChange:s=>j(o=>({...o,command:s.target.value})),placeholder:"e.g., ls -la /app",sx:{mt:1,mb:2},onKeyPress:s=>s.key==="Enter"&&Q()}),m.output&&e.jsx(a,{sx:{bgcolor:"#0d1117",p:2,borderRadius:1,fontFamily:"monospace",fontSize:"0.8rem",maxHeight:300,overflow:"auto",whiteSpace:"pre-wrap",color:"#e0f7ff"},children:m.output})]}),e.jsxs(H,{children:[e.jsx(p,{onClick:()=>j({open:!1,container:null,command:"",output:""}),children:"Close"}),e.jsx(p,{variant:"contained",onClick:Q,children:"Execute"})]})]}),e.jsxs(B,{open:c.open,onClose:()=>!c.pulling&&d({open:!1,image:"",pulling:!1,progress:""}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(O,{children:"Pull Docker Image"}),e.jsxs(V,{children:[e.jsx(M,{fullWidth:!0,label:"Image",value:c.image,onChange:s=>d(o=>({...o,image:s.target.value})),placeholder:"e.g., nginx:latest, ubuntu:22.04",sx:{mt:1},disabled:c.pulling}),c.progress&&e.jsxs(a,{sx:{mt:2},children:[c.pulling&&e.jsx(Ae,{sx:{mb:1}}),e.jsx(r,{variant:"body2",color:c.progress.includes("success")?"success.main":"text.secondary",children:c.progress})]})]}),e.jsxs(H,{children:[e.jsx(p,{onClick:()=>d({open:!1,image:"",pulling:!1,progress:""}),disabled:c.pulling,children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:xe,disabled:c.pulling||!c.image.trim(),children:c.pulling?e.jsx(N,{size:20}):"Pull"})]})]})]})};export{Ze as default};
