import{ab as N,u as O,r as l,j as e,B as r,C as g,g as t,T as i,b as p,m as v,h as _,R as A,G as L}from"./index-DHdDvhkS.js";import{A as W}from"./ArrowBack-CQ5LHZeB.js";import{C as U}from"./CheckCircle-DQaCvPPh.js";import{H as I}from"./HourglassEmpty-D6YIP5_m.js";import{V}from"./ViewStream-CuiJkVN6.js";import{C as G}from"./Chip-CqU9Trdn.js";import{L as K}from"./LinearProgress-DR6EjOe8.js";import{T as q,a as z}from"./Tab-B_PS6_3A.js";const oe=()=>{const[R]=N(),u=O(),f=R.get("id"),[n,B]=l.useState(null),[b,T]=l.useState(""),[a,E]=l.useState([]),[D,F]=l.useState(!0),[j,M]=l.useState(0),[x,P]=l.useState(!0),d=l.useRef(null),c=l.useRef(null);l.useEffect(()=>{if(!f){u("/build-clients");return}return h(),c.current=setInterval(()=>{h()},2e3),()=>{c.current&&clearInterval(c.current)}},[f]),l.useEffect(()=>{x&&d.current&&(d.current.scrollTop=d.current.scrollHeight)},[b,x]);const h=async()=>{try{const s=await fetch(`/api/history/${f}`);if(!s.ok)throw new Error("Failed to load execution");const o=await s.json();B(o),T(o.output||""),E(o.stages||[]),(o.status==="completed"||o.status==="failed")&&c.current&&(clearInterval(c.current),c.current=null)}catch(s){console.error("Failed to load execution:",s)}finally{F(!1)}},y=s=>{switch(s){case"completed":case"success":return e.jsx(U,{sx:{color:"#22c55e"}});case"failed":case"error":return e.jsx(L,{sx:{color:"#ff4466"}});case"running":return e.jsx(g,{size:20,sx:{color:"#f97316"}});default:return e.jsx(I,{sx:{color:"rgba(255,255,255,0.5)"}})}},S=s=>{switch(s){case"completed":case"success":return"#22c55e";case"failed":case"error":return"#ff4466";case"running":return"#f97316";default:return"rgba(255,255,255,0.5)"}},$=s=>{if(!s)return"-";const o=Math.floor(s/1e3),k=Math.floor(o/60),H=o%60;return k>0?`${k}m ${H}s`:`${o}s`};if(D)return e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:400},children:e.jsx(g,{sx:{color:t.primary}})});if(!n)return e.jsxs(r,{sx:{p:3,textAlign:"center"},children:[e.jsx(i,{sx:{color:t.text.muted},children:"Execution not found"}),e.jsx(p,{onClick:()=>u("/build-clients"),sx:{mt:2},children:"Back to Build Clients"})]});const m=n.status==="running",w=a.filter(s=>s.status==="completed"||s.status==="success").length,C=a.length>0?w/a.length*100:0;return e.jsxs(r,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,pb:2,borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(v,{onClick:()=>u("/build-clients"),sx:{color:t.text.muted},children:e.jsx(W,{})}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(i,{variant:"h5",sx:{color:t.text.primary,display:"flex",alignItems:"center",gap:1},children:[y(n.status),"Build Output"]}),e.jsxs(i,{sx:{color:t.text.muted,fontSize:"0.85rem"},children:[n.script_path," • ",n.machine_name||"Unknown Machine"]})]}),e.jsx(G,{label:n.status?.toUpperCase()||"UNKNOWN",sx:{bgcolor:`${S(n.status)}20`,color:S(n.status),fontWeight:600}}),m&&e.jsx(g,{size:24,sx:{color:t.primary}})]}),a.length>0&&e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(i,{sx:{color:t.text.muted,fontSize:"0.85rem"},children:["Progress: ",w," / ",a.length," stages"]}),e.jsxs(i,{sx:{color:t.text.muted,fontSize:"0.85rem"},children:[Math.round(C),"%"]})]}),e.jsx(K,{variant:"determinate",value:C,sx:{height:8,borderRadius:4,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{bgcolor:m?t.primary:n.status==="completed"?"#22c55e":"#ff4466",borderRadius:4}}})]}),e.jsx(r,{sx:{borderBottom:1,borderColor:"rgba(255,255,255,0.1)",mb:2},children:e.jsxs(q,{value:j,onChange:(s,o)=>M(o),sx:{"& .MuiTab-root":{color:t.text.muted},"& .Mui-selected":{color:t.primary},"& .MuiTabs-indicator":{bgcolor:t.primary}},children:[e.jsx(z,{icon:e.jsx(V,{}),iconPosition:"start",label:"Stages"}),e.jsx(z,{icon:e.jsx(_,{}),iconPosition:"start",label:"Raw Output"})]})}),e.jsx(r,{sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:j===0?e.jsx(r,{sx:{flex:1,overflow:"auto",...J},children:a.length===0?e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:t.text.muted},children:[e.jsx(I,{sx:{fontSize:48,mb:2,opacity:.5}}),e.jsx(i,{children:"No stages detected yet"}),e.jsx(i,{sx:{fontSize:"0.85rem",mt:1},children:"Stages will appear as the build progresses"})]}):e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:a.map((s,o)=>e.jsxs(r,{sx:{p:2,borderRadius:2,bgcolor:"rgba(255,255,255,0.03)",border:`1px solid ${s.status==="running"?t.primary:"rgba(255,255,255,0.1)"}`,transition:"all 0.2s"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[y(s.status),e.jsxs(r,{sx:{flex:1},children:[e.jsx(i,{sx:{color:t.text.primary,fontWeight:500,fontFamily:"monospace"},children:s.name||`Stage ${o+1}`}),s.description&&e.jsx(i,{sx:{color:t.text.muted,fontSize:"0.85rem"},children:s.description})]}),e.jsx(i,{sx:{color:t.text.muted,fontSize:"0.85rem",fontFamily:"monospace"},children:$(s.duration_ms)})]}),s.output&&e.jsx(r,{sx:{mt:2,p:1.5,bgcolor:"rgba(0,0,0,0.3)",borderRadius:1,fontFamily:"monospace",fontSize:"0.8rem",color:t.text.muted,whiteSpace:"pre-wrap",maxHeight:200,overflow:"auto"},children:s.output})]},o))})}):e.jsxs(r,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"flex-end",mb:1,gap:1},children:[e.jsxs(p,{size:"small",onClick:()=>P(!x),sx:{color:x?t.primary:t.text.muted,fontSize:"0.75rem"},children:["Auto-scroll: ",x?"ON":"OFF"]}),e.jsx(v,{size:"small",onClick:h,sx:{color:t.text.muted},children:e.jsx(A,{fontSize:"small"})})]}),e.jsxs(r,{ref:d,sx:{flex:1,bgcolor:"#0a0a0f",borderRadius:2,p:2,overflow:"auto",fontFamily:"monospace",fontSize:"0.85rem",lineHeight:1.6,color:"#22c55e",whiteSpace:"pre-wrap",wordBreak:"break-all",border:"1px solid rgba(255,255,255,0.1)"},children:[b||(m?"Waiting for output...":"No output available"),m&&e.jsx(r,{component:"span",sx:{display:"inline-block",width:8,height:16,bgcolor:"#22c55e",ml:.5,animation:"blink 1s infinite"}})]})]})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,pt:2,borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs(i,{sx:{color:t.text.muted,fontSize:"0.85rem"},children:["Started: ",n.started_at?new Date(n.started_at).toLocaleString():"-",n.completed_at&&` • Completed: ${new Date(n.completed_at).toLocaleString()}`]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(p,{variant:"outlined",onClick:()=>u("/build-clients"),sx:{color:t.text.muted,borderColor:"rgba(255,255,255,0.2)"},children:"Back to Build Clients"}),e.jsx(p,{variant:"outlined",onClick:()=>u("/history"),sx:{color:t.primary,borderColor:t.primary},children:"View History"})]})]}),e.jsx("style",{children:`
                @keyframes blink {
                    0%, 50% { opacity: 1; }
                    51%, 100% { opacity: 0; }
                }
            `})]})},J={"&::-webkit-scrollbar":{width:8},"&::-webkit-scrollbar-track":{background:"rgba(255,255,255,0.05)",borderRadius:4},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.2)",borderRadius:4},"&::-webkit-scrollbar-thumb:hover":{background:"rgba(255,255,255,0.3)"}};export{oe as default};
