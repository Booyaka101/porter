import{c as ge,j as e,r as u,B as r,g as t,E as _,T as n,l as G,m as J,af as me,P as Y,a7 as Ae,u as Be,ab as Le,C as ee,v as A,b as T,V as He,e as H,f as D,d as se,i as De,ag as de,a5 as ue,k as _e}from"./index-BShrJcTY.js";import{A as U}from"./ArrowBack-BTBP1l13.js";import{g as Je,p as xe,A as Ve,R as Ue,a as Ge}from"./presets-Ddgq3JD2.js";import{S as pe}from"./Stop-hSKAtcJD.js";import{C as B}from"./CheckCircle-Dkkt7TPz.js";import{W as te}from"./Warning-BYGbWMVj.js";import{S as Ye}from"./Star-Rwi2pxCS.js";import{C as re}from"./ContentCopy-DUNm48Et.js";import{H as K}from"./HourglassEmpty-BqqfKtBm.js";import{E as fe}from"./ExpandLess-N1jw3Yzt.js";import{C as E}from"./Chip-CABxJAAn.js";import{L as X}from"./LinearProgress-D_MAw9Vp.js";import{C as be}from"./Collapse-BAfJk8vK.js";import{S as Ke}from"./Switch-BibSA9a5.js";import{C as Xe}from"./Checkbox-CYcT0eQh.js";import"./SwitchBase-BPzvGv3M.js";const he=ge(e.jsx("path",{d:"M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7"})),qe=ge(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.89-2-2-2m0 16H5V7h14zm-5.5-6c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5M12 9c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"})),Qe=c=>{const w=[];let x=null,p=null;return c.forEach(I=>{const m=I.data||"",j=m.match(/^=== PLAY \[(.+)\] ===$/);if(j){x&&x.status==="running"?(x.status="success",w.push(x)):x&&w.push(x),x={name:j[1],status:"running",tasks:[],startTime:I.timestamp,logs:[]},p=null;return}const v=m.match(/^TASK \[(\d+)\] (.+)$/);if(v&&x){p={number:parseInt(v[1]),name:v[2],status:"running",logs:[]},x.tasks.push(p);return}if(m.includes("...ok")&&p){p.status="success",p=null;return}if(m.includes("...FAILED")&&p){p.status="failed",x&&(x.status="failed"),p=null;return}if(m.includes("...skipped")&&p){p.status="skipped",p=null;return}const f=m.match(/EXIT_CODE:(\d+)/);if(f){const y=parseInt(f[1]);x&&(x.status=y===0?"success":"failed",w.push(x),x=null);return}p?p.logs.push(m):x&&x.logs.push(m)}),x&&w.push(x),w},Ze=({stage:c,isLast:w})=>{const[x,p]=u.useState(c.status==="running"||c.status==="failed"),I=()=>{switch(c.status){case"success":return e.jsx(B,{sx:{color:t.secondary,fontSize:20}});case"failed":return e.jsx(_,{sx:{color:t.error,fontSize:20}});case"running":return e.jsx(K,{sx:{color:t.warning,fontSize:20,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}});default:return e.jsx(Y,{sx:{color:t.text.disabled,fontSize:20}})}},m=()=>{switch(c.status){case"success":return t.secondary;case"failed":return t.error;case"running":return t.warning;default:return t.text.disabled}},j=c.tasks.filter(y=>y.status==="success").length,v=c.tasks.filter(y=>y.status==="failed").length,f=c.tasks.length;return e.jsxs(r,{sx:{mb:1},children:[e.jsxs(r,{onClick:()=>p(!x),sx:{display:"flex",alignItems:"center",gap:1.5,p:1.5,cursor:"pointer",background:`linear-gradient(90deg, ${m()}15 0%, transparent 100%)`,borderLeft:`3px solid ${m()}`,borderRadius:"0 8px 8px 0",transition:"all 0.2s","&:hover":{background:`linear-gradient(90deg, ${m()}25 0%, transparent 100%)`}},children:[I(),e.jsx(n,{sx:{flex:1,fontWeight:600,color:t.text.primary,fontSize:"0.95rem"},children:c.name}),f>0&&e.jsxs(r,{sx:{display:"flex",gap:.5},children:[j>0&&e.jsx(E,{size:"small",label:`${j} âœ“`,sx:{height:22,fontSize:"0.75rem",background:`${t.secondary}30`,color:t.secondary}}),v>0&&e.jsx(E,{size:"small",label:`${v} âœ—`,sx:{height:22,fontSize:"0.75rem",background:`${t.error}30`,color:t.error}}),c.status==="running"&&e.jsx(E,{size:"small",label:`${j}/${f}`,sx:{height:22,fontSize:"0.75rem",background:`${t.warning}30`,color:t.warning}})]}),e.jsx(J,{size:"small",sx:{color:t.text.disabled},children:x?e.jsx(fe,{fontSize:"small"}):e.jsx(me,{fontSize:"small"})})]}),c.status==="running"&&e.jsx(X,{variant:f>0?"determinate":"indeterminate",value:f>0?j/f*100:0,sx:{height:2,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),e.jsx(be,{in:x,children:e.jsxs(r,{sx:{pl:4,pr:2,py:1},children:[c.tasks.map((y,b)=>e.jsx(es,{task:y},b)),c.logs.filter(y=>y.trim()).length>0&&e.jsx(r,{sx:{mt:1,p:1.5,background:"rgba(0,0,0,0.3)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.8rem",color:t.text.muted,maxHeight:150,overflow:"auto"},children:c.logs.filter(y=>y.trim()).map((y,b)=>e.jsx(r,{sx:{whiteSpace:"pre-wrap"},children:y},b))})]})})]})},es=({task:c})=>{const w=()=>{switch(c.status){case"success":return e.jsx(B,{sx:{color:t.secondary,fontSize:16}});case"failed":return e.jsx(_,{sx:{color:t.error,fontSize:16}});case"skipped":return e.jsx(Y,{sx:{color:t.text.disabled,fontSize:16}});case"running":return e.jsx(K,{sx:{color:t.warning,fontSize:16,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}});default:return null}},x=()=>{switch(c.status){case"success":return t.secondary;case"failed":return t.error;case"running":return t.warning;default:return t.text.disabled}};return e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,py:.5,borderLeft:`2px solid ${x()}40`,pl:1.5,mb:.5},children:[w(),e.jsx(n,{sx:{fontSize:"0.85rem",color:c.status==="failed"?t.error:t.text.secondary},children:c.name}),c.status==="failed"&&c.logs.length>0&&e.jsxs(n,{sx:{fontSize:"0.75rem",color:t.error,opacity:.8,ml:"auto"},children:[c.logs[c.logs.length-1]?.substring(0,50),"..."]})]})},ss=({events:c,status:w,machineName:x})=>{const p=u.useMemo(()=>Qe(c),[c]),I=u.useRef(null),[m,j]=u.useState(!1),[v,f]=u.useState(!1);u.useEffect(()=>{I.current&&(I.current.scrollTop=I.current.scrollHeight)},[p]);const y=()=>{const g=c.map($=>$.data).join(`
`);navigator.clipboard.writeText(g),f(!0),setTimeout(()=>f(!1),2e3)},b=()=>w==="complete"?"success":w==="error"?"failed":"running",W=()=>{switch(b()){case"success":return t.secondary;case"failed":return t.error;default:return t.warning}},P=p.filter(g=>g.status==="success").length,R=p.filter(g=>g.status==="failed").length;return e.jsxs(r,{sx:{background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",border:`1px solid ${W()}33`,overflow:"hidden"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,p:2,background:`${W()}10`,borderBottom:`1px solid ${t.border.light}`},children:[b()==="success"&&e.jsx(B,{sx:{color:t.secondary,fontSize:28}}),b()==="failed"&&e.jsx(_,{sx:{color:t.error,fontSize:28}}),b()==="running"&&e.jsx(K,{sx:{color:t.warning,fontSize:28,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(n,{sx:{color:t.text.primary,fontWeight:600,fontSize:"1.1rem"},children:x}),e.jsxs(n,{sx:{color:t.text.muted,fontSize:"0.85rem"},children:[p.length," stages â€¢ ",P," completed",R>0&&` â€¢ ${R} failed`]})]}),e.jsx(G,{title:m?"Show stages":"Show raw output",children:e.jsx(E,{label:m?"Stages":"Raw",size:"small",onClick:()=>j(!m),sx:{cursor:"pointer",background:"rgba(255,255,255,0.1)",color:t.text.secondary}})}),e.jsx(G,{title:"Copy output",children:e.jsx(J,{size:"small",onClick:y,sx:{color:v?t.secondary:t.text.disabled},children:e.jsx(re,{fontSize:"small"})})})]}),b()==="running"&&e.jsx(X,{sx:{height:3,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),e.jsx(r,{ref:I,sx:{maxHeight:"60vh",minHeight:200,overflow:"auto",p:2},children:m?e.jsx(r,{sx:{fontFamily:'"JetBrains Mono", monospace',fontSize:"0.85rem",lineHeight:1.5},children:c.map((g,$)=>e.jsx(r,{sx:{color:g.type==="error"?t.error:t.text.secondary,whiteSpace:"pre-wrap",mb:.25},children:g.data},$))}):p.length>0?p.map((g,$)=>e.jsx(Ze,{stage:g,isLast:$===p.length-1},$)):e.jsx(n,{sx:{color:t.text.disabled,fontStyle:"italic"},children:"Waiting for output..."})})]})},ts=({execId:c,machineName:w,machineId:x,onComplete:p,useStageView:I=!0})=>{const[m,j]=u.useState([]),[v,f]=u.useState("connecting"),[y,b]=u.useState(!0),[W,P]=u.useState(!1),R=u.useRef(null),g=u.useRef(null);u.useEffect(()=>{if(!c)return;const d=new EventSource(`/api/stream/${c}`);return g.current=d,d.addEventListener("connected",S=>{f("running")}),d.addEventListener("status",S=>{try{const k=JSON.parse(S.data);j(O=>[...O,{type:"status",...k}])}catch(k){console.error("Failed to parse status event:",k)}}),d.addEventListener("output",S=>{try{const k=JSON.parse(S.data);j(O=>[...O,{type:"output",...k}])}catch(k){console.error("Failed to parse output event:",k)}}),d.addEventListener("error",S=>{try{const k=JSON.parse(S.data);j(O=>[...O,{type:"error",...k}]),f("error")}catch{d.readyState===EventSource.CLOSED&&f("error")}}),d.addEventListener("complete",S=>{try{const k=JSON.parse(S.data);j(O=>[...O,{type:"complete",...k}]),f(k.data?.includes("true")?"complete":"error"),p?.(k)}catch{f("complete")}d.close()}),d.onerror=()=>{d.readyState===EventSource.CLOSED&&f("error")},()=>{d.close()}},[c,p]),u.useEffect(()=>{R.current&&y&&(R.current.scrollTop=R.current.scrollHeight)},[m,y]);const $=()=>{switch(v){case"complete":return e.jsx(B,{sx:{color:t.secondary}});case"error":return e.jsx(_,{sx:{color:t.error}});default:return e.jsx(K,{sx:{color:t.warning,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}})}},L=()=>{switch(v){case"complete":return t.secondary;case"error":return t.error;default:return t.warning}},F=()=>{const d=m.filter(S=>S.type==="output"||S.type==="status").map(S=>S.data).join(`
`);navigator.clipboard.writeText(d),P(!0),setTimeout(()=>P(!1),2e3)},h=d=>d?new Date(d).toLocaleTimeString():"";return I?e.jsx(ss,{events:m,status:v,machineName:w}):e.jsxs(r,{sx:{background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",border:`1px solid ${L()}33`,overflow:"hidden"},children:[e.jsxs(r,{onClick:()=>b(!y),sx:{display:"flex",alignItems:"center",gap:2,p:2,cursor:"pointer",background:`${L()}10`,borderBottom:y?`1px solid ${t.border.light}`:"none"},children:[$(),e.jsxs(r,{sx:{flex:1},children:[e.jsx(n,{sx:{color:t.text.primary,fontWeight:600},children:w}),e.jsxs(n,{sx:{color:t.text.disabled,fontSize:"0.75rem"},children:[v==="connecting"&&"Connecting...",v==="running"&&"Running...",v==="complete"&&"Completed successfully",v==="error"&&"Failed"]})]}),e.jsx(E,{label:v,size:"small",sx:{background:`${L()}20`,color:L(),textTransform:"capitalize"}}),e.jsx(G,{title:"Copy output",children:e.jsx(J,{size:"small",onClick:d=>{d.stopPropagation(),F()},sx:{color:W?t.secondary:t.text.disabled},children:e.jsx(re,{fontSize:"small"})})}),e.jsx(J,{size:"small",sx:{color:t.text.disabled},children:y?e.jsx(fe,{}):e.jsx(me,{})})]}),v==="running"&&e.jsx(X,{sx:{height:2,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),y&&e.jsx(r,{ref:R,sx:{maxHeight:"60vh",minHeight:200,overflow:"auto",p:2,fontFamily:'"JetBrains Mono", "Fira Code", monospace',fontSize:"0.85rem",lineHeight:1.5,background:"rgba(0, 0, 0, 0.4)"},children:m.length===0?e.jsx(n,{sx:{color:t.text.disabled,fontStyle:"italic"},children:"Waiting for output..."}):m.map((d,S)=>e.jsxs(r,{sx:{display:"flex",gap:1,mb:.5,color:d.type==="error"?t.error:d.type==="status"?t.primary:t.text.secondary},children:[e.jsx(n,{component:"span",sx:{color:t.text.disabled,fontSize:"0.75rem",minWidth:85,flexShrink:0,opacity:.7},children:h(d.timestamp)}),e.jsx(n,{component:"span",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:d.data})]},S))})]})},vs=()=>{const{scriptPath:c}=Ae(),w=Be(),[x]=Le(),p=decodeURIComponent(c||""),I=x.get("machines")?.split(",").filter(Boolean)||[],m=x.get("execId"),[j,v]=u.useState(null),[f,y]=u.useState([]),[b,W]=u.useState([]),[P,R]=u.useState({}),[g,$]=u.useState(0),[L,F]=u.useState(!1),[h,d]=u.useState(null),[S,k]=u.useState(null),[O,q]=u.useState([]),[je,ye]=u.useState(!0),[V,Se]=u.useState(null),[M,Q]=u.useState(null),[ne,ae]=u.useState(!1),[rs,ve]=u.useState({}),[ns,as]=u.useState(!1),[we,oe]=u.useState(!1);u.useEffect(()=>{Ce(),ze()},[p]),u.useEffect(()=>{m&&f.length>0&&ke(m)},[m,f]);const ke=async a=>{try{const o=await fetch(`/api/script-executions/${a}`);if(!o.ok)return;const i=await o.json();if(i.status==="running"){F(!0),k(a),d(i),$(2),i.machine_ids&&W(i.machine_ids);const z=(i.machine_ids||[]).map(l=>{const C=f.find(N=>N.id===l);return{execId:a,machineId:l,machineName:C?.name||l}});q(z);const s=async()=>{const C=await(await fetch(`/api/script-executions/${a}`)).json();d(C),C.status==="running"?setTimeout(s,2e3):F(!1)};setTimeout(s,2e3)}}catch(o){console.error("Failed to reconnect to execution:",o)}},Ce=async()=>{try{const i=(await(await fetch("/api/scripts")).json()).find(z=>z.path===p);if(i){v(i);const z={};i.flags?.forEach(C=>{z[C.long]={enabled:!1,value:""}}),R(z);const s=Je(i.path);Se(s);const l=s.presets?.find(C=>C.recommended);l&&(Q(l),R(xe(l,i.flags)))}}catch(a){console.error("Failed to fetch script:",a)}finally{ye(!1)}},ze=async()=>{try{const o=await(await fetch("/api/machines")).json();if(y(o||[]),I.length>0&&o){const i=I.filter(z=>o.some(s=>s.id===z));i.length>0&&(W(i),$(1))}}catch(a){console.error("Failed to fetch machines:",a)}},Ie=a=>{W(o=>o.includes(a)?o.filter(i=>i!==a):[...o,a])},Ee=a=>{Q(null),R(o=>({...o,[a]:{...o[a],enabled:!o[a]?.enabled}}))},Re=a=>{Q(a),ve({}),V?.useArgs||R(xe(a,j?.flags))},$e=(a,o)=>{R(i=>({...i,[a]:{...i[a],value:o}}))},ie=()=>{if(V?.useArgs&&M?.args)return M.args;const a=[];return Object.entries(P).forEach(([o,i])=>{i.enabled&&(i.value?a.push(`${o}=${i.value}`):a.push(o))}),a.join(" ")},ce=()=>{const a=ie();return`${j?.path||"script.sh"}${a?" "+a:""}`},Te=()=>{navigator.clipboard.writeText(ce()),oe(!0),setTimeout(()=>oe(!1),2e3)},le=async()=>{F(!0),d(null),k(null),q([]);try{const a=ie(),i=await(await fetch("/api/execute-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({script_path:j.path,machine_ids:b,args:a})})).json();if(d(i),i.id){k(i.id);const z=b.map(l=>{const C=f.find(N=>N.id===l);return{execId:i.id,machineId:l,machineName:C?.name||l}});q(z);const s=async()=>{const C=await(await fetch(`/api/script-executions/${i.id}`)).json();d(C),C.status==="running"?setTimeout(s,2e3):F(!1)};setTimeout(s,2e3)}else F(!1)}catch(a){console.error("Execution failed:",a),d({error:a.message}),F(!1)}},Pe=()=>{},Fe=async()=>{if(S)try{(await(await fetch(`/api/script-executions/${S}/cancel`,{method:"POST"})).json()).success&&(d(i=>({...i,status:"cancelled"})),F(!1))}catch(a){console.error("Failed to cancel execution:",a)}},Z=["Select Machines","Configure Options","Review & Execute"],Oe=()=>$(a=>a+1),Ne=()=>$(a=>a-1),We=()=>g===0?b.length>0:!0;if(je)return e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(ee,{})});if(!j)return e.jsxs(r,{sx:{p:3},children:[e.jsxs(A,{severity:"error",children:["Script not found: ",p]}),e.jsx(T,{startIcon:e.jsx(U,{}),onClick:()=>w("/scripts"),sx:{mt:2},children:"Back to Scripts"})]});const Me=a=>{switch(a){case 0:return e.jsxs(r,{children:[e.jsxs(A,{severity:"info",icon:e.jsx(he,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 1 of 3: Pick Your Computers"}),e.jsx(n,{variant:"body2",children:"Click on the computers below where you want to run this script. You can select multiple computers to run the same script on all of them at once."})]}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(se,{color:"primary"}),"Which computers do you want to use?"]}),f.length===0?e.jsxs(A,{severity:"warning",sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",children:"No computers set up yet!"}),e.jsx(n,{variant:"body2",sx:{mb:1},children:"You need to add at least one computer before you can run scripts."}),e.jsx(T,{variant:"contained",size:"small",onClick:()=>w("/machines"),children:"Add a Computer Now"})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:b.length===0?"ðŸ‘† Click on a computer to select it":`âœ… ${b.length} computer${b.length>1?"s":""} selected`}),b.some(s=>f.find(l=>l.id===s)?.status!=="online")&&e.jsxs(A,{severity:"warning",icon:e.jsx(te,{}),sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",children:"âš ï¸ Some selected machines are offline"}),e.jsx(n,{variant:"body2",children:"Scripts may fail on offline machines. Consider testing connections first."})]}),e.jsx(ue,{children:f.map(s=>e.jsx(H,{sx:{mb:1.5,border:2,borderColor:b.includes(s.id)?"primary.main":"transparent",bgcolor:b.includes(s.id)?"primary.dark":"background.paper",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:"primary.light",transform:"scale(1.01)"}},onClick:()=>Ie(s.id),children:e.jsxs(D,{sx:{display:"flex",alignItems:"center",py:2},children:[e.jsx(Xe,{checked:b.includes(s.id),sx:{mr:1}}),e.jsx(se,{sx:{mr:2,fontSize:40},color:s.status==="online"?"success":"disabled"}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsx(n,{variant:"h6",children:s.name||s.ip}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["IP: ",s.ip," â€¢ User: ",s.username]})]}),e.jsx(E,{label:s.status==="online"?"ðŸŸ¢ Online":"ðŸ”´ Offline",size:"medium",color:s.status==="online"?"success":"error",variant:"outlined"})]})},s.id))})]})]});case 1:const o=Object.values(P).filter(s=>s.enabled).length,i=V?.presets?.length>0;return e.jsxs(r,{children:[e.jsxs(A,{severity:"info",icon:e.jsx(he,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 2 of 3: What do you want to set up?"}),e.jsx(n,{variant:"body2",children:i?"Pick a setup type below. Each one is pre-configured for a specific use case.":"Configure the options for this script."})]}),i&&!ne&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:"ðŸŽ¯ What type of machine is this?"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Click on the option that best describes what this computer will be used for."}),e.jsx(Ue,{value:M?.id||"",children:V.presets.map(s=>e.jsx(H,{onClick:()=>Re(s),sx:{mb:2,cursor:"pointer",border:3,borderColor:M?.id===s.id?"primary.main":"transparent",bgcolor:M?.id===s.id?"primary.dark":"background.paper",transition:"all 0.2s","&:hover":{borderColor:"primary.light",transform:"scale(1.01)"}},children:e.jsx(D,{sx:{py:2},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ge,{checked:M?.id===s.id,sx:{mr:2}}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsxs(n,{variant:"h5",sx:{display:"flex",alignItems:"center",gap:1},children:[s.name,s.recommended&&e.jsx(E,{icon:e.jsx(Ye,{}),label:"Recommended",size:"small",color:"warning"})]}),e.jsx(n,{variant:"body1",color:"text.secondary",sx:{mt:1},children:s.description}),s.warning&&e.jsx(E,{icon:e.jsx(te,{}),label:s.warning,size:"small",color:"warning",variant:"outlined",sx:{mt:1}}),M?.id===s.id&&s.flags&&s.flags.length>0&&e.jsx(be,{in:!0,children:e.jsxs(r,{sx:{mt:2,p:1.5,bgcolor:"rgba(0,0,0,0.2)",borderRadius:1},children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"This preset will enable:"}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.flags.map(l=>{const C=l.replace(/^--/,"").replace(/=/g,": ").replace(/-/g," ").replace(/\b\w/g,N=>N.toUpperCase());return e.jsx(E,{label:C,size:"small",sx:{bgcolor:"rgba(249, 115, 22, 0.2)",color:"#f97316",fontSize:"0.75rem"}},l)})})]})})]}),M?.id===s.id&&e.jsx(B,{color:"primary",sx:{fontSize:40}})]})})},s.id))}),e.jsx(r,{sx:{mt:3,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(T,{startIcon:e.jsx(de,{}),onClick:()=>ae(!0),color:"inherit",size:"small",children:"Advanced: Customize individual options"})})]}),(ne||!i)&&e.jsxs(e.Fragment,{children:[i&&e.jsx(r,{sx:{mb:3},children:e.jsx(T,{startIcon:e.jsx(U,{}),onClick:()=>ae(!1),variant:"outlined",size:"small",children:"Back to Simple Mode"})}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{color:"primary"}),"Advanced Options"]}),!j.flags||j.flags.length===0?e.jsxs(A,{severity:"success",sx:{mt:2},children:[e.jsx(n,{variant:"subtitle2",children:"No options needed! ðŸŽ‰"}),e.jsx(n,{variant:"body2",children:`This script doesn't have any options to configure. Just click "Next" to continue.`})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:o===0?"ðŸ’¡ All options are OFF. Turn on what you need.":`âœ… ${o} option${o>1?"s":""} turned ON`}),e.jsx(ue,{children:j.flags.map(s=>{const l=P[s.long]?.enabled||!1,C=s.long.replace("--","").replace(/-/g," ").replace(/\b\w/g,N=>N.toUpperCase());return e.jsx(H,{sx:{mb:1.5,border:2,borderColor:l?"success.main":"transparent",bgcolor:l?"success.dark":"background.paper",transition:"all 0.2s"},children:e.jsx(D,{sx:{py:2},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ke,{checked:l,onChange:()=>Ee(s.long),color:"success",sx:{mr:2}}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsxs(n,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[C,s.has_value&&e.jsx(E,{label:"needs a value",size:"small",color:"warning",variant:"outlined"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:s.description||"No description available"}),s.has_value&&l&&e.jsx(_e,{fullWidth:!0,size:"medium",label:`Enter ${s.value_hint||"value"}`,value:P[s.long]?.value||"",onChange:N=>$e(s.long,N.target.value),sx:{mt:2},placeholder:`Example: ${s.value_hint||"your-value"}`,helperText:`Type the ${s.value_hint||"value"} you want to use`,variant:"outlined"})]}),e.jsx(n,{variant:"body2",sx:{ml:2,color:l?"success.light":"text.disabled",fontWeight:"bold"},children:l?"ON":"OFF"})]})})},s.long)})})]})]})]});case 2:const z=Object.entries(P).filter(([s,l])=>l.enabled);return e.jsxs(r,{children:[e.jsxs(A,{severity:"warning",icon:e.jsx(te,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 3 of 3: Ready to Run!"}),e.jsx(n,{variant:"body2",children:"Double-check everything below. When you click the big green button, the script will run on your selected computers. This cannot be undone!"})]}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{color:"primary"}),"Here's what will happen:"]}),e.jsx(H,{sx:{mb:2,bgcolor:"primary.dark"},children:e.jsxs(D,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"SCRIPT"}),e.jsx(n,{variant:"h6",children:j.name}),e.jsx(n,{variant:"body2",color:"text.secondary",children:j.description})]})}),e.jsx(H,{sx:{mb:2,bgcolor:"info.dark"},children:e.jsxs(D,{children:[e.jsxs(n,{variant:"overline",color:"text.secondary",children:["RUNNING ON ",b.length," COMPUTER",b.length>1?"S":""]}),e.jsx(r,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:1},children:b.map(s=>{const l=f.find(C=>C.id===s);return e.jsx(E,{icon:e.jsx(se,{}),label:l?.name||l?.ip||s,color:"info",sx:{fontSize:"1rem",py:2}},s)})})]})}),e.jsx(H,{sx:{mb:2,bgcolor:z.length>0?"success.dark":"grey.800"},children:e.jsxs(D,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:z.length>0?`WITH ${z.length} OPTION${z.length>1?"S":""} ENABLED`:"USING DEFAULT SETTINGS (NO OPTIONS)"}),z.length>0?e.jsx(r,{sx:{mt:1},children:z.map(([s,l])=>e.jsx(E,{label:l.value?`${s}=${l.value}`:s,sx:{mr:1,mb:1},color:"success"},s))}):e.jsx(n,{variant:"body2",sx:{mt:1},children:"The script will run with its default behavior."})]})}),e.jsx(H,{sx:{mb:2,bgcolor:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)"},children:e.jsxs(D,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{sx:{color:"#8b5cf6"}}),e.jsx(n,{variant:"overline",sx:{color:"#8b5cf6"},children:"DRY-RUN PREVIEW"})]}),e.jsx(G,{title:we?"Copied!":"Copy command",children:e.jsx(J,{size:"small",onClick:Te,sx:{color:"#8b5cf6"},children:e.jsx(re,{fontSize:"small"})})})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:"This is the command that will be executed on each machine:"}),e.jsxs(r,{sx:{p:2,bgcolor:"rgba(0,0,0,0.4)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.9rem",color:"#a5f3fc",overflow:"auto"},children:[e.jsx(De,{sx:{fontSize:14,mr:1,verticalAlign:"middle",color:"#8b5cf6"}}),ce()]}),e.jsx(n,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled"},children:"ðŸ’¡ Tip: Copy this command to test manually before running on all machines"})]})}),h&&e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,background:h.status==="completed"?"linear-gradient(135deg, rgba(0,200,100,0.2) 0%, rgba(0,150,80,0.1) 100%)":h.status==="failed"?"linear-gradient(135deg, rgba(255,80,80,0.2) 0%, rgba(200,50,50,0.1) 100%)":h.status==="cancelled"?"linear-gradient(135deg, rgba(255,152,0,0.2) 0%, rgba(200,120,0,0.1) 100%)":"linear-gradient(135deg, rgba(0,180,255,0.2) 0%, rgba(0,120,200,0.1) 100%)",border:"1px solid",borderColor:h.status==="completed"?"rgba(0,200,100,0.3)":h.status==="failed"?"rgba(255,80,80,0.3)":h.status==="cancelled"?"rgba(255,152,0,0.3)":"rgba(0,180,255,0.3)"},children:[h.status==="running"&&e.jsx(ee,{size:32,sx:{color:"#00b4ff"}}),h.status==="completed"&&e.jsx(B,{sx:{fontSize:32,color:"#00c864"}}),h.status==="failed"&&e.jsx(_,{sx:{fontSize:32,color:"#ff5050"}}),h.status==="cancelled"&&e.jsx(pe,{sx:{fontSize:32,color:"#ff9800"}}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:[h.status==="running"&&"Executing...",h.status==="completed"&&"Completed Successfully",h.status==="failed"&&"Execution Failed",h.status==="cancelled"&&"Execution Cancelled"]}),e.jsxs(n,{variant:"body2",sx:{opacity:.7},children:[h.status==="running"&&`Running on ${b.length} machine(s)`,h.status==="completed"&&"All tasks completed",h.status==="failed"&&"Check output below for details",h.status==="cancelled"&&"Execution was cancelled"]})]}),h.status==="running"&&e.jsxs(e.Fragment,{children:[e.jsx(E,{label:`${h.results?.length||0}/${b.length}`,sx:{background:"rgba(0,180,255,0.2)",color:"#00b4ff",fontWeight:600}}),e.jsx(T,{variant:"contained",color:"error",startIcon:e.jsx(pe,{}),onClick:Fe,sx:{ml:1,background:"linear-gradient(135deg, #ff5050 0%, #cc3030 100%)","&:hover":{background:"linear-gradient(135deg, #ff6060 0%, #dd4040 100%)"}},children:"Stop"})]})]}),S&&e.jsx(r,{sx:{flex:1},children:O.map(s=>e.jsx(ts,{execId:s.execId,machineName:s.machineName,machineId:s.machineId,onComplete:Pe},s.machineId))}),h.status!=="running"&&h.results?.length>0&&!S&&e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:h.results.map((s,l)=>e.jsxs(r,{sx:{p:2,borderRadius:2,background:"rgba(0,0,0,0.3)",border:"1px solid",borderColor:s.success?"rgba(0,200,100,0.3)":"rgba(255,80,80,0.3)",borderLeft:"3px solid",borderLeftColor:s.success?"#00c864":"#ff5050"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[s.success?e.jsx(B,{sx:{color:"#00c864",fontSize:20}}):e.jsx(_,{sx:{color:"#ff5050",fontSize:20}}),e.jsx(n,{sx:{fontWeight:600},children:s.machine_name||"Machine"}),e.jsx(E,{label:s.success?"Success":"Failed",size:"small",sx:{ml:"auto",background:s.success?"rgba(0,200,100,0.2)":"rgba(255,80,80,0.2)",color:s.success?"#00c864":"#ff5050"}})]}),s.output&&e.jsx(r,{sx:{mt:1,p:2,bgcolor:"rgba(0,0,0,0.4)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.8rem",lineHeight:1.5,maxHeight:"40vh",overflow:"auto",whiteSpace:"pre-wrap"},children:s.output}),s.error&&e.jsx(A,{severity:"error",sx:{mt:1},children:s.error})]},l))}),h.status==="running"&&!S&&e.jsxs(r,{sx:{textAlign:"center",py:4,background:"rgba(0,0,0,0.2)",borderRadius:2},children:[e.jsx(ee,{size:32,sx:{mb:2,color:"#00b4ff"}}),e.jsx(n,{sx:{opacity:.7},children:"Connecting to machines..."})]})]}),L&&!h&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(X,{sx:{height:8,borderRadius:4}}),e.jsx(n,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:"Starting execution..."})]}),h&&h.status!=="running"&&e.jsxs(r,{sx:{display:"flex",gap:2},children:[e.jsx(T,{variant:"outlined",size:"large",onClick:()=>w("/scripts"),fullWidth:!0,children:"Back to Scripts"}),e.jsx(T,{variant:"contained",color:"primary",size:"large",startIcon:e.jsx(Y,{}),onClick:()=>{d(null),le()},fullWidth:!0,children:"Run Again"})]})]});default:return null}};return e.jsxs(r,{sx:{p:2,maxWidth:1200,mx:"auto",display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",gap:1.5,overflow:"hidden"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,flexShrink:0},children:[e.jsx(T,{startIcon:e.jsx(U,{}),onClick:()=>w("/scripts"),variant:"text",sx:{color:"rgba(255,255,255,0.7)","&:hover":{color:"#f97316",background:"rgba(0,212,255,0.1)"}},children:"Back"}),e.jsx(r,{sx:{flex:1,display:"flex",alignItems:"center",gap:2,background:"linear-gradient(90deg, rgba(0,212,255,0.1) 0%, transparent 100%)",borderRadius:2,p:1.5,pl:2},children:e.jsxs(r,{children:[e.jsx(n,{variant:"h5",sx:{fontWeight:700,color:"#fff"},children:j.name}),e.jsx(n,{variant:"body2",sx:{color:"rgba(255,255,255,0.6)"},children:j.description})]})})]}),e.jsx(r,{sx:{display:"flex",alignItems:"center",gap:1,flexShrink:0,background:"rgba(0,0,0,0.3)",borderRadius:2,p:1},children:Z.map((a,o)=>e.jsxs(r,{sx:{flex:1,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5,flex:1,p:1.5,borderRadius:1.5,background:o===g?"linear-gradient(135deg, rgba(0,212,255,0.3) 0%, rgba(0,255,136,0.2) 100%)":o<g?"rgba(0,200,100,0.15)":"transparent",border:"1px solid",borderColor:o===g?"rgba(0,212,255,0.5)":o<g?"rgba(0,200,100,0.3)":"rgba(255,255,255,0.1)",transition:"all 0.3s ease"},children:[e.jsx(r,{sx:{width:28,height:28,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:o<g?"#00c864":o===g?"linear-gradient(135deg, #f97316 0%, #22c55e 100%)":"rgba(255,255,255,0.1)",color:o<=g?"#0a0a0f":"rgba(255,255,255,0.5)",fontWeight:700,fontSize:"0.85rem"},children:o<g?"âœ“":o+1}),e.jsx(n,{sx:{fontWeight:o===g?600:400,color:o===g?"#fff":o<g?"#00c864":"rgba(255,255,255,0.5)",fontSize:"0.9rem"},children:a})]}),o<Z.length-1&&e.jsx(r,{sx:{width:24,height:2,background:o<g?"#00c864":"rgba(255,255,255,0.2)",borderRadius:1}})]},a))}),e.jsx(He,{sx:{p:2,flex:1,minHeight:0,overflow:"auto",mb:1,"&::-webkit-scrollbar":{width:"12px"},"&::-webkit-scrollbar-track":{background:"#1e1e1e",borderRadius:"6px"},"&::-webkit-scrollbar-thumb":{background:"#666",borderRadius:"6px",border:"2px solid #1e1e1e"},"&::-webkit-scrollbar-thumb:hover":{background:"#888"}},children:Me(g)}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",p:2,bgcolor:"rgba(0, 20, 40, 0.95)",borderRadius:2,border:"1px solid rgba(249, 115, 22, 0.3)",flexShrink:0,position:"sticky",bottom:0,backdropFilter:"blur(10px)"},children:[e.jsx(T,{variant:"outlined",size:"large",startIcon:e.jsx(U,{}),disabled:g===0,onClick:Ne,sx:{px:4},children:"â† Previous Step"}),g<Z.length-1?e.jsx(T,{variant:"contained",size:"large",endIcon:e.jsx(Ve,{}),onClick:Oe,disabled:!We(),sx:{px:4,background:"linear-gradient(135deg, #f97316 0%, #22c55e 100%)",color:"#0a0a0f",fontWeight:700,"&:hover":{background:"linear-gradient(135deg, #fb923c 0%, #4ade80 100%)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Next Step â†’"}):!L&&!h&&e.jsx(T,{variant:"contained",size:"large",startIcon:e.jsx(Y,{}),onClick:le,sx:{px:4,background:"linear-gradient(135deg, #22c55e 0%, #f97316 100%)",color:"#0a0a0f",fontWeight:700,"&:hover":{background:"linear-gradient(135deg, #4ade80 0%, #fb923c 100%)",boxShadow:"0 0 30px rgba(34, 197, 94, 0.4)"}},children:"ðŸš€ Execute Script"})]})]})};export{vs as default};
