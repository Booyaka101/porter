import{c as V,j as e,r as a,B as o,T as n,l as h,m as g,R as X,b as p,A as E,X as k,C as I,G as Y,P as _,D as P,x as z,y as A,k as S,w as Q}from"./index-BR8HzIu-.js";import{E as Z}from"./Edit-BSjMYvVA.js";import{D as ee}from"./Delete-DwUrccAH.js";import{C as se}from"./ContentCopy-BXv6Dy4a.js";import{C as re}from"./CheckCircle-CQPaGP6K.js";import{S as F}from"./Switch-HbuDhUMd.js";import{C as O}from"./Chip-CiJfAjDW.js";import{F as M}from"./FormControlLabel-DDgFjoWt.js";import{C as oe}from"./Checkbox-DjmnloIS.js";import{D as R}from"./DialogActions-BOBerqwj.js";import{S as te}from"./Snackbar-BK8x6uGU.js";import"./SwitchBase-CXhs4CjE.js";const W=V(e.jsx("path",{d:"M10 15h5.88c.27-.31.67-.5 1.12-.5.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5c-.44 0-.84-.19-1.12-.5H11.9c-.46 2.28-2.48 4-4.9 4-2.76 0-5-2.24-5-5 0-2.42 1.72-4.44 4-4.9v2.07c-1.16.41-2 1.53-2 2.83 0 1.65 1.35 3 3 3s3-1.35 3-3zm2.5-11c1.65 0 3 1.35 3 3h2c0-2.76-2.24-5-5-5s-5 2.24-5 5c0 1.43.6 2.71 1.55 3.62l-2.35 3.9c-.68.14-1.2.75-1.2 1.48 0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5c0-.16-.02-.31-.07-.45l3.38-5.63C10.49 9.61 9.5 8.42 9.5 7c0-1.65 1.35-3 3-3m4.5 9c-.64 0-1.23.2-1.72.54l-3.05-5.07C11.53 8.35 11 7.74 11 7c0-.83.67-1.5 1.5-1.5S14 6.17 14 7c0 .15-.02.29-.06.43l2.19 3.65c.28-.05.57-.08.87-.08 2.76 0 5 2.24 5 5s-2.24 5-5 5c-1.85 0-3.47-1.01-4.33-2.5h2.67c.48.32 1.05.5 1.66.5 1.65 0 3-1.35 3-3s-1.35-3-3-3"})),B=[{id:"script.started",label:"Script Started",description:"When a script execution begins"},{id:"script.completed",label:"Script Completed",description:"When a script execution finishes successfully"},{id:"script.failed",label:"Script Failed",description:"When a script execution fails"},{id:"machine.online",label:"Machine Online",description:"When a machine comes online"},{id:"machine.offline",label:"Machine Offline",description:"When a machine goes offline"},{id:"machine.added",label:"Machine Added",description:"When a new machine is added"},{id:"machine.removed",label:"Machine Removed",description:"When a machine is deleted"},{id:"docker.container.started",label:"Container Started",description:"When a Docker container starts"},{id:"docker.container.stopped",label:"Container Stopped",description:"When a Docker container stops"},{id:"backup.completed",label:"Backup Completed",description:"When a backup completes"},{id:"backup.failed",label:"Backup Failed",description:"When a backup fails"}],ue=()=>{const[v,y]=a.useState([]),[U,T]=a.useState(!0),[L,b]=a.useState(!1),[d,D]=a.useState(null),[f,u]=a.useState(null),[m,j]=a.useState(null),[C,l]=a.useState({open:!1,message:"",severity:"success"}),[t,i]=a.useState({name:"",url:"",secret:"",events:[],enabled:!0}),x=a.useCallback(async()=>{T(!0);try{const s=await fetch("/api/webhooks");if(s.ok){const r=await s.json();y(r||[])}else y([])}catch(s){console.error("Failed to load webhooks:",s),y([])}T(!1)},[]);a.useEffect(()=>{x()},[x]);const w=()=>{D(null),i({name:"",url:"",secret:"",events:[],enabled:!0}),b(!0)},N=s=>{D(s),i({name:s.name,url:s.url,secret:s.secret||"",events:s.events||[],enabled:s.enabled}),b(!0)},q=async()=>{if(!t.name||!t.url||t.events.length===0){l({open:!0,message:"Please fill in all required fields",severity:"error"});return}try{const s=d?`/api/webhooks/${d.id}`:"/api/webhooks";if((await fetch(s,{method:d?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)l({open:!0,message:d?"Webhook updated":"Webhook created",severity:"success"}),b(!1),x();else throw new Error("Failed to save webhook")}catch(s){l({open:!0,message:s.message,severity:"error"})}},H=async()=>{if(f){try{(await fetch(`/api/webhooks/${f.id}`,{method:"DELETE"})).ok&&(l({open:!0,message:"Webhook deleted",severity:"success"}),x())}catch{l({open:!0,message:"Failed to delete webhook",severity:"error"})}u(null)}},$=async s=>{try{(await fetch(`/api/webhooks/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,enabled:!s.enabled})})).ok&&x()}catch{l({open:!0,message:"Failed to toggle webhook",severity:"error"})}},J=async s=>{j({id:s.id,loading:!0});try{const c=await(await fetch(`/api/webhooks/${s.id}/test`,{method:"POST"})).json();j({id:s.id,success:c.success,message:c.message})}catch(r){j({id:s.id,success:!1,message:r.message})}setTimeout(()=>j(null),5e3)},G=s=>{i(r=>({...r,events:r.events.includes(s)?r.events.filter(c=>c!==s):[...r.events,s]}))},K=s=>{navigator.clipboard.writeText(s),l({open:!0,message:"Secret copied to clipboard",severity:"success"})};return e.jsxs(o,{sx:{p:3,maxWidth:1200,mx:"auto"},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{sx:{width:56,height:56,borderRadius:"14px",background:"linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(W,{sx:{color:"#8b5cf6",fontSize:28}})}),e.jsxs(o,{children:[e.jsx(n,{variant:"h4",sx:{color:"#fafafa",fontWeight:700},children:"Webhooks"}),e.jsx(n,{sx:{color:"rgba(255,255,255,0.5)"},children:"Trigger external services on events"})]})]}),e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(h,{title:"Refresh",children:e.jsx(g,{onClick:x,sx:{color:"#f97316"},children:e.jsx(X,{})})}),e.jsx(p,{variant:"contained",startIcon:e.jsx(E,{}),onClick:w,sx:{background:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)","&:hover":{background:"linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%)"}},children:"Add Webhook"})]})]}),e.jsx(k,{sx:{p:2,mb:3,bgcolor:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)"},children:e.jsx(n,{sx:{color:"rgba(255,255,255,0.8)",fontSize:"0.9rem"},children:"Webhooks allow you to receive HTTP POST notifications when events occur in Porter. Configure a URL endpoint and select which events should trigger notifications."})}),U?e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(I,{sx:{color:"#8b5cf6"}})}):v.length===0?e.jsxs(k,{sx:{p:6,textAlign:"center",bgcolor:"rgba(255,255,255,0.02)"},children:[e.jsx(W,{sx:{fontSize:64,color:"rgba(255,255,255,0.1)",mb:2}}),e.jsx(n,{sx:{color:"rgba(255,255,255,0.5)",mb:2},children:"No webhooks configured"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(E,{}),onClick:w,sx:{borderColor:"#8b5cf6",color:"#8b5cf6"},children:"Create Your First Webhook"})]}):e.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:v.map(s=>e.jsx(k,{sx:{p:3,bgcolor:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.05)",opacity:s.enabled?1:.6,transition:"all 0.2s ease","&:hover":{borderColor:"rgba(139, 92, 246, 0.3)"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(o,{sx:{flex:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(n,{sx:{color:"#fafafa",fontWeight:600,fontSize:"1.1rem"},children:s.name}),e.jsx(F,{checked:s.enabled,onChange:()=>$(s),size:"small",sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#8b5cf6"}}}),!s.enabled&&e.jsx(O,{label:"Disabled",size:"small",sx:{bgcolor:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.5)"}})]}),e.jsx(n,{sx:{color:"rgba(255,255,255,0.6)",fontFamily:"monospace",fontSize:"0.85rem",mb:2},children:s.url}),e.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.events?.map(r=>e.jsx(O,{label:B.find(c=>c.id===r)?.label||r,size:"small",sx:{bgcolor:"rgba(139, 92, 246, 0.2)",color:"#a78bfa",fontSize:"0.75rem"}},r))})]}),e.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center"},children:[m?.id===s.id&&(m.loading?e.jsx(I,{size:20,sx:{color:"#8b5cf6"}}):m.success?e.jsx(re,{sx:{color:"#22c55e"}}):e.jsx(h,{title:m.message,children:e.jsx(Y,{sx:{color:"#ef4444"}})})),e.jsx(h,{title:"Test Webhook",children:e.jsx(g,{onClick:()=>J(s),sx:{color:"#22c55e"},children:e.jsx(_,{})})}),e.jsx(h,{title:"Edit",children:e.jsx(g,{onClick:()=>N(s),sx:{color:"#f97316"},children:e.jsx(Z,{})})}),e.jsx(h,{title:"Delete",children:e.jsx(g,{onClick:()=>u(s),sx:{color:"#ef4444"},children:e.jsx(ee,{})})})]})]})},s.id))}),e.jsxs(P,{open:L,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"rgba(20, 20, 20, 0.98)",border:"1px solid rgba(255,255,255,0.1)"}},children:[e.jsx(z,{sx:{borderBottom:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{sx:{color:"#8b5cf6"}}),d?"Edit Webhook":"Add Webhook"]})}),e.jsx(A,{sx:{pt:3},children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(S,{label:"Name",value:t.name,onChange:s=>i(r=>({...r,name:s.target.value})),fullWidth:!0,required:!0,placeholder:"My Webhook"}),e.jsx(S,{label:"URL",value:t.url,onChange:s=>i(r=>({...r,url:s.target.value})),fullWidth:!0,required:!0,placeholder:"https://example.com/webhook",helperText:"The URL that will receive POST requests"}),e.jsx(S,{label:"Secret (optional)",value:t.secret,onChange:s=>i(r=>({...r,secret:s.target.value})),fullWidth:!0,placeholder:"webhook-secret-key",helperText:"Used to sign webhook payloads for verification",InputProps:{endAdornment:t.secret&&e.jsx(g,{size:"small",onClick:()=>K(t.secret),children:e.jsx(se,{sx:{fontSize:18}})})}}),e.jsxs(o,{children:[e.jsx(n,{sx:{color:"rgba(255,255,255,0.7)",mb:1.5,fontWeight:500},children:"Events *"}),e.jsx(o,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:1},children:B.map(s=>e.jsx(M,{control:e.jsx(oe,{checked:t.events.includes(s.id),onChange:()=>G(s.id),sx:{color:"rgba(255,255,255,0.3)","&.Mui-checked":{color:"#8b5cf6"}}}),label:e.jsx(h,{title:s.description,children:e.jsx(n,{sx:{fontSize:"0.85rem",color:"rgba(255,255,255,0.8)"},children:s.label})})},s.id))})]}),e.jsx(M,{control:e.jsx(F,{checked:t.enabled,onChange:s=>i(r=>({...r,enabled:s.target.checked})),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#8b5cf6"}}}),label:"Enabled"})]})}),e.jsxs(R,{sx:{p:2,borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(p,{onClick:()=>b(!1),sx:{color:"rgba(255,255,255,0.6)"},children:"Cancel"}),e.jsx(p,{onClick:q,variant:"contained",sx:{background:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)"},children:d?"Update":"Create"})]})]}),e.jsxs(P,{open:!!f,onClose:()=>u(null),PaperProps:{sx:{bgcolor:"rgba(20, 20, 20, 0.98)",border:"1px solid rgba(255,255,255,0.1)"}},children:[e.jsx(z,{children:"Delete Webhook"}),e.jsx(A,{children:e.jsxs(n,{sx:{color:"rgba(255,255,255,0.8)"},children:['Are you sure you want to delete "',f?.name,'"?']})}),e.jsxs(R,{children:[e.jsx(p,{onClick:()=>u(null),children:"Cancel"}),e.jsx(p,{onClick:H,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(te,{open:C.open,autoHideDuration:4e3,onClose:()=>l(s=>({...s,open:!1})),children:e.jsx(Q,{severity:C.severity,onClose:()=>l(s=>({...s,open:!1})),children:C.message})})]})};export{ue as default};
