import{u as Q,ab as U,r as c,j as e,B as t,s as g,m as H,h as M,T as a,e as j,f as y,g as S,b as C,d as V,H as X,k as Y,C as O,P as Z,l as ee,af as se,G as oe}from"./index-DHdDvhkS.js";import{A as te}from"./ArrowBack-CQ5LHZeB.js";import{C as re}from"./CheckCircle-DQaCvPPh.js";import{H as ne}from"./HourglassEmpty-D6YIP5_m.js";import{C as ae}from"./ContentCopy-afECht_l.js";import{E as ie}from"./ExpandLess-DXi828Bn.js";import{C as ce}from"./Checkbox-2oVMwLO5.js";import{C as T}from"./Collapse-BzwogoKV.js";import{C as le}from"./Chip-CqU9Trdn.js";import{L as xe}from"./LinearProgress-DR6EjOe8.js";import"./SwitchBase-DUjZ-jvC.js";const Ce=()=>{const D=Q(),[P]=U(),W=c.useRef(null),k=P.get("machines")?.split(",").filter(Boolean)||[],[x,F]=c.useState([]),[i,f]=c.useState([]),[d,w]=c.useState(""),[p,z]=c.useState(!1),[m,u]=c.useState({}),[h,b]=c.useState([]),[I,E]=c.useState(!1),[A,R]=c.useState({});c.useEffect(()=>{B(),_()},[]);const B=async()=>{try{const o=await(await fetch("/api/machines")).json();if(F(o||[]),k.length>0&&o){const r=k.filter(n=>o.some(l=>l.id===n));f(r)}}catch(s){console.error("Failed to fetch machines:",s)}},_=()=>{try{const s=JSON.parse(localStorage.getItem("commandHistory")||"[]");b(s.slice(0,20))}catch{b([])}},N=s=>{const o=[s,...h.filter(r=>r!==s)].slice(0,20);b(o),localStorage.setItem("commandHistory",JSON.stringify(o))},K=s=>{f(o=>o.includes(s)?o.filter(r=>r!==s):[...o,s])},$=()=>{i.length===x.length?f([]):f(x.map(s=>s.id))},v=async()=>{if(!d.trim()||i.length===0)return;z(!0),u({}),N(d.trim());const s={};i.forEach(o=>{s[o]={status:"running",output:""}}),u(s),R(i.reduce((o,r)=>({...o,[r]:!0}),{}));for(const o of i)try{const n=await(await fetch("/api/run-command",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({machine_id:o,command:d.trim()})})).json();u(l=>({...l,[o]:{status:n.success?"success":"error",output:n.output||n.error||"No output",exit_code:n.exit_code}}))}catch(r){u(n=>({...n,[o]:{status:"error",output:`Failed to execute: ${r.message}`}}))}z(!1)},J=s=>{s.key==="Enter"&&(s.ctrlKey||s.metaKey)&&v()},L=s=>{navigator.clipboard.writeText(s)},G=s=>x.find(o=>o.id===s),q=s=>{switch(s){case"success":return e.jsx(re,{sx:{color:"#22c55e",fontSize:18}});case"error":return e.jsx(oe,{sx:{color:"#ff4466",fontSize:18}});case"running":return e.jsx(O,{size:16,sx:{color:"#f97316"}});default:return e.jsx(ne,{sx:{color:"rgba(255,255,255,0.5)",fontSize:18}})}};return e.jsxs(t,{sx:{...g},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(H,{onClick:()=>D(-1),sx:{color:"rgba(255,255,255,0.5)","&:hover":{color:"#f97316",background:"rgba(249, 115, 22, 0.1)"}},children:e.jsx(te,{})}),e.jsx(t,{sx:{width:48,height:48,borderRadius:"14px",background:"linear-gradient(135deg, #22c55e 0%, #00cc6a 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 20px rgba(34, 197, 94, 0.4)"},children:e.jsx(M,{sx:{color:"#0a0a0f",fontSize:24}})}),e.jsxs(t,{children:[e.jsx(a,{sx:{fontSize:"1.5rem",fontWeight:700,color:"#fff",letterSpacing:"-0.02em"},children:"Run Command"}),e.jsx(a,{sx:{fontSize:"0.85rem",color:"rgba(255,255,255,0.5)"},children:"Execute commands on selected machines"})]})]}),e.jsxs(t,{sx:{display:"flex",gap:3,flexDirection:{xs:"column",md:"row"}},children:[e.jsxs(j,{sx:{flex:"0 0 300px",background:"linear-gradient(135deg, rgba(20, 30, 48, 0.95) 0%, rgba(17, 23, 35, 0.98) 100%)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:"16px",maxHeight:500,display:"flex",flexDirection:"column"},children:[e.jsx(y,{sx:{p:2,pb:1},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(a,{sx:{color:S.text.primary,fontWeight:600,fontSize:"0.9rem"},children:"Select Machines"}),e.jsx(C,{size:"small",onClick:$,sx:{color:"#f97316",fontSize:"0.75rem"},children:i.length===x.length?"Deselect All":"Select All"})]})}),e.jsx(t,{sx:{flex:1,overflow:"auto",px:2,pb:2,...g},children:x.map(s=>{const o=i.includes(s.id),r=s.status==="online";return e.jsxs(t,{onClick:()=>K(s.id),sx:{display:"flex",alignItems:"center",gap:1.5,p:1.5,mb:1,borderRadius:"10px",cursor:"pointer",background:o?"rgba(249, 115, 22, 0.15)":"rgba(255,255,255,0.02)",border:o?"1px solid rgba(249, 115, 22, 0.4)":"1px solid transparent",opacity:r?1:.5,transition:"all 0.2s ease","&:hover":{background:o?"rgba(249, 115, 22, 0.2)":"rgba(255,255,255,0.05)"}},children:[e.jsx(ce,{checked:o,size:"small",sx:{color:"rgba(255,255,255,0.3)","&.Mui-checked":{color:"#f97316"},p:0}}),e.jsx(t,{sx:{width:32,height:32,borderRadius:"8px",background:"rgba(249, 115, 22, 0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(V,{sx:{color:"#f97316",fontSize:18}})}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsx(a,{sx:{color:"#fff",fontSize:"0.85rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),e.jsx(a,{sx:{color:"rgba(255,255,255,0.4)",fontSize:"0.7rem",fontFamily:"monospace"},children:s.ip})]}),e.jsx(t,{sx:{width:8,height:8,borderRadius:"50%",background:r?"#22c55e":"#ff4466",boxShadow:r?"0 0 8px #22c55e":"none"}})]},s.id)})})]}),e.jsxs(t,{sx:{flex:1,display:"flex",flexDirection:"column",gap:3},children:[e.jsx(j,{sx:{background:"linear-gradient(135deg, rgba(20, 30, 48, 0.95) 0%, rgba(17, 23, 35, 0.98) 100%)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:"16px"},children:e.jsxs(y,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(a,{sx:{color:S.text.primary,fontWeight:600,fontSize:"0.9rem"},children:"Command"}),e.jsx(t,{sx:{display:"flex",gap:1},children:h.length>0&&e.jsx(C,{size:"small",startIcon:e.jsx(X,{}),onClick:()=>E(!I),sx:{color:"rgba(255,255,255,0.5)",fontSize:"0.75rem"},children:"History"})})]}),e.jsx(T,{in:I,children:e.jsx(t,{sx:{mb:2,p:1.5,background:"rgba(0,0,0,0.3)",borderRadius:"8px",maxHeight:150,overflow:"auto",...g},children:h.map((s,o)=>e.jsx(t,{onClick:()=>{w(s),E(!1)},sx:{p:1,borderRadius:"6px",cursor:"pointer",fontFamily:"monospace",fontSize:"0.8rem",color:"rgba(255,255,255,0.7)","&:hover":{background:"rgba(249, 115, 22, 0.1)",color:"#f97316"}},children:s},o))})}),e.jsx(Y,{fullWidth:!0,multiline:!0,rows:3,value:d,onChange:s=>w(s.target.value),onKeyDown:J,placeholder:"Enter command to execute (e.g., ls -la, df -h, free -m)",sx:{"& .MuiOutlinedInput-root":{fontFamily:"monospace",fontSize:"0.9rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px"}}}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:2},children:[e.jsx(a,{sx:{color:"rgba(255,255,255,0.4)",fontSize:"0.75rem"},children:"Press Ctrl+Enter to execute"}),e.jsx(C,{variant:"contained",startIcon:p?e.jsx(O,{size:16,sx:{color:"#0a0a0f"}}):e.jsx(Z,{}),onClick:v,disabled:p||!d.trim()||i.length===0,sx:{background:"linear-gradient(135deg, #22c55e 0%, #00cc6a 100%)",color:"#0a0a0f",fontWeight:600,"&:hover":{background:"linear-gradient(135deg, #66ffaa 0%, #22c55e 100%)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:p?"Executing...":`Execute on ${i.length} machine${i.length!==1?"s":""}`})]})]})}),Object.keys(m).length>0&&e.jsx(j,{sx:{background:"linear-gradient(135deg, rgba(20, 30, 48, 0.95) 0%, rgba(17, 23, 35, 0.98) 100%)",border:"1px solid rgba(255,255,255,0.06)",borderRadius:"16px",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(y,{sx:{p:3,flex:1,display:"flex",flexDirection:"column"},children:[e.jsx(a,{sx:{color:S.text.primary,fontWeight:600,fontSize:"0.9rem",mb:2},children:"Results"}),e.jsx(t,{sx:{flex:1,overflow:"auto",...g},ref:W,children:Object.entries(m).map(([s,o])=>{const r=G(s),n=A[s]!==!1;return e.jsxs(t,{sx:{mb:2,background:"rgba(0,0,0,0.2)",borderRadius:"10px",overflow:"hidden",border:o.status==="error"?"1px solid rgba(255, 68, 102, 0.3)":o.status==="success"?"1px solid rgba(34, 197, 94, 0.2)":"1px solid rgba(249, 115, 22, 0.2)"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,p:1.5,cursor:"pointer","&:hover":{background:"rgba(255,255,255,0.02)"}},onClick:()=>R(l=>({...l,[s]:!n})),children:[q(o.status),e.jsx(a,{sx:{color:"#fff",fontWeight:500,fontSize:"0.85rem",flex:1},children:r?.name||s}),e.jsx(a,{sx:{color:"rgba(255,255,255,0.4)",fontSize:"0.75rem",fontFamily:"monospace"},children:r?.ip}),o.exit_code!==void 0&&e.jsx(le,{label:`Exit: ${o.exit_code}`,size:"small",sx:{height:20,fontSize:"0.7rem",background:o.exit_code===0?"rgba(34, 197, 94, 0.2)":"rgba(255, 68, 102, 0.2)",color:o.exit_code===0?"#22c55e":"#ff4466"}}),e.jsx(ee,{title:"Copy output",children:e.jsx(H,{size:"small",onClick:l=>{l.stopPropagation(),L(o.output)},sx:{color:"rgba(255,255,255,0.4)"},children:e.jsx(ae,{sx:{fontSize:16}})})}),n?e.jsx(ie,{sx:{color:"rgba(255,255,255,0.4)"}}):e.jsx(se,{sx:{color:"rgba(255,255,255,0.4)"}})]}),e.jsxs(T,{in:n,children:[o.status==="running"&&e.jsx(xe,{sx:{height:2}}),e.jsx(t,{sx:{p:2,pt:1,fontFamily:"monospace",fontSize:"0.8rem",color:"rgba(255,255,255,0.8)",whiteSpace:"pre-wrap",wordBreak:"break-all",maxHeight:300,overflow:"auto",background:"rgba(0,0,0,0.2)",...g},children:o.output||(o.status==="running"?"Executing...":"No output")})]})]},s)})})]})}),Object.keys(m).length===0&&e.jsxs(t,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:2,py:8},children:[e.jsx(M,{sx:{fontSize:64,color:"rgba(255,255,255,0.1)"}}),e.jsx(a,{sx:{color:"rgba(255,255,255,0.4)",textAlign:"center"},children:"Select machines and enter a command to execute"})]})]})]})]})};export{Ce as default};
