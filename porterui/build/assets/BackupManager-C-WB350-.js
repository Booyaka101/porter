import{r as l,j as e,B as n,T as i,g as t,aM as E,l as C,m as _,R as L,b as w,A as O,q as G,X as z,P as H,D as q,x as K,y as X,k as b,n as Q,e as U,f as V}from"./index-DsbQFb1R.js";import{D as Y}from"./Delete-C8af4ORk.js";import{S as Z}from"./Storage-ByxKjv48.js";import{C as ee}from"./CheckCircle-DTYTWwS_.js";import{S as se}from"./Schedule-NWYpYEJy.js";import{G as p}from"./Grid-Cof3XE5A.js";import{T,a as I,b as x,c as r,d as R}from"./TableRow-BPkD98Qm.js";import{C as J}from"./Chip-Curpsm0X.js";import{F as te}from"./FormControlLabel-qvuR_iU3.js";import{S as re}from"./Switch-DW5bYoed.js";import{D as ae}from"./DialogActions-D3FdWvdP.js";import"./SwitchBase-JqiP87-Y.js";const f=({icon:h,title:k,value:y,subtitle:j,color:o})=>e.jsx(U,{sx:{background:`linear-gradient(135deg, ${o}08 0%, rgba(255,255,255,0.01) 100%)`,border:`1px solid ${o}20`,borderRadius:"12px",height:"100%"},children:e.jsx(V,{sx:{p:2},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(n,{sx:{width:40,height:40,borderRadius:"10px",background:`${o}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{sx:{color:o,fontSize:22}})}),e.jsxs(n,{children:[e.jsx(i,{sx:{color:t.text.muted,fontSize:"0.75rem"},children:k}),e.jsx(i,{sx:{color:t.text.primary,fontSize:"1.5rem",fontWeight:700,lineHeight:1},children:y}),j&&e.jsx(i,{sx:{color:t.text.disabled,fontSize:"0.7rem"},children:j})]})]})})}),be=()=>{const[h,k]=l.useState([]),[y,j]=l.useState([]),[o,$]=l.useState([]),[F,g]=l.useState(!1),[oe,B]=l.useState(!0),[a,d]=l.useState({name:"",machine_id:"",source_path:"",dest_path:"/backups",compress:!0,schedule:"manual"}),u=async()=>{B(!0);try{const[s,c,m]=await Promise.all([fetch("/api/backups"),fetch("/api/machines"),fetch("/api/backups/history")]);k(await s.json()||[]),j(await c.json()||[]),$(await m.json()||[])}catch(s){console.error("Failed to load data:",s)}B(!1)};l.useEffect(()=>{u()},[]);const M=async()=>{try{await fetch("/api/backups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),g(!1),d({name:"",machine_id:"",source_path:"",dest_path:"/backups",compress:!0,schedule:"manual"}),u()}catch(s){console.error("Failed to create backup job:",s)}},W=async s=>{try{await fetch(`/api/backups/${s}/run`,{method:"POST"}),u()}catch(c){console.error("Failed to run backup:",c)}},N=async s=>{if(window.confirm("Delete this backup job?"))try{await fetch(`/api/backups/${s}`,{method:"DELETE"}),u()}catch(c){console.error("Failed to delete backup job:",c)}},D=s=>{if(!s)return"-";const c=["B","KB","MB","GB"];let m=0;for(;s>=1024&&m<c.length-1;)s/=1024,m++;return`${s.toFixed(1)} ${c[m]}`},S=o.length,v=o.filter(s=>s.status==="success").length,P=o.reduce((s,c)=>s+(c.size||0),0),A=S>0?Math.round(v/S*100):0;return e.jsxs(n,{sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,p:3,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%)",borderRadius:"16px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:[e.jsxs(n,{children:[e.jsxs(i,{variant:"h5",sx:{color:t.text.primary,fontWeight:700,display:"flex",alignItems:"center",gap:1},children:[e.jsx(E,{sx:{color:"#3b82f6"}}),"Backup Manager"]}),e.jsx(i,{sx:{color:t.text.muted,fontSize:"0.9rem",mt:.5},children:"Create and manage backup jobs for your machines"})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(C,{title:"Refresh",children:e.jsx(_,{onClick:u,sx:{color:t.text.muted,"&:hover":{color:"#3b82f6"}},children:e.jsx(L,{})})}),e.jsx(w,{variant:"contained",startIcon:e.jsx(O,{}),onClick:()=>g(!0),sx:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)","&:hover":{background:"linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)"}},children:"New Backup Job"})]})]}),e.jsxs(p,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(p,{item:!0,xs:6,sm:3,children:e.jsx(f,{icon:G,title:"Total Jobs",value:h.length,color:"#3b82f6"})}),e.jsx(p,{item:!0,xs:6,sm:3,children:e.jsx(f,{icon:ee,title:"Successful",value:v,subtitle:`${A}% success rate`,color:t.secondary})}),e.jsx(p,{item:!0,xs:6,sm:3,children:e.jsx(f,{icon:Z,title:"Total Size",value:D(P),color:"#8b5cf6"})}),e.jsx(p,{item:!0,xs:6,sm:3,children:e.jsx(f,{icon:se,title:"Total Backups",value:S,color:t.warning})})]}),e.jsxs(z,{sx:{background:t.background.card,border:`1px solid ${t.border.light}`,mb:3},children:[e.jsx(n,{sx:{p:2,borderBottom:`1px solid ${t.border.light}`},children:e.jsx(i,{sx:{color:t.text.primary,fontWeight:600},children:"Backup Jobs"})}),e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs(x,{children:[e.jsx(r,{sx:{color:t.text.muted},children:"Name"}),e.jsx(r,{sx:{color:t.text.muted},children:"Machine"}),e.jsx(r,{sx:{color:t.text.muted},children:"Source"}),e.jsx(r,{sx:{color:t.text.muted},children:"Last Run"}),e.jsx(r,{sx:{color:t.text.muted},children:"Status"}),e.jsx(r,{sx:{color:t.text.muted},children:"Actions"})]})}),e.jsxs(R,{children:[h.map(s=>e.jsxs(x,{children:[e.jsx(r,{sx:{color:t.text.primary},children:s.name}),e.jsx(r,{sx:{color:t.text.secondary},children:s.machine_name}),e.jsx(r,{sx:{color:t.text.muted,fontFamily:"monospace",fontSize:"0.85rem"},children:s.source_path}),e.jsx(r,{sx:{color:t.text.secondary,fontSize:"0.85rem"},children:s.last_run?new Date(s.last_run).toLocaleString():"Never"}),e.jsx(r,{children:s.last_status&&e.jsx(J,{label:s.last_status,size:"small",color:s.last_status==="success"?"success":"error"})}),e.jsxs(r,{children:[e.jsx(C,{title:"Run Now",children:e.jsx(_,{size:"small",onClick:()=>W(s.id),sx:{color:t.secondary},children:e.jsx(H,{})})}),e.jsx(C,{title:"Delete",children:e.jsx(_,{size:"small",onClick:()=>N(s.id),sx:{color:t.error},children:e.jsx(Y,{})})})]})]},s.id)),h.length===0&&e.jsx(x,{children:e.jsx(r,{colSpan:6,sx:{textAlign:"center",color:t.text.muted,py:4},children:"No backup jobs configured"})})]})]})]}),e.jsxs(z,{sx:{background:t.background.card,border:`1px solid ${t.border.light}`},children:[e.jsx(n,{sx:{p:2,borderBottom:`1px solid ${t.border.light}`},children:e.jsx(i,{sx:{color:t.text.primary,fontWeight:600},children:"Recent Backups"})}),e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs(x,{children:[e.jsx(r,{sx:{color:t.text.muted},children:"Job"}),e.jsx(r,{sx:{color:t.text.muted},children:"Started"}),e.jsx(r,{sx:{color:t.text.muted},children:"Duration"}),e.jsx(r,{sx:{color:t.text.muted},children:"Size"}),e.jsx(r,{sx:{color:t.text.muted},children:"Status"})]})}),e.jsxs(R,{children:[o.slice(0,10).map(s=>e.jsxs(x,{children:[e.jsx(r,{sx:{color:t.text.primary},children:s.job_name}),e.jsx(r,{sx:{color:t.text.secondary,fontSize:"0.85rem"},children:new Date(s.started_at).toLocaleString()}),e.jsx(r,{sx:{color:t.text.muted},children:s.ended_at?`${Math.round((new Date(s.ended_at)-new Date(s.started_at))/1e3)}s`:"-"}),e.jsx(r,{sx:{color:t.text.muted},children:D(s.size)}),e.jsx(r,{children:e.jsx(J,{label:s.status,size:"small",color:s.status==="success"?"success":s.status==="running"?"primary":"error"})})]},s.id)),o.length===0&&e.jsx(x,{children:e.jsx(r,{colSpan:5,sx:{textAlign:"center",color:t.text.muted,py:4},children:"No backup history"})})]})]})]}),e.jsxs(q,{open:F,onClose:()=>g(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(K,{children:"Create Backup Job"}),e.jsx(X,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(b,{label:"Job Name",value:a.name,onChange:s=>d({...a,name:s.target.value}),fullWidth:!0}),e.jsx(b,{select:!0,label:"Machine",value:a.machine_id,onChange:s=>d({...a,machine_id:s.target.value}),fullWidth:!0,children:y.map(s=>e.jsxs(Q,{value:s.id,children:[s.name," (",s.ip,")"]},s.id))}),e.jsx(b,{label:"Source Path",value:a.source_path,onChange:s=>d({...a,source_path:s.target.value}),fullWidth:!0,placeholder:"/home/user/data"}),e.jsx(b,{label:"Destination Path",value:a.dest_path,onChange:s=>d({...a,dest_path:s.target.value}),fullWidth:!0,placeholder:"/backups"}),e.jsx(te,{control:e.jsx(re,{checked:a.compress,onChange:s=>d({...a,compress:s.target.checked})}),label:"Compress backup (tar.gz)"})]})}),e.jsxs(ae,{children:[e.jsx(w,{onClick:()=>g(!1),children:"Cancel"}),e.jsx(w,{variant:"contained",onClick:M,disabled:!a.name||!a.machine_id||!a.source_path,children:"Create"})]})]})]})};export{be as default};
