import{r as a,j as e,B as n,T as h,a3 as J,a4 as K,a1 as N,n as Q,m as d,R as X,V as C,k as Z,I as _,S as ee,C as f,l as m,P as se,ag as te,D as ae,w as ne,x as re,b as le,E as D}from"./index-CeKcXHK_.js";import{S as ie}from"./Stop-BjDzNpZ8.js";import{R as oe}from"./RestartAlt-5nZOMyV5.js";import{P as ce}from"./PowerSettingsNew-D2RzJa_P.js";import{A as P}from"./Article-BT4et1WH.js";import{C as de}from"./CheckCircle-D57u65eu.js";import{P as xe}from"./PauseCircle-CmNhM1Mg.js";import{C as w}from"./Chip-D-0MwXDn.js";import{T as he,a as z}from"./Tab-y_F0SjNS.js";import{T as fe,a as me,b as $,c as i,d as ue}from"./TableRow-APGMPqgQ.js";import{D as je}from"./DialogActions-CfuqQ9qs.js";const ve=()=>{const[F,R]=a.useState([]),[r,E]=a.useState(""),[M,B]=a.useState([]),[p,I]=a.useState(!1),[b,V]=a.useState(""),[o,U]=a.useState("all"),[c,T]=a.useState({}),[S,x]=a.useState({open:!1,service:null,logs:""}),[H,L]=a.useState(!1),[y,O]=a.useState(0);a.useEffect(()=>{fetch("/api/machines").then(s=>s.json()).then(s=>R(s||[])).catch(console.error)},[]);const u=a.useCallback(async()=>{if(r){I(!0);try{const t=await(await fetch(`/api/machines/${r}/services`)).json();B(t.services||[])}catch(s){console.error("Failed to load services:",s)}finally{I(!1)}}},[r]);a.useEffect(()=>{r&&u()},[r,u]);const j=async(s,t)=>{T(l=>({...l,[s]:t}));try{(await(await fetch(`/api/machines/${r}/service/${s}/${t}`,{method:"POST"})).json()).success&&setTimeout(u,1e3)}catch(l){console.error(`Failed to ${t} service:`,l)}finally{T(l=>({...l,[s]:null}))}},Y=async s=>{x({open:!0,service:s,logs:""}),L(!0);try{const l=await(await fetch(`/api/machines/${r}/service/${s}/logs?lines=100`)).json();x(k=>({...k,logs:l.logs||"No logs available"}))}catch(t){x(l=>({...l,logs:"Failed to load logs: "+t.message}))}finally{L(!1)}},q=s=>{switch(s){case"running":case"active":return e.jsx(de,{sx:{color:"#22c55e",fontSize:20}});case"stopped":case"inactive":case"dead":return e.jsx(D,{sx:{color:"#ff6b6b",fontSize:20}});case"failed":return e.jsx(D,{sx:{color:"#ff3366",fontSize:20}});default:return e.jsx(xe,{sx:{color:"#ffaa00",fontSize:20}})}},G=s=>{switch(s){case"running":case"active":return"success";case"stopped":case"inactive":case"dead":return"error";case"failed":return"error";default:return"warning"}},g=M.filter(s=>{const t=s.name.toLowerCase().includes(b.toLowerCase())||s.description&&s.description.toLowerCase().includes(b.toLowerCase());return o==="all"?t:o==="running"?t&&(s.status==="running"||s.status==="active"):o==="stopped"?t&&(s.status==="stopped"||s.status==="inactive"||s.status==="dead"):o==="failed"?t&&s.status==="failed":o==="enabled"?t&&s.enabled:t}),v=g.filter(s=>!s.name.includes("@")&&!s.isUser),A=g.filter(s=>s.isUser),W=g.filter(s=>s.name.endsWith(".timer"));return e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(h,{variant:"h4",sx:{fontWeight:700},children:"Services Manager"}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsxs(J,{size:"small",sx:{minWidth:200},children:[e.jsx(K,{children:"Machine"}),e.jsx(N,{value:r,onChange:s=>E(s.target.value),label:"Machine",children:F.map(s=>e.jsx(Q,{value:s.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:s.status==="online"?"#22c55e":"#ff3366"}}),s.name]})},s.id))})]}),e.jsx(d,{onClick:u,disabled:!r||p,children:e.jsx(X,{sx:{color:p?"grey":"#f97316"}})})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:{p:2,mb:3},children:e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(Z,{size:"small",placeholder:"Search services...",value:b,onChange:s=>V(s.target.value),InputProps:{startAdornment:e.jsx(_,{position:"start",children:e.jsx(ee,{sx:{color:"rgba(255,255,255,0.5)"}})})},sx:{minWidth:250}}),e.jsx(n,{sx:{display:"flex",gap:1},children:["all","running","stopped","failed","enabled"].map(s=>e.jsx(w,{label:s.charAt(0).toUpperCase()+s.slice(1),onClick:()=>U(s),color:o===s?"primary":"default",variant:o===s?"filled":"outlined",size:"small"},s))}),e.jsx(n,{sx:{flex:1}}),e.jsxs(h,{variant:"body2",color:"text.secondary",children:[g.length," services"]})]})}),e.jsxs(he,{value:y,onChange:(s,t)=>O(t),sx:{mb:2},children:[e.jsx(z,{label:`System (${v.length})`}),e.jsx(z,{label:`User (${A.length})`}),e.jsx(z,{label:`Timers (${W.length})`})]}),p?e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(f,{})}):e.jsx(C,{sx:{overflow:"hidden"},children:e.jsxs(fe,{size:"small",children:[e.jsx(me,{children:e.jsxs($,{sx:{bgcolor:"rgba(0,212,255,0.05)"},children:[e.jsx(i,{sx:{fontWeight:600},children:"Status"}),e.jsx(i,{sx:{fontWeight:600},children:"Service"}),e.jsx(i,{sx:{fontWeight:600},children:"Description"}),e.jsx(i,{sx:{fontWeight:600},children:"Enabled"}),e.jsx(i,{sx:{fontWeight:600,textAlign:"right"},children:"Actions"})]})}),e.jsx(ue,{children:(y===0?v:y===1?A:W).map(s=>e.jsxs($,{sx:{"&:hover":{bgcolor:"rgba(0,212,255,0.03)"},transition:"background-color 0.2s"},children:[e.jsx(i,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[q(s.status),e.jsx(w,{label:s.status,size:"small",color:G(s.status),sx:{fontSize:"0.7rem",height:22}})]})}),e.jsx(i,{children:e.jsx(h,{sx:{fontFamily:"monospace",fontSize:"0.85rem"},children:s.name})}),e.jsx(i,{children:e.jsx(h,{variant:"body2",color:"text.secondary",sx:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.description||"-"})}),e.jsx(i,{children:e.jsx(w,{label:s.enabled?"Yes":"No",size:"small",color:s.enabled?"success":"default",variant:"outlined",sx:{fontSize:"0.7rem",height:22}})}),e.jsx(i,{children:e.jsxs(n,{sx:{display:"flex",gap:.5,justifyContent:"flex-end"},children:[e.jsx(m,{title:"Start",children:e.jsx(d,{size:"small",onClick:()=>j(s.name,"start"),disabled:c[s.name]==="start",children:c[s.name]==="start"?e.jsx(f,{size:16}):e.jsx(se,{sx:{fontSize:18,color:"#22c55e"}})})}),e.jsx(m,{title:"Stop",children:e.jsx(d,{size:"small",onClick:()=>j(s.name,"stop"),disabled:c[s.name]==="stop",children:c[s.name]==="stop"?e.jsx(f,{size:16}):e.jsx(ie,{sx:{fontSize:18,color:"#ff6b6b"}})})}),e.jsx(m,{title:"Restart",children:e.jsx(d,{size:"small",onClick:()=>j(s.name,"restart"),disabled:c[s.name]==="restart",children:c[s.name]==="restart"?e.jsx(f,{size:16}):e.jsx(oe,{sx:{fontSize:18,color:"#ffaa00"}})})}),e.jsx(m,{title:s.enabled?"Disable":"Enable",children:e.jsx(d,{size:"small",onClick:()=>j(s.name,s.enabled?"disable":"enable"),disabled:c[s.name],children:e.jsx(ce,{sx:{fontSize:18,color:s.enabled?"#f97316":"rgba(255,255,255,0.3)"}})})}),e.jsx(m,{title:"View Logs",children:e.jsx(d,{size:"small",onClick:()=>Y(s.name),children:e.jsx(P,{sx:{fontSize:18,color:"#f97316"}})})})]})})]},s.name))})]})})]}),!r&&e.jsxs(C,{sx:{p:6,textAlign:"center"},children:[e.jsx(te,{sx:{fontSize:64,color:"rgba(255,255,255,0.1)",mb:2}}),e.jsx(h,{color:"text.secondary",children:"Select a machine to manage systemd services"})]}),e.jsxs(ae,{open:S.open,onClose:()=>x({open:!1,service:null,logs:""}),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(ne,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{}),"Logs: ",S.service]}),e.jsx(re,{children:H?e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(f,{})}):e.jsx(n,{sx:{bgcolor:"#0d1117",p:2,borderRadius:1,fontFamily:"monospace",fontSize:"0.8rem",maxHeight:500,overflow:"auto",whiteSpace:"pre-wrap",color:"#e0f7ff"},children:S.logs})}),e.jsx(je,{children:e.jsx(le,{onClick:()=>x({open:!1,service:null,logs:""}),children:"Close"})})]})]})};export{ve as default};
