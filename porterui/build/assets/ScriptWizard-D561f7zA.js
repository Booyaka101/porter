import{c as ge,j as e,r as x,B as r,g as t,G as D,T as n,l as G,m as _,af as me,P as Y,a8 as Be,u as Le,ab as He,C as ee,w as A,b as P,X as De,e as L,f as H,d as se,i as _e,ag as de,a6 as ue,k as Je}from"./index-BR8HzIu-.js";import{A as V}from"./ArrowBack-fMblk9rH.js";import{g as Ue,p as xe,A as Ve,R as Ge,a as Ye}from"./presets-IJFGqX13.js";import{S as pe}from"./Stop-CnP__ldM.js";import{C as B}from"./CheckCircle-CQPaGP6K.js";import{W as te}from"./Warning-fEOO2xk0.js";import{S as Xe}from"./Star-B4L1ngbP.js";import{C as re}from"./ContentCopy-BXv6Dy4a.js";import{H as X}from"./HourglassEmpty-DjgK1njh.js";import{E as fe}from"./ExpandLess-CoaLL_5p.js";import{C as E}from"./Chip-CiJfAjDW.js";import{L as K}from"./LinearProgress-W34AkTm_.js";import{C as be}from"./Collapse-B-GfTmDy.js";import{S as Ke}from"./Switch-HbuDhUMd.js";import{C as qe}from"./Checkbox-DjmnloIS.js";import"./SwitchBase-CXhs4CjE.js";const he=ge(e.jsx("path",{d:"M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7"})),Qe=ge(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.89-2-2-2m0 16H5V7h14zm-5.5-6c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5M12 9c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"})),Ze=l=>{const v=[];let u=null,p=null;return l.forEach(I=>{const m=I.data||"",w=m.match(/^=== PLAY \[(.+)\] ===$/);if(w){u&&u.status==="running"?(u.status="success",v.push(u)):u&&v.push(u),u={name:w[1],status:"running",tasks:[],startTime:I.timestamp,logs:[]},p=null;return}const g=m.match(/^TASK \[(\d+)\] (.+)$/);if(g&&u){p={number:parseInt(g[1]),name:g[2],status:"running",logs:[]},u.tasks.push(p);return}if(m.includes("...ok")&&p){p.status="success",p=null;return}if(m.includes("...FAILED")&&p){p.status="failed",u&&(u.status="failed"),p=null;return}if(m.includes("...skipped")&&p){p.status="skipped",p=null;return}const y=m.match(/EXIT_CODE:(\d+)/);if(y){const h=parseInt(y[1]);u&&(u.status=h===0?"success":"failed",v.push(u),u=null);return}p?p.logs.push(m):u&&u.logs.push(m)}),u&&v.push(u),v},es=({stage:l,isLast:v})=>{const[u,p]=x.useState(l.status==="running"||l.status==="failed"),I=()=>{switch(l.status){case"success":return e.jsx(B,{sx:{color:t.secondary,fontSize:20}});case"failed":return e.jsx(D,{sx:{color:t.error,fontSize:20}});case"running":return e.jsx(X,{sx:{color:t.warning,fontSize:20,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}});default:return e.jsx(Y,{sx:{color:t.text.disabled,fontSize:20}})}},m=()=>{switch(l.status){case"success":return t.secondary;case"failed":return t.error;case"running":return t.warning;default:return t.text.disabled}},w=l.tasks.filter(h=>h.status==="success").length,g=l.tasks.filter(h=>h.status==="failed").length,y=l.tasks.length;return e.jsxs(r,{sx:{mb:1},children:[e.jsxs(r,{onClick:()=>p(!u),sx:{display:"flex",alignItems:"center",gap:1.5,p:1.5,cursor:"pointer",background:`linear-gradient(90deg, ${m()}15 0%, transparent 100%)`,borderLeft:`3px solid ${m()}`,borderRadius:"0 8px 8px 0",transition:"all 0.2s","&:hover":{background:`linear-gradient(90deg, ${m()}25 0%, transparent 100%)`}},children:[I(),e.jsx(n,{sx:{flex:1,fontWeight:600,color:t.text.primary,fontSize:"0.95rem"},children:l.name}),y>0&&e.jsxs(r,{sx:{display:"flex",gap:.5},children:[w>0&&e.jsx(E,{size:"small",label:`${w} âœ“`,sx:{height:22,fontSize:"0.75rem",background:`${t.secondary}30`,color:t.secondary}}),g>0&&e.jsx(E,{size:"small",label:`${g} âœ—`,sx:{height:22,fontSize:"0.75rem",background:`${t.error}30`,color:t.error}}),l.status==="running"&&e.jsx(E,{size:"small",label:`${w}/${y}`,sx:{height:22,fontSize:"0.75rem",background:`${t.warning}30`,color:t.warning}})]}),e.jsx(_,{size:"small",sx:{color:t.text.disabled},children:u?e.jsx(fe,{fontSize:"small"}):e.jsx(me,{fontSize:"small"})})]}),l.status==="running"&&e.jsx(K,{variant:y>0?"determinate":"indeterminate",value:y>0?w/y*100:0,sx:{height:2,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),e.jsx(be,{in:u,children:e.jsxs(r,{sx:{pl:4,pr:2,py:1},children:[l.tasks.map((h,R)=>e.jsx(ss,{task:h},R)),l.logs.filter(h=>h.trim()).length>0&&e.jsx(r,{sx:{mt:1,p:1.5,background:"rgba(0,0,0,0.3)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.8rem",color:t.text.muted,maxHeight:150,overflow:"auto"},children:l.logs.filter(h=>h.trim()).map((h,R)=>e.jsx(r,{sx:{whiteSpace:"pre-wrap"},children:h},R))})]})})]})},ss=({task:l})=>{const v=()=>{switch(l.status){case"success":return e.jsx(B,{sx:{color:t.secondary,fontSize:16}});case"failed":return e.jsx(D,{sx:{color:t.error,fontSize:16}});case"skipped":return e.jsx(Y,{sx:{color:t.text.disabled,fontSize:16}});case"running":return e.jsx(X,{sx:{color:t.warning,fontSize:16,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}});default:return null}},u=()=>{switch(l.status){case"success":return t.secondary;case"failed":return t.error;case"running":return t.warning;default:return t.text.disabled}};return e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,py:.5,borderLeft:`2px solid ${u()}40`,pl:1.5,mb:.5},children:[v(),e.jsx(n,{sx:{fontSize:"0.85rem",color:l.status==="failed"?t.error:t.text.secondary},children:l.name}),l.status==="failed"&&l.logs.length>0&&e.jsxs(n,{sx:{fontSize:"0.75rem",color:t.error,opacity:.8,ml:"auto"},children:[l.logs[l.logs.length-1]?.substring(0,50),"..."]})]})},ts=({events:l,status:v,machineName:u})=>{const p=x.useMemo(()=>Ze(l),[l]),I=x.useRef(null),[m,w]=x.useState(!1),[g,y]=x.useState(!1);x.useEffect(()=>{I.current&&(I.current.scrollTop=I.current.scrollHeight)},[p]);const h=()=>{const C=l.map(f=>f.data).join(`
`);navigator.clipboard.writeText(C),y(!0),setTimeout(()=>y(!1),2e3)},R=()=>v==="complete"?"success":v==="error"?"failed":"running",S=()=>{switch(R()){case"success":return t.secondary;case"failed":return t.error;default:return t.warning}},W=p.filter(C=>C.status==="success").length,T=p.filter(C=>C.status==="failed").length;return e.jsxs(r,{sx:{background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",border:`1px solid ${S()}33`,overflow:"hidden"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,p:2,background:`${S()}10`,borderBottom:`1px solid ${t.border.light}`},children:[R()==="success"&&e.jsx(B,{sx:{color:t.secondary,fontSize:28}}),R()==="failed"&&e.jsx(D,{sx:{color:t.error,fontSize:28}}),R()==="running"&&e.jsx(X,{sx:{color:t.warning,fontSize:28,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(n,{sx:{color:t.text.primary,fontWeight:600,fontSize:"1.1rem"},children:u}),e.jsxs(n,{sx:{color:t.text.muted,fontSize:"0.85rem"},children:[p.length," stages â€¢ ",W," completed",T>0&&` â€¢ ${T} failed`]})]}),e.jsx(G,{title:m?"Show stages":"Show raw output",children:e.jsx(E,{label:m?"Stages":"Raw",size:"small",onClick:()=>w(!m),sx:{cursor:"pointer",background:"rgba(255,255,255,0.1)",color:t.text.secondary}})}),e.jsx(G,{title:"Copy output",children:e.jsx(_,{size:"small",onClick:h,sx:{color:g?t.secondary:t.text.disabled},children:e.jsx(re,{fontSize:"small"})})})]}),R()==="running"&&e.jsx(K,{sx:{height:3,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),e.jsx(r,{ref:I,sx:{maxHeight:"60vh",minHeight:200,overflow:"auto",p:2},children:m?e.jsx(r,{sx:{fontFamily:'"JetBrains Mono", monospace',fontSize:"0.85rem",lineHeight:1.5},children:l.map((C,f)=>e.jsx(r,{sx:{color:C.type==="error"?t.error:t.text.secondary,whiteSpace:"pre-wrap",mb:.25},children:C.data},f))}):p.length>0?p.map((C,f)=>e.jsx(es,{stage:C,isLast:f===p.length-1},f)):e.jsx(n,{sx:{color:t.text.disabled,fontStyle:"italic"},children:"Waiting for output..."})})]})},rs=({execId:l,machineName:v,machineId:u,onComplete:p,useStageView:I=!0})=>{const[m,w]=x.useState([]),[g,y]=x.useState("connecting"),[h,R]=x.useState(!0),[S,W]=x.useState(!1),T=x.useRef(null),C=x.useRef(null);x.useEffect(()=>{if(!l)return;const a=new EventSource(`/api/stream/${l}`);return C.current=a,a.addEventListener("connected",b=>{y("running")}),a.addEventListener("status",b=>{try{const j=JSON.parse(b.data);w($=>[...$,{type:"status",...j}])}catch(j){console.error("Failed to parse status event:",j)}}),a.addEventListener("output",b=>{try{const j=JSON.parse(b.data);w($=>[...$,{type:"output",...j}])}catch(j){console.error("Failed to parse output event:",j)}}),a.addEventListener("error",b=>{try{const j=JSON.parse(b.data);w($=>[...$,{type:"error",...j}]),y("error")}catch{a.readyState===EventSource.CLOSED&&y("error")}}),a.addEventListener("complete",b=>{try{const j=JSON.parse(b.data);w($=>[...$,{type:"complete",...j}]),y(j.data?.includes("true")?"complete":"error"),p?.(j)}catch{y("complete")}a.close()}),a.onerror=()=>{a.readyState===EventSource.CLOSED&&y("error")},()=>{a.close()}},[l,p]),x.useEffect(()=>{T.current&&h&&(T.current.scrollTop=T.current.scrollHeight)},[m,h]);const f=()=>{switch(g){case"complete":return e.jsx(B,{sx:{color:t.secondary}});case"error":return e.jsx(D,{sx:{color:t.error}});default:return e.jsx(X,{sx:{color:t.warning,animation:"spin 1s linear infinite","@keyframes spin":{"100%":{transform:"rotate(360deg)"}}}})}},F=()=>{switch(g){case"complete":return t.secondary;case"error":return t.error;default:return t.warning}},J=()=>{const a=m.filter(b=>b.type==="output"||b.type==="status").map(b=>b.data).join(`
`);navigator.clipboard.writeText(a),W(!0),setTimeout(()=>W(!1),2e3)},O=a=>a?new Date(a).toLocaleTimeString():"";return I?e.jsx(ts,{events:m,status:g,machineName:v}):e.jsxs(r,{sx:{background:"rgba(0, 0, 0, 0.3)",borderRadius:"12px",border:`1px solid ${F()}33`,overflow:"hidden"},children:[e.jsxs(r,{onClick:()=>R(!h),sx:{display:"flex",alignItems:"center",gap:2,p:2,cursor:"pointer",background:`${F()}10`,borderBottom:h?`1px solid ${t.border.light}`:"none"},children:[f(),e.jsxs(r,{sx:{flex:1},children:[e.jsx(n,{sx:{color:t.text.primary,fontWeight:600},children:v}),e.jsxs(n,{sx:{color:t.text.disabled,fontSize:"0.75rem"},children:[g==="connecting"&&"Connecting...",g==="running"&&"Running...",g==="complete"&&"Completed successfully",g==="error"&&"Failed"]})]}),e.jsx(E,{label:g,size:"small",sx:{background:`${F()}20`,color:F(),textTransform:"capitalize"}}),e.jsx(G,{title:"Copy output",children:e.jsx(_,{size:"small",onClick:a=>{a.stopPropagation(),J()},sx:{color:S?t.secondary:t.text.disabled},children:e.jsx(re,{fontSize:"small"})})}),e.jsx(_,{size:"small",sx:{color:t.text.disabled},children:h?e.jsx(fe,{}):e.jsx(me,{})})]}),g==="running"&&e.jsx(K,{sx:{height:2,background:"rgba(0,0,0,0.2)","& .MuiLinearProgress-bar":{background:`linear-gradient(90deg, ${t.primary} 0%, ${t.secondary} 100%)`}}}),h&&e.jsx(r,{ref:T,sx:{maxHeight:"60vh",minHeight:200,overflow:"auto",p:2,fontFamily:'"JetBrains Mono", "Fira Code", monospace',fontSize:"0.85rem",lineHeight:1.5,background:"rgba(0, 0, 0, 0.4)"},children:m.length===0?e.jsx(n,{sx:{color:t.text.disabled,fontStyle:"italic"},children:"Waiting for output..."}):m.map((a,b)=>e.jsxs(r,{sx:{display:"flex",gap:1,mb:.5,color:a.type==="error"?t.error:a.type==="status"?t.primary:t.text.secondary},children:[e.jsx(n,{component:"span",sx:{color:t.text.disabled,fontSize:"0.75rem",minWidth:85,flexShrink:0,opacity:.7},children:O(a.timestamp)}),e.jsx(n,{component:"span",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:a.data})]},b))})]})},ws=()=>{const{scriptPath:l}=Be(),v=Le(),[u]=He(),p=decodeURIComponent(l||""),I=u.get("machines")?.split(",").filter(Boolean)||[],m=u.get("execId"),w=u.get("step")?parseInt(u.get("step"),10)-1:null,[g,y]=x.useState(null),[h,R]=x.useState([]),[S,W]=x.useState([]),[T,C]=x.useState({}),[f,F]=x.useState(0),[J,O]=x.useState(!1),[a,b]=x.useState(null),[j,$]=x.useState(null),[je,q]=x.useState([]),[ye,Se]=x.useState(!0),[U,ve]=x.useState(null),[M,Q]=x.useState(null),[ne,ae]=x.useState(!1),[ns,we]=x.useState({}),[as,os]=x.useState(!1),[ke,oe]=x.useState(!1);x.useEffect(()=>{ze(),Ie()},[p]),x.useEffect(()=>{m&&h.length>0&&Ce(m)},[m,h]);const Ce=async o=>{try{const i=await fetch(`/api/script-executions/${o}`);if(!i.ok)return;const c=await i.json();if(c.status==="running"){O(!0),$(o),b(c),F(2),c.machine_ids&&W(c.machine_ids);const z=(c.machine_ids||[]).map(d=>{const k=h.find(N=>N.id===d);return{execId:o,machineId:d,machineName:k?.name||d}});q(z);const s=async()=>{const k=await(await fetch(`/api/script-executions/${o}`)).json();b(k),k.status==="running"?setTimeout(s,2e3):O(!1)};setTimeout(s,2e3)}}catch(i){console.error("Failed to reconnect to execution:",i)}},ze=async()=>{try{const c=(await(await fetch("/api/scripts")).json()).find(z=>z.path===p);if(c){y(c);const z={};c.flags?.forEach(k=>{z[k.long]={enabled:!1,value:""}}),C(z);const s=Ue(c.path);ve(s);const d=s.presets?.find(k=>k.recommended);d&&(Q(d),C(xe(d,c.flags)))}}catch(o){console.error("Failed to fetch script:",o)}finally{Se(!1)}},Ie=async()=>{try{const i=await(await fetch("/api/machines")).json();if(R(i||[]),I.length>0&&i){const c=I.filter(z=>i.some(s=>s.id===z));c.length>0&&(W(c),w!==null&&w>=0&&w<=2?F(w):F(1))}}catch(o){console.error("Failed to fetch machines:",o)}},Ee=o=>{W(i=>i.includes(o)?i.filter(c=>c!==o):[...i,o])},Re=o=>{Q(null),C(i=>({...i,[o]:{...i[o],enabled:!i[o]?.enabled}}))},Te=o=>{Q(o),we({}),U?.useArgs||C(xe(o,g?.flags))},$e=(o,i)=>{C(c=>({...c,[o]:{...c[o],value:i}}))},ie=()=>{if(U?.useArgs&&M?.args)return M.args;const o=[];return Object.entries(T).forEach(([i,c])=>{c.enabled&&(c.value?o.push(`${i}=${c.value}`):o.push(i))}),o.join(" ")},ce=()=>{const o=ie();return`${g?.path||"script.sh"}${o?" "+o:""}`},Pe=()=>{navigator.clipboard.writeText(ce()),oe(!0),setTimeout(()=>oe(!1),2e3)},le=async()=>{O(!0),b(null),$(null),q([]);try{const o=ie(),c=await(await fetch("/api/execute-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({script_path:g.path,machine_ids:S,args:o})})).json();if(b(c),c.id){$(c.id);const z=S.map(d=>{const k=h.find(N=>N.id===d);return{execId:c.id,machineId:d,machineName:k?.name||d}});q(z);const s=async()=>{const k=await(await fetch(`/api/script-executions/${c.id}`)).json();b(k),k.status==="running"?setTimeout(s,2e3):O(!1)};setTimeout(s,2e3)}else O(!1)}catch(o){console.error("Execution failed:",o),b({error:o.message}),O(!1)}},Fe=()=>{},Oe=async()=>{if(j)try{(await(await fetch(`/api/script-executions/${j}/cancel`,{method:"POST"})).json()).success&&(b(c=>({...c,status:"cancelled"})),O(!1))}catch(o){console.error("Failed to cancel execution:",o)}},Z=["Select Machines","Configure Options","Review & Execute"],Ne=()=>F(o=>o+1),We=()=>F(o=>o-1),Me=()=>f===0?S.length>0:!0;if(ye)return e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(ee,{})});if(!g)return e.jsxs(r,{sx:{p:3},children:[e.jsxs(A,{severity:"error",children:["Script not found: ",p]}),e.jsx(P,{startIcon:e.jsx(V,{}),onClick:()=>v("/scripts"),sx:{mt:2},children:"Back to Scripts"})]});const Ae=o=>{switch(o){case 0:return e.jsxs(r,{children:[e.jsxs(A,{severity:"info",icon:e.jsx(he,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 1 of 3: Pick Your Computers"}),e.jsx(n,{variant:"body2",children:"Click on the computers below where you want to run this script. You can select multiple computers to run the same script on all of them at once."})]}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(se,{color:"primary"}),"Which computers do you want to use?"]}),h.length===0?e.jsxs(A,{severity:"warning",sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",children:"No computers set up yet!"}),e.jsx(n,{variant:"body2",sx:{mb:1},children:"You need to add at least one computer before you can run scripts."}),e.jsx(P,{variant:"contained",size:"small",onClick:()=>v("/machines"),children:"Add a Computer Now"})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:S.length===0?"ðŸ‘† Click on a computer to select it":`âœ… ${S.length} computer${S.length>1?"s":""} selected`}),S.some(s=>h.find(d=>d.id===s)?.status!=="online")&&e.jsxs(A,{severity:"warning",icon:e.jsx(te,{}),sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",children:"âš ï¸ Some selected machines are offline"}),e.jsx(n,{variant:"body2",children:"Scripts may fail on offline machines. Consider testing connections first."})]}),e.jsx(ue,{children:h.map(s=>e.jsx(L,{sx:{mb:1.5,border:2,borderColor:S.includes(s.id)?"primary.main":"transparent",bgcolor:S.includes(s.id)?"primary.dark":"background.paper",cursor:"pointer",transition:"all 0.2s","&:hover":{borderColor:"primary.light",transform:"scale(1.01)"}},onClick:()=>Ee(s.id),children:e.jsxs(H,{sx:{display:"flex",alignItems:"center",py:2},children:[e.jsx(qe,{checked:S.includes(s.id),sx:{mr:1}}),e.jsx(se,{sx:{mr:2,fontSize:40},color:s.status==="online"?"success":"disabled"}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsx(n,{variant:"h6",children:s.name||s.ip}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["IP: ",s.ip," â€¢ User: ",s.username]})]}),e.jsx(E,{label:s.status==="online"?"ðŸŸ¢ Online":"ðŸ”´ Offline",size:"medium",color:s.status==="online"?"success":"error",variant:"outlined"})]})},s.id))})]})]});case 1:const i=Object.values(T).filter(s=>s.enabled).length,c=U?.presets?.length>0;return e.jsxs(r,{children:[e.jsxs(A,{severity:"info",icon:e.jsx(he,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 2 of 3: What do you want to set up?"}),e.jsx(n,{variant:"body2",children:c?"Pick a setup type below. Each one is pre-configured for a specific use case.":"Configure the options for this script."})]}),c&&!ne&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:"ðŸŽ¯ What type of machine is this?"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Click on the option that best describes what this computer will be used for."}),e.jsx(Ge,{value:M?.id||"",children:U.presets.map(s=>e.jsx(L,{onClick:()=>Te(s),sx:{mb:2,cursor:"pointer",border:3,borderColor:M?.id===s.id?"primary.main":"transparent",bgcolor:M?.id===s.id?"primary.dark":"background.paper",transition:"all 0.2s","&:hover":{borderColor:"primary.light",transform:"scale(1.01)"}},children:e.jsx(H,{sx:{py:2},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ye,{checked:M?.id===s.id,sx:{mr:2}}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsxs(n,{variant:"h5",sx:{display:"flex",alignItems:"center",gap:1},children:[s.name,s.recommended&&e.jsx(E,{icon:e.jsx(Xe,{}),label:"Recommended",size:"small",color:"warning"})]}),e.jsx(n,{variant:"body1",color:"text.secondary",sx:{mt:1},children:s.description}),s.warning&&e.jsx(E,{icon:e.jsx(te,{}),label:s.warning,size:"small",color:"warning",variant:"outlined",sx:{mt:1}}),M?.id===s.id&&s.flags&&s.flags.length>0&&e.jsx(be,{in:!0,children:e.jsxs(r,{sx:{mt:2,p:1.5,bgcolor:"rgba(0,0,0,0.2)",borderRadius:1},children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"This preset will enable:"}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.flags.map(d=>{const k=d.replace(/^--/,"").replace(/=/g,": ").replace(/-/g," ").replace(/\b\w/g,N=>N.toUpperCase());return e.jsx(E,{label:k,size:"small",sx:{bgcolor:"rgba(249, 115, 22, 0.2)",color:"#f97316",fontSize:"0.75rem"}},d)})})]})})]}),M?.id===s.id&&e.jsx(B,{color:"primary",sx:{fontSize:40}})]})})},s.id))}),e.jsx(r,{sx:{mt:3,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(P,{startIcon:e.jsx(de,{}),onClick:()=>ae(!0),color:"inherit",size:"small",children:"Advanced: Customize individual options"})})]}),(ne||!c)&&e.jsxs(e.Fragment,{children:[c&&e.jsx(r,{sx:{mb:3},children:e.jsx(P,{startIcon:e.jsx(V,{}),onClick:()=>ae(!1),variant:"outlined",size:"small",children:"Back to Simple Mode"})}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{color:"primary"}),"Advanced Options"]}),!g.flags||g.flags.length===0?e.jsxs(A,{severity:"success",sx:{mt:2},children:[e.jsx(n,{variant:"subtitle2",children:"No options needed! ðŸŽ‰"}),e.jsx(n,{variant:"body2",children:`This script doesn't have any options to configure. Just click "Next" to continue.`})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i===0?"ðŸ’¡ All options are OFF. Turn on what you need.":`âœ… ${i} option${i>1?"s":""} turned ON`}),e.jsx(ue,{children:g.flags.map(s=>{const d=T[s.long]?.enabled||!1,k=s.long.replace("--","").replace(/-/g," ").replace(/\b\w/g,N=>N.toUpperCase());return e.jsx(L,{sx:{mb:1.5,border:2,borderColor:d?"success.main":"transparent",bgcolor:d?"success.dark":"background.paper",transition:"all 0.2s"},children:e.jsx(H,{sx:{py:2},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ke,{checked:d,onChange:()=>Re(s.long),color:"success",sx:{mr:2}}),e.jsxs(r,{sx:{flexGrow:1},children:[e.jsxs(n,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[k,s.has_value&&e.jsx(E,{label:"needs a value",size:"small",color:"warning",variant:"outlined"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:s.description||"No description available"}),s.has_value&&d&&e.jsx(Je,{fullWidth:!0,size:"medium",label:`Enter ${s.value_hint||"value"}`,value:T[s.long]?.value||"",onChange:N=>$e(s.long,N.target.value),sx:{mt:2},placeholder:`Example: ${s.value_hint||"your-value"}`,helperText:`Type the ${s.value_hint||"value"} you want to use`,variant:"outlined"})]}),e.jsx(n,{variant:"body2",sx:{ml:2,color:d?"success.light":"text.disabled",fontWeight:"bold"},children:d?"ON":"OFF"})]})})},s.long)})})]})]})]});case 2:const z=Object.entries(T).filter(([s,d])=>d.enabled);return e.jsxs(r,{children:[e.jsxs(A,{severity:"warning",icon:e.jsx(te,{}),sx:{mb:3},children:[e.jsx(n,{variant:"subtitle2",children:"Step 3 of 3: Ready to Run!"}),e.jsx(n,{variant:"body2",children:"Double-check everything below. When you click the big green button, the script will run on your selected computers. This cannot be undone!"})]}),e.jsxs(n,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{color:"primary"}),"Here's what will happen:"]}),e.jsx(L,{sx:{mb:2,bgcolor:"primary.dark"},children:e.jsxs(H,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:"SCRIPT"}),e.jsx(n,{variant:"h6",children:g.name}),e.jsx(n,{variant:"body2",color:"text.secondary",children:g.description})]})}),e.jsx(L,{sx:{mb:2,bgcolor:"info.dark"},children:e.jsxs(H,{children:[e.jsxs(n,{variant:"overline",color:"text.secondary",children:["RUNNING ON ",S.length," COMPUTER",S.length>1?"S":""]}),e.jsx(r,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:1},children:S.map(s=>{const d=h.find(k=>k.id===s);return e.jsx(E,{icon:e.jsx(se,{}),label:d?.name||d?.ip||s,color:"info",sx:{fontSize:"1rem",py:2}},s)})})]})}),e.jsx(L,{sx:{mb:2,bgcolor:z.length>0?"success.dark":"grey.800"},children:e.jsxs(H,{children:[e.jsx(n,{variant:"overline",color:"text.secondary",children:z.length>0?`WITH ${z.length} OPTION${z.length>1?"S":""} ENABLED`:"USING DEFAULT SETTINGS (NO OPTIONS)"}),z.length>0?e.jsx(r,{sx:{mt:1},children:z.map(([s,d])=>e.jsx(E,{label:d.value?`${s}=${d.value}`:s,sx:{mr:1,mb:1},color:"success"},s))}):e.jsx(n,{variant:"body2",sx:{mt:1},children:"The script will run with its default behavior."})]})}),e.jsx(L,{sx:{mb:2,bgcolor:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)"},children:e.jsxs(H,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Qe,{sx:{color:"#8b5cf6"}}),e.jsx(n,{variant:"overline",sx:{color:"#8b5cf6"},children:"DRY-RUN PREVIEW"})]}),e.jsx(G,{title:ke?"Copied!":"Copy command",children:e.jsx(_,{size:"small",onClick:Pe,sx:{color:"#8b5cf6"},children:e.jsx(re,{fontSize:"small"})})})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:"This is the command that will be executed on each machine:"}),e.jsxs(r,{sx:{p:2,bgcolor:"rgba(0,0,0,0.4)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.9rem",color:"#a5f3fc",overflow:"auto"},children:[e.jsx(_e,{sx:{fontSize:14,mr:1,verticalAlign:"middle",color:"#8b5cf6"}}),ce()]}),e.jsx(n,{variant:"caption",sx:{display:"block",mt:1,color:"text.disabled"},children:"ðŸ’¡ Tip: Copy this command to test manually before running on all machines"})]})}),a&&e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,p:2,borderRadius:2,background:a.status==="completed"?"linear-gradient(135deg, rgba(0,200,100,0.2) 0%, rgba(0,150,80,0.1) 100%)":a.status==="failed"?"linear-gradient(135deg, rgba(255,80,80,0.2) 0%, rgba(200,50,50,0.1) 100%)":a.status==="cancelled"?"linear-gradient(135deg, rgba(255,152,0,0.2) 0%, rgba(200,120,0,0.1) 100%)":"linear-gradient(135deg, rgba(0,180,255,0.2) 0%, rgba(0,120,200,0.1) 100%)",border:"1px solid",borderColor:a.status==="completed"?"rgba(0,200,100,0.3)":a.status==="failed"?"rgba(255,80,80,0.3)":a.status==="cancelled"?"rgba(255,152,0,0.3)":"rgba(0,180,255,0.3)"},children:[a.status==="running"&&e.jsx(ee,{size:32,sx:{color:"#00b4ff"}}),a.status==="completed"&&e.jsx(B,{sx:{fontSize:32,color:"#00c864"}}),a.status==="failed"&&e.jsx(D,{sx:{fontSize:32,color:"#ff5050"}}),a.status==="cancelled"&&e.jsx(pe,{sx:{fontSize:32,color:"#ff9800"}}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:[a.status==="running"&&"Executing...",a.status==="completed"&&"Completed Successfully",a.status==="failed"&&"Execution Failed",a.status==="cancelled"&&"Execution Cancelled"]}),e.jsxs(n,{variant:"body2",sx:{opacity:.7},children:[a.status==="running"&&`Running on ${S.length} machine(s)`,a.status==="completed"&&"All tasks completed",a.status==="failed"&&"Check output below for details",a.status==="cancelled"&&"Execution was cancelled"]})]}),a.status==="running"&&e.jsxs(e.Fragment,{children:[e.jsx(E,{label:`${a.results?.length||0}/${S.length}`,sx:{background:"rgba(0,180,255,0.2)",color:"#00b4ff",fontWeight:600}}),e.jsx(P,{variant:"contained",color:"error",startIcon:e.jsx(pe,{}),onClick:Oe,sx:{ml:1,background:"linear-gradient(135deg, #ff5050 0%, #cc3030 100%)","&:hover":{background:"linear-gradient(135deg, #ff6060 0%, #dd4040 100%)"}},children:"Stop"})]})]}),j&&e.jsx(r,{sx:{flex:1},children:je.map(s=>e.jsx(rs,{execId:s.execId,machineName:s.machineName,machineId:s.machineId,onComplete:Fe},s.machineId))}),a.status!=="running"&&a.results?.length>0&&!j&&e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:a.results.map((s,d)=>e.jsxs(r,{sx:{p:2,borderRadius:2,background:"rgba(0,0,0,0.3)",border:"1px solid",borderColor:s.success?"rgba(0,200,100,0.3)":"rgba(255,80,80,0.3)",borderLeft:"3px solid",borderLeftColor:s.success?"#00c864":"#ff5050"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[s.success?e.jsx(B,{sx:{color:"#00c864",fontSize:20}}):e.jsx(D,{sx:{color:"#ff5050",fontSize:20}}),e.jsx(n,{sx:{fontWeight:600},children:s.machine_name||"Machine"}),e.jsx(E,{label:s.success?"Success":"Failed",size:"small",sx:{ml:"auto",background:s.success?"rgba(0,200,100,0.2)":"rgba(255,80,80,0.2)",color:s.success?"#00c864":"#ff5050"}})]}),s.output&&e.jsx(r,{sx:{mt:1,p:2,bgcolor:"rgba(0,0,0,0.4)",borderRadius:1,fontFamily:'"JetBrains Mono", monospace',fontSize:"0.8rem",lineHeight:1.5,maxHeight:"40vh",overflow:"auto",whiteSpace:"pre-wrap"},children:s.output}),s.error&&e.jsx(A,{severity:"error",sx:{mt:1},children:s.error})]},d))}),a.status==="running"&&!j&&e.jsxs(r,{sx:{textAlign:"center",py:4,background:"rgba(0,0,0,0.2)",borderRadius:2},children:[e.jsx(ee,{size:32,sx:{mb:2,color:"#00b4ff"}}),e.jsx(n,{sx:{opacity:.7},children:"Connecting to machines..."})]})]}),J&&!a&&e.jsxs(r,{sx:{mb:2},children:[e.jsx(K,{sx:{height:8,borderRadius:4}}),e.jsx(n,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:"Starting execution..."})]}),a&&a.status!=="running"&&e.jsxs(r,{sx:{display:"flex",gap:2},children:[e.jsx(P,{variant:"outlined",size:"large",onClick:()=>v("/scripts"),fullWidth:!0,children:"Back to Scripts"}),e.jsx(P,{variant:"contained",color:"primary",size:"large",startIcon:e.jsx(Y,{}),onClick:()=>{b(null),le()},fullWidth:!0,children:"Run Again"})]})]});default:return null}};return e.jsxs(r,{sx:{p:2,maxWidth:1200,mx:"auto",display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",gap:1.5,overflow:"hidden"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,flexShrink:0},children:[e.jsx(P,{startIcon:e.jsx(V,{}),onClick:()=>v("/scripts"),variant:"text",sx:{color:"rgba(255,255,255,0.7)","&:hover":{color:"#f97316",background:"rgba(0,212,255,0.1)"}},children:"Back"}),e.jsx(r,{sx:{flex:1,display:"flex",alignItems:"center",gap:2,background:"linear-gradient(90deg, rgba(0,212,255,0.1) 0%, transparent 100%)",borderRadius:2,p:1.5,pl:2},children:e.jsxs(r,{children:[e.jsx(n,{variant:"h5",sx:{fontWeight:700,color:"#fff"},children:g.name}),e.jsx(n,{variant:"body2",sx:{color:"rgba(255,255,255,0.6)"},children:g.description})]})})]}),e.jsx(r,{sx:{display:"flex",alignItems:"center",gap:1,flexShrink:0,background:"rgba(0,0,0,0.3)",borderRadius:2,p:1},children:Z.map((o,i)=>e.jsxs(r,{sx:{flex:1,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5,flex:1,p:1.5,borderRadius:1.5,background:i===f?"linear-gradient(135deg, rgba(0,212,255,0.3) 0%, rgba(0,255,136,0.2) 100%)":i<f?"rgba(0,200,100,0.15)":"transparent",border:"1px solid",borderColor:i===f?"rgba(0,212,255,0.5)":i<f?"rgba(0,200,100,0.3)":"rgba(255,255,255,0.1)",transition:"all 0.3s ease"},children:[e.jsx(r,{sx:{width:28,height:28,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:i<f?"#00c864":i===f?"linear-gradient(135deg, #f97316 0%, #22c55e 100%)":"rgba(255,255,255,0.1)",color:i<=f?"#0a0a0f":"rgba(255,255,255,0.5)",fontWeight:700,fontSize:"0.85rem"},children:i<f?"âœ“":i+1}),e.jsx(n,{sx:{fontWeight:i===f?600:400,color:i===f?"#fff":i<f?"#00c864":"rgba(255,255,255,0.5)",fontSize:"0.9rem"},children:o})]}),i<Z.length-1&&e.jsx(r,{sx:{width:24,height:2,background:i<f?"#00c864":"rgba(255,255,255,0.2)",borderRadius:1}})]},o))}),e.jsx(De,{sx:{p:2,flex:1,minHeight:0,overflow:"auto",mb:1,"&::-webkit-scrollbar":{width:"12px"},"&::-webkit-scrollbar-track":{background:"#1e1e1e",borderRadius:"6px"},"&::-webkit-scrollbar-thumb":{background:"#666",borderRadius:"6px",border:"2px solid #1e1e1e"},"&::-webkit-scrollbar-thumb:hover":{background:"#888"}},children:Ae(f)}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",p:2,bgcolor:"rgba(0, 20, 40, 0.95)",borderRadius:2,border:"1px solid rgba(249, 115, 22, 0.3)",flexShrink:0,position:"sticky",bottom:0,backdropFilter:"blur(10px)"},children:[e.jsx(P,{variant:"outlined",size:"large",startIcon:e.jsx(V,{}),disabled:f===0,onClick:We,sx:{px:4},children:"â† Previous Step"}),f<Z.length-1?e.jsx(P,{variant:"contained",size:"large",endIcon:e.jsx(Ve,{}),onClick:Ne,disabled:!Me(),sx:{px:4,background:"linear-gradient(135deg, #f97316 0%, #22c55e 100%)",color:"#0a0a0f",fontWeight:700,"&:hover":{background:"linear-gradient(135deg, #fb923c 0%, #4ade80 100%)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Next Step â†’"}):!J&&!a&&e.jsx(P,{variant:"contained",size:"large",startIcon:e.jsx(Y,{}),onClick:le,sx:{px:4,background:"linear-gradient(135deg, #22c55e 0%, #f97316 100%)",color:"#0a0a0f",fontWeight:700,"&:hover":{background:"linear-gradient(135deg, #4ade80 0%, #fb923c 100%)",boxShadow:"0 0 30px rgba(34, 197, 94, 0.4)"}},children:"ðŸš€ Execute Script"})]})]})};export{ws as default};
