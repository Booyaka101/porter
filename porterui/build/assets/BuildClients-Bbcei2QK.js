import{ah as de,ai as xe,r as n,aj as he,j as e,ak as pe,J as ue,al as me,u as be,ab as ge,B as a,C as fe,g as s,aZ as L,m as T,T as c,d as q,b as p,ae as f,A as J,w as F,t as Z,e as je,a_ as _,f as ye,ac as j,l as K,a$ as D,P as M,D as Q,x as X,y as Y,k as y,ad as C}from"./index-C5leRk9Z.js";import{E as Ce}from"./Edit-BDf66UQf.js";import{D as Se}from"./Delete-72qyEOoG.js";import{A as ke}from"./ArrowBack-CIqbuvoQ.js";import{G as N}from"./Grid-Ff5obvXY.js";import{C as ee}from"./Chip-DbK6i-5d.js";import{D as se}from"./DialogActions-BnIfk71z.js";function ve(d){return de("MuiCardActions",d)}xe("MuiCardActions",["root","spacing"]);const we=d=>{const{classes:x,disableSpacing:t}=d;return me({root:["root",!t&&"spacing"]},ve,x)},$e=pe("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(d,x)=>{const{ownerState:t}=d;return[x.root,!t.disableSpacing&&x.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Ie=n.forwardRef(function(x,t){const u=he({props:x,name:"MuiCardActions"}),{disableSpacing:A=!1,className:h,...R}=u,S={...u,disableSpacing:A},W=we(S);return e.jsx($e,{className:ue(W.root,h),ownerState:S,ref:t,...R})}),Pe=()=>{const d=be(),[x]=ge(),t=x.get("machine"),[u,A]=n.useState([]),[h,R]=n.useState([]),[S,W]=n.useState(!0),[re,k]=n.useState(!1),[v,O]=n.useState(null),[ae,w]=n.useState(!1),[l,te]=n.useState(null),[b,z]=n.useState(""),[g,U]=n.useState(""),[V,$]=n.useState(""),[o,m]=n.useState({name:"",customer:"",pack:"",branch:""});n.useEffect(()=>{E()},[]),n.useEffect(()=>{t&&h.length>0&&h.find(i=>i.id===t)&&z(t)},[t,h]);const E=async()=>{try{const[r,i]=await Promise.all([fetch("/api/build-clients"),fetch("/api/machines")]),H=await r.json(),ce=await i.json();A(H||[]);const I=(ce||[]).filter(B=>B.tags?.includes("build")||B.tags?.includes("deploy"));R(I),t&&I.find(B=>B.id===t)?z(t):I.length>0&&!b&&z(I[0].id)}catch(r){$("Failed to load data: "+r.message)}finally{W(!1)}},P=(r=null)=>{r?(O(r),m({name:r.name,customer:r.customer,pack:r.pack,branch:r.branch})):(O(null),m({name:"",customer:"",pack:"",branch:""})),k(!0)},ne=async()=>{try{const r=v?`/api/build-clients/${v.id}`:"/api/build-clients";if(!(await fetch(r,{method:v?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error("Failed to save client");k(!1),E()}catch(r){$("Failed to save client: "+r.message)}},oe=async r=>{if(window.confirm("Delete this client?"))try{if(!(await fetch(`/api/build-clients/${r}`,{method:"DELETE"})).ok)throw new Error("Failed to delete client");E()}catch(i){$("Failed to delete client: "+i.message)}},ie=r=>{te(r),U(""),w(!0)},le=()=>{if(!l||!b||!g)return;const r=[`--customer=${l.customer}`,`--pack=${l.pack}`,...l.branch?[`--branch=${l.branch}`]:[],`--version=${g}`,"--auto-install"],i=encodeURIComponent(r.join(" "));d(`/scripts/build-deploy%2FbuildBundle.sh?machines=${b}&step=3&flags=${i}`),w(!1)},G=()=>h.find(i=>i.id===b)?.name||"Unknown";return S?e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:400},children:e.jsx(fe,{sx:{color:s.primary}})}):e.jsxs(a,{sx:{p:3,minHeight:"100vh"},children:[e.jsxs(a,{sx:{...L.container,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{onClick:()=>d("/machines"),sx:{color:s.text.muted,background:"rgba(255,255,255,0.05)","&:hover":{background:"rgba(249, 115, 22, 0.1)",color:s.primary}},children:e.jsx(ke,{})}),e.jsxs(a,{children:[e.jsx(c,{sx:L.title,children:"Build Clients"}),t&&e.jsxs(c,{sx:{color:s.text.muted,fontSize:"0.9rem",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(q,{sx:{fontSize:16,color:s.primary}}),"Building on: ",e.jsx("strong",{style:{color:s.primary},children:G()})]})]})]}),e.jsx(p,{variant:"contained",startIcon:e.jsx(J,{}),onClick:()=>P(),sx:f.primary,children:"Add Client"})]}),V&&e.jsx(F,{severity:"error",sx:{mb:2},onClose:()=>$(""),children:V}),h.length===0&&e.jsx(F,{severity:"warning",sx:{mb:2},children:"No machines with 'build' or 'deploy' tags found. Add these tags to machines that can run builds."}),e.jsx(N,{container:!0,spacing:3,children:u.length===0?e.jsx(N,{item:!0,xs:12,children:e.jsxs(a,{sx:{textAlign:"center",py:8,color:s.text.muted,background:s.background.card,borderRadius:"20px",border:`1px dashed ${s.border.medium}`},children:[e.jsx(Z,{sx:{fontSize:64,mb:2,opacity:.3,color:s.primary}}),e.jsx(c,{variant:"h5",sx:{color:s.text.primary,mb:1},children:"No clients configured"}),e.jsx(c,{sx:{mb:3,color:s.text.muted},children:"Add a client to start building"}),e.jsx(p,{variant:"contained",startIcon:e.jsx(J,{}),onClick:()=>P(),sx:f.primary,children:"Add First Client"})]})}):u.map(r=>e.jsx(N,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(je,{sx:{..._.base,"&:hover":_.hover},children:[e.jsxs(ye,{sx:{p:3},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(a,{sx:{width:44,height:44,borderRadius:"12px",background:j.primarySubtle,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Z,{sx:{color:s.primary,fontSize:22}})}),e.jsx(c,{variant:"h6",sx:{color:s.text.primary,fontWeight:700,fontSize:"1.1rem"},children:r.name})]}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:.75,mb:2},children:[e.jsx(ee,{size:"small",label:`Customer: ${r.customer}`,sx:{bgcolor:"rgba(249, 115, 22, 0.1)",color:s.primary,border:`1px solid ${s.border.accent}`,fontWeight:500}}),e.jsx(ee,{size:"small",label:`Pack: ${r.pack}`,sx:{bgcolor:"rgba(34, 197, 94, 0.1)",color:s.secondary,border:`1px solid ${s.border.success}`,fontWeight:500}})]}),r.branch&&e.jsxs(c,{sx:{color:s.text.muted,fontSize:"0.85rem",fontFamily:"monospace",background:"rgba(0,0,0,0.2)",px:1.5,py:.5,borderRadius:"6px",display:"inline-block"},children:["ðŸŒ¿ ",r.branch]})]}),e.jsxs(Ie,{sx:{justifyContent:"space-between",px:3,pb:3,pt:0,borderTop:`1px solid ${s.border.light}`,mt:0},children:[e.jsxs(a,{sx:{display:"flex",gap:.5,pt:2},children:[e.jsx(K,{title:"Edit",children:e.jsx(T,{size:"small",onClick:()=>P(r),sx:{color:s.text.muted,"&:hover":{color:s.primary,background:"rgba(249, 115, 22, 0.1)"}},children:e.jsx(Ce,{fontSize:"small"})})}),e.jsx(K,{title:"Delete",children:e.jsx(T,{size:"small",onClick:()=>oe(r.id),sx:{color:s.text.muted,"&:hover":{color:s.error,background:"rgba(239, 68, 68, 0.1)"}},children:e.jsx(Se,{fontSize:"small"})})})]}),e.jsx(p,{variant:"contained",size:"medium",startIcon:e.jsx(M,{}),onClick:()=>ie(r),disabled:h.length===0,sx:{mt:2,background:j.secondary,fontWeight:600,px:2.5,borderRadius:"10px",boxShadow:D.glowSuccess,"&:hover":{background:"linear-gradient(135deg, #16a34a 0%, #15803d 100%)",boxShadow:"0 8px 30px rgba(34, 197, 94, 0.5)"},"&:disabled":{background:"rgba(255,255,255,0.05)",boxShadow:"none"}},children:"Build"})]})]})},r.id))}),e.jsxs(Q,{open:re,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{background:s.background.elevated,border:`1px solid ${s.border.medium}`,borderRadius:"20px",boxShadow:D.cardElevated}},children:[e.jsx(X,{sx:{color:s.text.primary,fontWeight:700,fontSize:"1.3rem",borderBottom:`1px solid ${s.border.light}`,pb:2},children:v?"Edit Client":"Add Client"}),e.jsxs(Y,{sx:{pt:3},children:[e.jsx(y,{fullWidth:!0,label:"Client Name",value:o.name,onChange:r=>m({...o,name:r.target.value}),sx:{mt:1,mb:2.5,...C.search},placeholder:"e.g., solaire, inspire, idx"}),e.jsx(y,{fullWidth:!0,label:"Customer",value:o.customer,onChange:r=>m({...o,customer:r.target.value}),sx:{mb:2.5,...C.search},placeholder:"Customer name for build output"}),e.jsx(y,{fullWidth:!0,label:"Pack",value:o.pack,onChange:r=>m({...o,pack:r.target.value}),sx:{mb:2.5,...C.search},placeholder:"Pack name (usually same as customer)"}),e.jsx(y,{fullWidth:!0,label:"Branch",value:o.branch,onChange:r=>m({...o,branch:r.target.value}),sx:C.search,placeholder:"Git branch (default: master)"})]}),e.jsxs(se,{sx:{px:3,pb:3,pt:2,borderTop:`1px solid ${s.border.light}`},children:[e.jsx(p,{onClick:()=>k(!1),sx:{...f.secondary,px:3},variant:"outlined",children:"Cancel"}),e.jsx(p,{onClick:ne,variant:"contained",disabled:!o.name||!o.customer||!o.pack,sx:f.primary,children:"Save Client"})]})]}),e.jsxs(Q,{open:ae,onClose:()=>w(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{background:s.background.elevated,border:`1px solid ${s.border.medium}`,borderRadius:"20px",boxShadow:D.cardElevated}},children:[e.jsxs(X,{sx:{color:s.text.primary,fontWeight:700,fontSize:"1.3rem",borderBottom:`1px solid ${s.border.light}`,pb:2,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"10px",background:j.secondary,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(M,{sx:{color:"#fff",fontSize:22}})}),"Build ",l?.name]}),e.jsxs(Y,{sx:{pt:3},children:[e.jsxs(F,{severity:"info",sx:{mb:3,borderRadius:"12px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)","& .MuiAlert-icon":{color:s.info}},children:["This will run ",e.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"2px 6px",borderRadius:"4px"},children:"buildBundle.sh"})," with ",e.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"2px 6px",borderRadius:"4px"},children:"--auto-install"})," enabled."]}),e.jsx(c,{sx:{color:s.text.secondary,mb:1,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Build Machine"}),e.jsx(a,{sx:{p:2,mb:3,background:s.background.card,borderRadius:"12px",border:`1px solid ${s.border.light}`},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(a,{sx:{width:36,height:36,borderRadius:"8px",background:j.primarySubtle,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(q,{sx:{color:s.primary,fontSize:20}})}),e.jsx(c,{sx:{color:s.text.primary,fontWeight:600},children:G()})]})}),e.jsx(y,{fullWidth:!0,label:"Version",value:g,onChange:r=>U(r.target.value),placeholder:"e.g., 1.2.3",required:!0,helperText:"Version tag for this build (required)",sx:{mb:3,...C.search}}),e.jsx(c,{sx:{color:s.text.secondary,mb:1,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Build Configuration"}),e.jsx(a,{sx:{p:2,background:"rgba(0,0,0,0.3)",borderRadius:"12px",border:`1px solid ${s.border.light}`},children:e.jsxs(c,{sx:{color:s.secondary,fontFamily:"monospace",fontSize:"0.9rem",lineHeight:1.8},children:[e.jsx("span",{style:{color:s.text.muted},children:"$"})," --customer=",e.jsx("span",{style:{color:s.primary},children:l?.customer}),e.jsx("br",{}),e.jsx("span",{style:{color:s.text.muted},children:"$"})," --pack=",e.jsx("span",{style:{color:s.primary},children:l?.pack}),e.jsx("br",{}),l?.branch&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:s.text.muted},children:"$"})," --branch=",e.jsx("span",{style:{color:s.primary},children:l?.branch}),e.jsx("br",{})]}),e.jsx("span",{style:{color:s.text.muted},children:"$"})," --version=",e.jsx("span",{style:{color:s.primary},children:g||"<version>"}),e.jsx("br",{}),e.jsx("span",{style:{color:s.text.muted},children:"$"})," --auto-install"]})})]}),e.jsxs(se,{sx:{px:3,pb:3,pt:2,borderTop:`1px solid ${s.border.light}`},children:[e.jsx(p,{onClick:()=>w(!1),sx:{...f.secondary,px:3},variant:"outlined",children:"Cancel"}),e.jsx(p,{onClick:le,variant:"contained",startIcon:e.jsx(M,{}),disabled:!g||!b,sx:{background:j.secondary,fontWeight:700,px:3,borderRadius:"12px",boxShadow:D.glowSuccess,"&:hover":{background:"linear-gradient(135deg, #16a34a 0%, #15803d 100%)",boxShadow:"0 8px 30px rgba(34, 197, 94, 0.5)"},"&:disabled":{background:"rgba(255,255,255,0.05)",boxShadow:"none"}},children:"Start Build"})]})]})]})};export{Pe as default};
